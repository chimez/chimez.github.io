<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="zh_cn">
<head>
<meta charset="utf-8">
<meta name="description" content="Blog of chimez">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>chimez's blog (旧文章，第 1 页) | chimez's blog</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="zh_cn" href="rss.xml">
<link rel="canonical" href="https://chimez.github.io/index-1.html">
<link rel="prev" href="index-2.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">跳到主内容</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href=".">

            <span id="blog-title">chimez's blog</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav"></ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
    
        

    
        
    <div class="postindex">
            <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/git/" class="u-url">git</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        chimez
                    </span></p>
            <p class="dateline">
            <a href="posts/git/" rel="bookmark">
            <time class="published dt-published" datetime="2021-01-24T12:51:36+08:00" itemprop="datePublished" title="2021-01-24 12:51">2021-01-24 12:51</time></a>
            </p>
                        <p class="commentline">
    
    <a href="posts/git/#disqus_thread" data-disqus-identifier="cache/posts/git.html">评论</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div id="outline-container-org2c9e614" class="outline-2">
<h2 id="org2c9e614">使用案例</h2>
<div class="outline-text-2" id="text-org2c9e614">
</div>
<div id="outline-container-orge39a796" class="outline-3">
<h3 id="orge39a796">新建仓库</h3>
<div class="outline-text-3" id="text-orge39a796">
<div class="highlight"><pre><span></span>   git init .
</pre></div>
</div>
</div>

<div id="outline-container-org2f9ba48" class="outline-3">
<h3 id="org2f9ba48">下载远程仓库</h3>
<div class="outline-text-3" id="text-org2f9ba48">
<div class="highlight"><pre><span></span>   git clone --depth=1 https://...
</pre></div>
<p>
<code>--depth=1</code> 表示只下载一部分历史
</p>
</div>
</div>

<div id="outline-container-org40c986a" class="outline-3">
<h3 id="org40c986a">gitignore：忽略文件</h3>
<div class="outline-text-3" id="text-org40c986a">
<p>
见 <a href="https://github.com/github/gitignore">gitignore</a>
</p>
</div>
</div>

<div id="outline-container-org5036242" class="outline-3">
<h3 id="org5036242">添加本地更改</h3>
<div class="outline-text-3" id="text-org5036242">
<div class="highlight"><pre><span></span>   git add --all 
   git commit -m "sth"
</pre></div>
</div>
</div>

<div id="outline-container-org6455a24" class="outline-3">
<h3 id="org6455a24">从远端获取更新</h3>
<div class="outline-text-3" id="text-org6455a24">
<div class="highlight"><pre><span></span>   git pull
</pre></div>
</div>
</div>

<div id="outline-container-org0f453a1" class="outline-3">
<h3 id="org0f453a1">推送更新到远端</h3>
<div class="outline-text-3" id="text-org0f453a1">
<div class="highlight"><pre><span></span>   git push origin master
</pre></div>
</div>
</div>

<div id="outline-container-orga87b8aa" class="outline-3">
<h3 id="orga87b8aa">使用代理</h3>
<div class="outline-text-3" id="text-orga87b8aa">
<div class="highlight"><pre><span></span>   git config --global http.proxy http://proxy.mycompany:80
</pre></div>
</div>
</div>

<div id="outline-container-org83d898b" class="outline-3">
<h3 id="org83d898b">记录里显示中文</h3>
<div class="outline-text-3" id="text-org83d898b">
<div class="highlight"><pre><span></span>   git config --global core.quotepath false
</pre></div>
</div>
</div>

<div id="outline-container-org77b4eb9" class="outline-3">
<h3 id="org77b4eb9">设置默认编辑器</h3>
<div class="outline-text-3" id="text-org77b4eb9">
<div class="highlight"><pre><span></span>   git config --global core.editor "vim"
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org526324b" class="outline-2">
<h2 id="org526324b">git-lfs: 用 git 管理大文件</h2>
<div class="outline-text-2" id="text-org526324b">
</div>
<div id="outline-container-orge519cf6" class="outline-3">
<h3 id="orge519cf6">安装</h3>
<div class="outline-text-3" id="text-orge519cf6">
<p>
从包管理器中安装 <code>git-lfs</code> ，windows版本已经包含了
</p>
</div>
</div>

<div id="outline-container-org40fb1b4" class="outline-3">
<h3 id="org40fb1b4">使用</h3>
<div class="outline-text-3" id="text-org40fb1b4">
<ol class="org-ol">
<li>对账户启用 <code>git lfs install</code>
</li>
<li>对仓库设置要追踪的文件类型 <code>git lfs track "*.psd"</code>
</li>
<li>把配置文件加到追踪列表里 <code>git add .gitattributes</code>
</li>
</ol>
</div>
</div>

<div id="outline-container-org0069a21" class="outline-3">
<h3 id="org0069a21">常用大文件</h3>
<div class="outline-text-3" id="text-org0069a21">
<p>
见 <a href="https://github.com/alexkaratarakis/gitattributes">gitattributes</a>
</p>
<div class="highlight"><pre><span></span>   git lfs track "*.png"
   git lfs track "*.jpg"
   git lfs track "*.jpeg"
   git lfs track "*.gif"

   git lfs track "*.mp4"
   git lfs track "*.mpeg"
   git lfs track "*.mkv"
</pre></div>

<p>
<code>.gitattributes</code> 文件内容为
</p>
<pre class="example" id="org6b2a79e">
*.pdf   filter=lfs diff=lfs merge=lfs -text
*.jpg   filter=lfs diff=lfs merge=lfs -text
*.jpeg  filter=lfs diff=lfs merge=lfs -text
*.png   filter=lfs diff=lfs merge=lfs -text
*.gif   filter=lfs diff=lfs merge=lfs -text
*.ico   filter=lfs diff=lfs merge=lfs -text
*.eps   filter=lfs diff=lfs merge=lfs -text
*.bmp   filter=lfs diff=lfs merge=lfs -text
*.psb   filter=lfs diff=lfs merge=lfs -text
*.tiff  filter=lfs diff=lfs merge=lfs -text
*.wbmp  filter=lfs diff=lfs merge=lfs -text
*.webp  filter=lfs diff=lfs merge=lfs -text
</pre>
</div>
</div>
</div>

<div id="outline-container-org7deafe6" class="outline-2">
<h2 id="org7deafe6">git-remote-dropbox: 用 Dropbox 做私人仓库</h2>
<div class="outline-text-2" id="text-org7deafe6">
<p>
<a href="https://github.com/anishathalye/git-remote-dropbox">git-remote-dropbox</a>
</p>
</div>
<div id="outline-container-org1a1c127" class="outline-3">
<h3 id="org1a1c127">安装</h3>
<div class="outline-text-3" id="text-org1a1c127">
<ol class="org-ol">
<li>安装 <code>pip install git-remote-dropbox</code>
</li>
<li>在网站上生成 OAuth 2 密钥 <a href="https://www.dropbox.com/developers/apps">app console</a>
</li>
<li>把密钥存在文件 <code>/.config/git/git-remote-dropbox.json or ~/.git-remote-dropbox.json
      ~{"default":"token"}</code>
</li>
<li>配置别名 <code>git config --global alias.dropbox '!git-dropbox-manage'</code>
</li>
</ol>
</div>
</div>

<div id="outline-container-org949802d" class="outline-3">
<h3 id="org949802d">使用</h3>
<div class="outline-text-3" id="text-org949802d">
</div>
<div id="outline-container-orgb94b6f1" class="outline-4">
<h4 id="orgb94b6f1">clone 已有仓库</h4>
<div class="outline-text-4" id="text-orgb94b6f1">
<div class="highlight"><pre><span></span>    git clone "dropbox:///path/to/repo"
</pre></div>
</div>
</div>

<div id="outline-container-org54da04e" class="outline-4">
<h4 id="org54da04e">创建远程仓库</h4>
<div class="outline-text-4" id="text-org54da04e">
<div class="highlight"><pre><span></span>    git remote add origin "dropbox:///path/to/repo"
</pre></div>
</div>
</div>
</div>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/pdftk/" class="u-url">pdftk: The PDF Toolkit</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        chimez
                    </span></p>
            <p class="dateline">
            <a href="posts/pdftk/" rel="bookmark">
            <time class="published dt-published" datetime="2021-01-08T11:09:45+08:00" itemprop="datePublished" title="2021-01-08 11:09">2021-01-08 11:09</time></a>
            </p>
                        <p class="commentline">
    
    <a href="posts/pdftk/#disqus_thread" data-disqus-identifier="cache/posts/pdftk.html">评论</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div id="outline-container-org250e1db" class="outline-2">
<h2 id="org250e1db">添加目录与修改元信息</h2>
<div class="outline-text-2" id="text-org250e1db">
<p>
参见： <a href="https://www.pdflabs.com/blog/export-and-import-pdf-bookmarks/">https://www.pdflabs.com/blog/export-and-import-pdf-bookmarks/</a>
</p>
</div>
<div id="outline-container-org8048dcc" class="outline-3">
<h3 id="org8048dcc">从pdf中提取目录和元信息</h3>
<div class="outline-text-3" id="text-org8048dcc">
<div class="highlight"><pre><span></span>   pdftk C:\Users\Sid\Desktop\doc.pdf dump_data output C:\Users\Sid\Desktop\doc_data.txt
</pre></div>
</div>
</div>

<div id="outline-container-org15f9754" class="outline-3">
<h3 id="org15f9754">给pdf添加或更新目录</h3>
<div class="outline-text-3" id="text-org15f9754">
<div class="highlight"><pre><span></span>   pdftk C:\Users\Sid\Desktop\doc.pdf update_info C:\Users\Sid\Desktop\doc_data.txt output C:\Users\Sid\Desktop\updated.pdf
</pre></div>

<p>
目录文件格式：
</p>
<div class="highlight"><pre><span></span>   BookmarkBegin
   BookmarkTitle: PDF Reference (Version 1.5)
   BookmarkLevel: 1
   BookmarkPageNumber: 1
   BookmarkBegin
   BookmarkTitle: Contents
   BookmarkLevel: 2
   BookmarkPageNumber: 3
</pre></div>

<p>
其中字符应编码成 html entitle 的样子。
可以用 <a href="https://tool.oschina.net/encode">https://tool.oschina.net/encode</a> , <a href="https://www.online-toolz.com/tools/unicode-html-entities-convertor.php">https://www.online-toolz.com/tools/unicode-html-entities-convertor.php</a> 这里的 Native/Unicode 转换工具。
</p>

<p>
或者python
</p>
<div class="highlight"><pre><span></span>   <span class="sa">u</span><span class="s2">"阿斯顿"</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'ascii'</span><span class="p">,</span> <span class="s1">'xmlcharrefreplace'</span><span class="p">)</span>

   <span class="k">def</span> <span class="nf">utf8_to_ascii_xml</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
       <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">'r'</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fi</span><span class="p">:</span>
           <span class="n">lines</span> <span class="o">=</span> <span class="n">fi</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
           <span class="n">lines_ascii</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'ascii'</span><span class="p">,</span> <span class="s1">'xmlcharrefreplace'</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
       <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.ascii"</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fi</span><span class="p">:</span>
           <span class="n">fi</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines_ascii</span><span class="p">)</span>
</pre></div>

<p>
常用正则替换
</p>
<pre class="example" id="org5213845">
s/\(.*\),\(.*\)/BookmarkBegin\nBookmarkTitle: \1\nBookmarkLevel: 2\nBookmarkPageNumber: \2/
</pre>
</div>
</div>

<div id="outline-container-orgfaaf682" class="outline-3">
<h3 id="orgfaaf682">添加目录的示例流程</h3>
<div class="outline-text-3" id="text-orgfaaf682">
<div class="highlight"><pre><span></span>   <span class="c1"># import</span>
   <span class="kn">import</span> <span class="nn">pytesseract</span>
   <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
   <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
   <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
   <span class="kn">import</span> <span class="nn">re</span>

   <span class="c1"># 利用 OCR 生成目录</span>
   <span class="nb">print</span><span class="p">(</span><span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'a.png'</span><span class="p">)))</span>

   <span class="c1"># 手动编辑目录，使用 orgmode 的表格</span>
   <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"a.txt"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"|"</span><span class="p">)</span>
   <span class="n">darr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
   <span class="n">darr</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">darr</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]]</span>
   <span class="n">darr</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">darr</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]]</span>
   <span class="n">darr</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">darr</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">9</span>
   <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">darr</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
   <span class="n">data</span>

   <span class="c1"># 生成目录格式并保存</span>
   <span class="n">block</span> <span class="o">=</span> <span class="s2">"""BookmarkBegin</span>
<span class="s2">   BookmarkTitle: </span><span class="si">{title}</span>
<span class="s2">   BookmarkLevel: </span><span class="si">{level}</span>
<span class="s2">   BookmarkPageNumber: </span><span class="si">{page}</span>
<span class="s2">   """</span>
   <span class="n">txt</span> <span class="o">=</span> <span class="s2">""</span>
   <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">darr</span><span class="p">:</span>
       <span class="n">index</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
       <span class="n">title</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
       <span class="n">page</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
       <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="s1">''</span> <span class="ow">or</span> <span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'.'</span><span class="p">:</span>
           <span class="n">level</span> <span class="o">=</span> <span class="mi">1</span>
       <span class="k">else</span><span class="p">:</span>
           <span class="n">level</span> <span class="o">=</span> <span class="mi">2</span>
           <span class="n">txt</span> <span class="o">+=</span> <span class="n">block</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">)</span>

   <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"b.txt"</span><span class="p">,</span><span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fi</span><span class="p">:</span>
       <span class="n">fi</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


<div id="outline-container-orgc3b91e1" class="outline-2">
<h2 id="orgc3b91e1">合并pdf文件</h2>
<div class="outline-text-2" id="text-orgc3b91e1">
<div class="highlight"><pre><span></span>  pdftk in1.pdf in2.pdf cat output out1.pdf
</pre></div>
</div>
</div>


<div id="outline-container-orga6ab63b" class="outline-2">
<h2 id="orga6ab63b">djvu to pdf</h2>
<div class="outline-text-2" id="text-orga6ab63b">
<ol class="org-ol">
<li>djvulibre</li>
</ol>
<div class="highlight"><pre><span></span>  ddjvu -format=pdf -quality=85 -verbose a.djvu a.pdf
</pre></div>
</div>
</div>


<div id="outline-container-org7cf1604" class="outline-2">
<h2 id="org7cf1604">分割文件</h2>
<div class="outline-text-2" id="text-org7cf1604">
<div class="highlight"><pre><span></span>pdftk in.pdf burst output out_%04d.pdf
</pre></div>
</div>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/early-history-of-bosonization/" class="u-url">Early History of Bosonization</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        chimez
                    </span></p>
            <p class="dateline">
            <a href="posts/early-history-of-bosonization/" rel="bookmark">
            <time class="published dt-published" datetime="2021-01-07T10:46:46+08:00" itemprop="datePublished" title="2021-01-07 10:46">2021-01-07 10:46</time></a>
            </p>
                        <p class="commentline">
    
    <a href="posts/early-history-of-bosonization/#disqus_thread" data-disqus-identifier="cache/posts/early-history-of-bosonization.html">评论</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <p>
本文是 A. O. Gogolin, A. A. Nersesyan, A. M. Tsvelik 的 "Bosonization and Strongly Correlated Systems" 一书的序言，简短地回顾了强关联领域和1990年以前的玻色化方法的历史，对了解强关联领域很有帮助。
</p>

<div id="outline-container-orgaa6f7ba" class="outline-2">
<h2 id="orgaa6f7ba">玻色化的早期历史</h2>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ssh/" class="u-url">ssh</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        chimez
                    </span></p>
            <p class="dateline">
            <a href="posts/ssh/" rel="bookmark">
            <time class="published dt-published" datetime="2020-12-24T21:07:46+08:00" itemprop="datePublished" title="2020-12-24 21:07">2020-12-24 21:07</time></a>
            </p>
                        <p class="commentline">
    
    <a href="posts/ssh/#disqus_thread" data-disqus-identifier="cache/posts/ssh.html">评论</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div id="outline-container-org655073d" class="outline-2">
<h2 id="org655073d">SSH 端口转发</h2>
<div class="outline-text-2" id="text-org655073d">
</div>
<div id="outline-container-org039b826" class="outline-3">
<h3 id="org039b826">本地转发: 本地访问远程</h3>
<div class="outline-text-3" id="text-org039b826">
<p>
本地转发，顾名思义就是把本地主机端口通过待登录主机端口转发到远程主机端口上去。
</p>

<p>
本地转发通过参数 -L 指定，格式：-L [本地主机:]本地主机端口:远程网络主机:远程网络主机端口。加上ssh待登录主机，这里就有了三台主机。
</p>

<p>
举例：~ssh -L 0.0.0.0:50000:host2:80 user@host1~ 。这条命令将host2的80端口映射到本地的50000端口，前提是待登录主机host1上可以正常连接到host2的80端口。
</p>

<p>
畅想一下这个功能的作用：
</p>
<ol class="org-ol">
<li>因为本地的mysql更顺手，想用本地的mysql客户端命令连接受限网络环境的mysql服务端。</li>
<li>本地安装了开发工具，想用这个开发工具连接受限网络环境中某个服务的远程调试端口。</li>
</ol>
</div>
</div>

<div id="outline-container-orga04a949" class="outline-3">
<h3 id="orga04a949">远程转发: 远程访问本地</h3>
<div class="outline-text-3" id="text-orga04a949">
<p>
远程转发是指把登录主机所在网络中某个端口通过本地主机端口转发到远程主机上。
</p>

<p>
远程转发通过参数 -R 指定，格式：-R [登录主机:]登录主机端口:本地网络主机:本地网络主机端口。
</p>

<p>
举例：~ssh -R 0.0.0.0:8080:host2:80 user@host1~ 。这条命令将host2的80端口映射到待登录主机host1的8080端口，前提是本地主机可以正常连接host2的80端口。
</p>

<p>
畅想一下这个功能的作用：
</p>

<ol class="org-ol">
<li>本地网络中有一个http代理，通过这个代理可以上外网，因此通过这条命令将这个http代理映射到待登录主机的某个端口，这样受限网络环境中所有其它服务器即可使用这个http代理上外网了。</li>
<li>在本机开发了一个web应用，想拿给别人测试，但现在你却处在内网，外网是无法直接访问内网的主机的，怎么办！？很多人可能会说，找台有公网IP的主机，重新部署一下就行了。这样可行，但太麻烦。然而自从你了解了ssh的远程转发之后，一切都变得简单了。只需在本地主机上执行一下上面例子的命令即可实现外网访问内网的web应用。</li>
</ol>
<p>
注意：
</p>
<ol class="org-ol">
<li>sshd<sub>config里要打开AllowTcpForwarding选项</sub>，否则-R远程端口转发会失败。</li>
<li>默认转发到远程主机上的端口绑定的是127.0.0.1，如要绑定0.0.0.0需要打开sshd<sub>config里的GatewayPorts选项</sub>。这个选项如果由于权限没法打开也有办法，可配合ssh -L将端口绑定到0.0.0.0，聪明的你应该能想到办法，呵呵。</li>
</ol>
</div>
</div>

<div id="outline-container-org54040ba" class="outline-3">
<h3 id="org54040ba">动态转发</h3>
<div class="outline-text-3" id="text-org54040ba">
<p>
相对于本地转发和远程转发的单一端口转发模式而言，动态转发有点更加强劲的端口转发功能，即是无需固定指定被访问目标主机的端口号。这个端口号需要在本地通过协议指定，该协议就是简单、安全、实用的 SOCKS 协议。
</p>

<p>
动态转发通过参数 -D 指定，格式：-D [本地主机:]本地主机端口。相对于前两个来说，动态转发无需再指定远程主机及其端口。它们由通过 SOCKS协议 连接到本地主机端口的那个主机。
</p>

<p>
举例：~ssh -D 50000 user@host1~ 。这条命令创建了一个SOCKS代理，所以通过该SOCKS代理发出的数据包将经过host1转发出去。
</p>

<p>
怎么使用？
</p>

<ol class="org-ol">
<li>用firefox浏览器，在浏览器里设置使用socks5代理127.0.0.1:50000，然后浏览器就可以访问host1所在网络内的任何IP了。</li>
<li>
<p>
如果是普通命令行应用，使用proxychains-ng，参考命令如下：
</p>
<div class="highlight"><pre><span></span>      brew install proxychains-ng
      vim /usr/local/etc/proxychains.conf # 在ProxyList配置段下添加配置 "socks5 	127.0.0.1 50000"
      proxychains-ng wget http://host2 # 在其它命令行前添加proxychains-ng即可
</pre></div>
</li>
<li>
<p>
如果是ssh，则用以下命令使用socks5代理：
</p>
<div class="highlight"><pre><span></span>      ssh -o ProxyCommand='/usr/bin/nc -X 5 -x 127.0.0.1:5000 %h %p' user@host2
</pre></div>
</li>
</ol>
<p>
畅想一下这个功能的作用：
</p>
<ol class="org-ol">
<li>想访问受限网络环境中的多种服务</li>
<li>FQ</li>
<li>……</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org08a7912" class="outline-2">
<h2 id="org08a7912">免密码登录</h2>
<div class="outline-text-2" id="text-org08a7912">
</div>
<div id="outline-container-orgda97bc0" class="outline-3">
<h3 id="orgda97bc0">在本地机器生成密钥对</h3>
<div class="outline-text-3" id="text-orgda97bc0">
<div class="highlight"><pre><span></span>   ssh-keygen -t rsa
</pre></div>
<p>
根据提示设置文件名和密码
</p>
</div>
</div>

<div id="outline-container-org7ad7b96" class="outline-3">
<h3 id="org7ad7b96">授权登录</h3>
<div class="outline-text-3" id="text-org7ad7b96">
<p>
将公钥追加到目标服务器的 <code>$HOME/.ssh/authorized_keys</code> 文件中，该文件的权限应为 <code>600</code> ， <code>.ssh</code> 目录权限应为 <code>700</code>
</p>
<div class="highlight"><pre><span></span>   touch ~/.ssh/authorized_keys
   chmod 600 ~/.ssh/authorized_keys
   cat ~/.ssh/a_rsa.pub &gt;&gt; ~/.ssh/authorized_keys
</pre></div>

<p>
测试一下
</p>
<div class="highlight"><pre><span></span>   ssh username@localhost
</pre></div>
</div>
</div>
</div>

<div id="outline-container-orge959116" class="outline-2">
<h2 id="orge959116">配置别名</h2>
<div class="outline-text-2" id="text-orge959116">
<p>
在 <code>~/.ssh/config</code> 中配置别名，就不用记 ip 了。
</p>

<div class="highlight"><pre><span></span>  # 指定使用 bash 登录
  Host thbash
      HostName 10.0.0.101
      User username
      RequestTTY yes
      RemoteCommand bash

  # 指定使用 zsh 登录
  Host th
      HostName 10.0.0.101
      User username
      RequestTTY yes
      RemoteCommand zsh

  # 最基本的设置
  Host group1
      Hostname 10.0.5.90
      User username
</pre></div>
</div>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/systemd/" class="u-url">systemd</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        chimez
                    </span></p>
            <p class="dateline">
            <a href="posts/systemd/" rel="bookmark">
            <time class="published dt-published" datetime="2020-12-24T19:55:29+08:00" itemprop="datePublished" title="2020-12-24 19:55">2020-12-24 19:55</time></a>
            </p>
                        <p class="commentline">
    
    <a href="posts/systemd/#disqus_thread" data-disqus-identifier="cache/posts/systemd.html">评论</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div id="outline-container-orgf2d3b5d" class="outline-2">
<h2 id="orgf2d3b5d">systemctl: 管理服务</h2>
<div class="outline-text-2" id="text-orgf2d3b5d">
<ul class="org-ul">
<li>systemd 中的服务后缀名 <code>.service</code> 可以不写，会自动补全。</li>
<li>systemd 中把服务称作 <code>unit</code> , <code>unit</code> 有多种类型包括 <code>.service, .target</code> 等</li>
</ul>
</div>


<div id="outline-container-org0193ec5" class="outline-3">
<h3 id="org0193ec5">列出服务</h3>
<div class="outline-text-3" id="text-org0193ec5">
<div class="highlight"><pre><span></span>   # 查看系统所有安装的服务项
   systemctl list-unit-files --type=service

   # 查看系统所有运行的服务项
   systemctl list-units --type=service

   # 查看系统所有开机自启动的服务项
   systemctl list-unit-files --type=service | grep enabled
</pre></div>
</div>
</div>

<div id="outline-container-orgccfb38f" class="outline-3">
<h3 id="orgccfb38f">查看特定服务</h3>
<div class="outline-text-3" id="text-orgccfb38f">
<div class="highlight"><pre><span></span>   # 查看指定服务项状态
   systemctl status &lt;服务项名称&gt;

   # 查看服务项的依赖关系
   systemctl list-dependencies &lt;服务项名称&gt;
</pre></div>
</div>
</div>

<div id="outline-container-org6c9f9b6" class="outline-3">
<h3 id="org6c9f9b6">查看系统状态</h3>
<div class="outline-text-3" id="text-org6c9f9b6">
<div class="highlight"><pre><span></span>   # 查看系统启动耗时
   systemd-analyze

   # 查看各项服务启动耗时
   systemd-analyze blame | grep .service
</pre></div>
</div>
</div>

<div id="outline-container-orga40a49b" class="outline-3">
<h3 id="orga40a49b">管理服务</h3>
<div class="outline-text-3" id="text-orga40a49b">
<div class="highlight"><pre><span></span>   # 启动服务
   systemctl start &lt;服务项名称&gt;

   # 停止服务
   systemctl stop &lt;服务项名称&gt;

   # 重启服务
   systemctl restart &lt;服务项名称&gt;

   # 重新读取配置文件
   # 如果该服务不能重启，但又必须使用新的配置，这条命令会很有用
   systemctl reload &lt;服务项名称&gt;

   # 使服务开机自启动
   systemctl enable &lt;服务项名称&gt;

   # 使服务不要开机自启动
   systemctl disable &lt;服务项名称&gt;

   # 禁用服务
   # 这可以防止服务被其他服务间接启动，也无法通过 start 或 restart 命令来启动服务。
   systemctl mask &lt;服务项名称&gt;

   # 不再禁用服务
   systemctl unmask &lt;服务项名称&gt;

   # 重新读取所有服务项
   # 修改、添加、删除服务项之后需要执行以下命令。
   systemctl daemon-reload
</pre></div>
</div>
</div>
</div>



<div id="outline-container-org7a95671" class="outline-2">
<h2 id="org7a95671">编写简单的服务</h2>
<div class="outline-text-2" id="text-org7a95671">
<p>
服务文件都存放在 <code>/etc/systemd/system/</code> 中，后缀名为 <code>.service</code>
</p>
</div>

<div id="outline-container-orgcde75fe" class="outline-3">
<h3 id="orgcde75fe">简单的自启动脚本</h3>
<div class="outline-text-3" id="text-orgcde75fe">
<ul class="org-ul">
<li>
<code>Type=simple</code> 表示启动并一直运行</li>
<li>
<code>ExecStart=/...</code> 表示要执行的命令，路径要写全</li>
<li>
<code>WantedBy=multi-user.target</code> 表示当用户能登录的时候就该启动这个服务了</li>
<li>
<code>User=name</code> 表示运行程序时使用的用户，默认为 <code>root</code>
</li>
</ul>
<div class="highlight"><pre><span></span>   [Unit]
   Description=My Startup

   [Service]
   Type=simple
   ExecStart=/path/to/server --server

   [Install]
   WantedBy=multi-user.target
</pre></div>
</div>
</div>


<div id="outline-container-org8e6de34" class="outline-3">
<h3 id="org8e6de34">配置自启动 jupyterlab</h3>
<div class="outline-text-3" id="text-org8e6de34">
<p>
<code>/etc/systemd/system/jupyterlab.service</code>
</p>
<div class="highlight"><pre><span></span>   # start jupyter lab
   [Unit]
   Description=jupyter lab
   After=nginx.target

   [Service]
   Type=simple
   Environment="PATH='/home/username/.local/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games'" "PYTHONPATH='/home/username/.local/bin:/usr/lib/python39.zip:/usr/lib/python3.9:/usr/lib/python3.9/lib-dynload:/home/username/.local/lib/python3.9/site-packages:/usr/local/lib/python3.9/dist-packages:/usr/lib/python3/dist-packages:/home/username/.local/lib/python3.9/site-packages/IPython/extensions:/home/username/.ipython'"
   ExecStart=/home/username/.local/bin/jupyter lab --LabApp.app_dir=/home/username/.local/share/jupyter/lab --notebook-dir=/home/username/Projects --allow-root --config=/home/username/.jupyter/jupyter_lab_config.py

   [Install]
   WantedBy=multi-user.target
</pre></div>
</div>
</div>


<div id="outline-container-orgbf72e4d" class="outline-3">
<h3 id="orgbf72e4d">配置自动挂载</h3>
<div class="outline-text-3" id="text-orgbf72e4d">
<p>
配置文件路径： <code>/etc/systemd/system/path-to-dir.mount</code> 。
</p>

<p>
注意：文件名必须是挂载路径名，例如要把 <code>/dev/sdb1</code> 挂载到 <code>/mnt/sds</code> ，配置文件应该叫做 <code>mnt-sds.mount</code>
</p>

<div class="highlight"><pre><span></span>   [Unit]
   Description=mount 

   [Mount]
   What=/dev/sdb1
   Where=/mnt/sds
   Options=defaults

   [Install]
   WantedBy=local-fs.target
</pre></div>
</div>
</div>
</div>






<div id="outline-container-orga1b2f09" class="outline-2">
<h2 id="orga1b2f09">问题</h2>
<div class="outline-text-2" id="text-orga1b2f09">
</div>
<div id="outline-container-org88061a6" class="outline-3">
<h3 id="org88061a6">用户定义服务</h3>
<div class="outline-text-3" id="text-org88061a6">
<ul class="org-ul">
<li>命令使用 <code>systemctl --user</code> 剩下一样。</li>
<li>配置文件放在 <code>$HOME/.config/systemd/user</code> 里</li>
<li>然后执行一次 <code>loginctl enable-linger username</code> 让开机时自启动用户</li>
</ul>
</div>
</div>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/samba/" class="u-url">samba 文件共享</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        chimez
                    </span></p>
            <p class="dateline">
            <a href="posts/samba/" rel="bookmark">
            <time class="published dt-published" datetime="2020-12-24T12:37:06+08:00" itemprop="datePublished" title="2020-12-24 12:37">2020-12-24 12:37</time></a>
            </p>
                        <p class="commentline">
    
    <a href="posts/samba/#disqus_thread" data-disqus-identifier="cache/posts/samba.html">评论</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div id="outline-container-org88ed336" class="outline-2">
<h2 id="org88ed336">Samba 基本配置</h2>
<div class="outline-text-2" id="text-org88ed336">
<p>
参考 <a href="https://www.fosslinux.com/8703/how-to-setup-samba-file-sharing-server-on-ubuntu.htm">FossLinux 的文章</a>。
</p>
</div>


<div id="outline-container-org17871bb" class="outline-3">
<h3 id="org17871bb">安装 Samba</h3>
<div class="outline-text-3" id="text-org17871bb">
<div class="highlight"><pre><span></span>   apt install samba
</pre></div>
</div>
</div>

<div id="outline-container-orgccc7f28" class="outline-3">
<h3 id="orgccc7f28">添加组和用户</h3>
<div class="outline-text-3" id="text-orgccc7f28">
<p>
假定已经有一个本地用户 <code>mylocaluser</code>
</p>
<div class="highlight"><pre><span></span>   # 创建 smb 的组
   /usr/sbin/addgroup smbgroup
   # 把用户加到组里
   /usr/sbin/usermod -aG smbgroup mylocaluser
   # 设置用户的远程密码，可以与本地登录密码不同
   smbpasswd -a mylocaluser
</pre></div>
</div>
</div>

<div id="outline-container-orga874410" class="outline-3">
<h3 id="orga874410">配置文件</h3>
<div class="outline-text-3" id="text-orga874410">
<p>
首先一定要备份一份
</p>
<div class="highlight"><pre><span></span>   cp /etc/samba/smb.conf /etc/samba/smb.conf.backup
</pre></div>

<p>
配置文件修改如下，没有的项目就加进去，已有的就修改一下
</p>
<div class="highlight"><pre><span></span>   [global]

   # 允许用户登录
   security = user

   [homes]

   read only = no
</pre></div>

<p>
如果要加入其它登录地址，例如 <code>smb://ip/newport</code> 就如下配置
</p>
<div class="highlight"><pre><span></span>   [newport]
   path = /path/to/files
   valid users = @smbgroup
   guest ok = no
   writable = yes
   browsable = yes
</pre></div>
</div>
</div>
</div>



<div id="outline-container-org38dd42e" class="outline-2">
<h2 id="org38dd42e">软链接权限</h2>
<div class="outline-text-2" id="text-org38dd42e">
<p>
从别处软链接过来的文件夹打不开，因为没有配置软链接的权限，只要在 <code>[global]</code> 里加入下面的内容就行了。
</p>

<p>
参考：<a href="https://blog.csdn.net/cityzenoldwang/article/details/61189653">这个博客</a>
</p>
<div class="highlight"><pre><span></span>  [global]
  wide links = yes
  symlinks = yes
  unix extensions = no
</pre></div>
</div>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/exact-diagonalization/" class="u-url">Exact Diagonalization</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        chimez
                    </span></p>
            <p class="dateline">
            <a href="posts/exact-diagonalization/" rel="bookmark">
            <time class="published dt-published" datetime="2020-12-20T13:18:31+08:00" itemprop="datePublished" title="2020-12-20 13:18">2020-12-20 13:18</time></a>
            </p>
                        <p class="commentline">
    
    <a href="posts/exact-diagonalization/#disqus_thread" data-disqus-identifier="cache/posts/exact-diagonalization.html">评论</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="%E7%B2%BE%E7%A1%AE%E5%AF%B9%E8%A7%92%E5%8C%96">精确对角化<a class="anchor-link" href="posts/exact-diagonalization/#%E7%B2%BE%E7%A1%AE%E5%AF%B9%E8%A7%92%E5%8C%96">¶</a>
</h2>
<p>参考材料：</p>
<ol>
<li>Anders W. Sandvik 的综述 <a href="https://arxiv.org/abs/1101.3281">Computational Studies of Quantum Spin Systems</a>
</li>
<li>以及他的课程ppt <a href="https://physics.bu.edu/~sandvik/vietri/index.html">XIV Training Course in the Physics of Strongly Correlated Systems </a>
</li>
<li>Ralf Schneider, et.al. "Computational Many-Particle Physics" 的第 18 章</li>
</ol>
<p>精确对角化实际上就是把哈密顿量写成矩阵表示，然后再求这个矩阵的最小本征值和本征矢，也就是基态和基态能量。</p>
<p>对于单电子图像的哈密顿量是很容易表示成矩阵形式的，多体哈密顿量的直接表示也不是很难。但是由于多体系统随着尺寸增加，矩阵的维数迅速增大，很容易就会超过计算机甚至超算的内存能力。所以精确对角化方法的核心就是如何利用系统的对称性把哈密顿量的矩阵划分成更小的矩阵。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>下面先以海森堡自旋 $\frac{1}{2}$ 链为例说明如何利用对称性划分哈密顿量矩阵。最后再给出一个利用这些对称性的 Fermi-Hubbard 模型例子。其它所有一维电子模型都可以用与这两个例子类似的方法实现。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="%E7%9B%B4%E6%8E%A5%E8%A1%A8%E7%A4%BA%E5%93%88%E5%AF%86%E9%A1%BF%E9%87%8F%E7%9A%84%E7%9F%A9%E9%98%B5">直接表示哈密顿量的矩阵<a class="anchor-link" href="posts/exact-diagonalization/#%E7%9B%B4%E6%8E%A5%E8%A1%A8%E7%A4%BA%E5%93%88%E5%AF%86%E9%A1%BF%E9%87%8F%E7%9A%84%E7%9F%A9%E9%98%B5">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Heisenberg $S= \frac{1}{2}$ 链
$$ H = J\sum_{i=1}^{N} S_i \cdot S_{i+1} = J \sum_{i=1}^{N} \left( S_i^xS_{i+1}^x+S_i^yS_{i+1}^y+S_i^zS_{i+1}^z \right) $$
$$ H = J \sum_{i=1}^{N} \left[ \frac{1}{2} \left( S_i^+S_{i+1}^-+S_i^-S_{i+1}^+ \right) + S_i^zS_{i+1}^z \right] $$</p>
<p>为了简化起见，下面都取 $J=1$ ，即反铁磁Heisenberg模型。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="%E7%AE%97%E7%AC%A6%E5%BC%A0%E9%87%8F%E7%A7%AF%E6%9E%84%E9%80%A0%E5%93%88%E5%AF%86%E9%A1%BF%E9%87%8F">算符张量积构造哈密顿量<a class="anchor-link" href="posts/exact-diagonalization/#%E7%AE%97%E7%AC%A6%E5%BC%A0%E9%87%8F%E7%A7%AF%E6%9E%84%E9%80%A0%E5%93%88%E5%AF%86%E9%A1%BF%E9%87%8F">¶</a>
</h4>
<p>一般单粒子的哈密顿量都会由算符的张量积构造得到，如下</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">tensor_product</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>首先定义每个格点上的算符</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">Sz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">Sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="n">Sm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="n">II</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>接下来把所有格点的项全部加起来，这里以4个格点为例</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">H</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">tensor_product</span><span class="p">(</span><span class="n">Sp</span><span class="p">,</span> <span class="n">Sm</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">)</span> <span class="o">+</span> <span class="n">tensor_product</span><span class="p">(</span><span class="n">Sm</span><span class="p">,</span> <span class="n">Sp</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">tensor_product</span><span class="p">(</span><span class="n">Sz</span><span class="p">,</span> <span class="n">Sz</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">)</span>
    <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">tensor_product</span><span class="p">(</span><span class="n">II</span><span class="p">,</span> <span class="n">Sp</span><span class="p">,</span> <span class="n">Sm</span><span class="p">,</span> <span class="n">II</span><span class="p">)</span> <span class="o">+</span> <span class="n">tensor_product</span><span class="p">(</span><span class="n">II</span><span class="p">,</span> <span class="n">Sm</span><span class="p">,</span> <span class="n">Sp</span><span class="p">,</span> <span class="n">II</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">tensor_product</span><span class="p">(</span><span class="n">II</span><span class="p">,</span> <span class="n">Sz</span><span class="p">,</span> <span class="n">Sz</span><span class="p">,</span> <span class="n">II</span><span class="p">)</span>
    <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">tensor_product</span><span class="p">(</span><span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">Sp</span><span class="p">,</span> <span class="n">Sm</span><span class="p">)</span> <span class="o">+</span> <span class="n">tensor_product</span><span class="p">(</span><span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">Sm</span><span class="p">,</span> <span class="n">Sp</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">tensor_product</span><span class="p">(</span><span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">Sz</span><span class="p">,</span> <span class="n">Sz</span><span class="p">)</span>
    <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">tensor_product</span><span class="p">(</span><span class="n">Sm</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">Sp</span><span class="p">)</span> <span class="o">+</span> <span class="n">tensor_product</span><span class="p">(</span><span class="n">Sp</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">Sm</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">tensor_product</span><span class="p">(</span><span class="n">Sz</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">Sz</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">H111</span> <span class="o">=</span> <span class="n">H</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>有了哈密顿量矩阵就可以对它进行对角化求基态了，这里调用 Arpack 求最小的本征值</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">eigsh</span>

<span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">eigsh</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">"SA"</span><span class="p">)</span>
<span class="n">eigvals</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[4]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>array([-4.44948974])</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="%E6%A0%B9%E6%8D%AE%E5%9F%BA%E7%9F%A2%E6%9E%84%E9%80%A0%E5%93%88%E5%AF%86%E9%A1%BF%E9%87%8F">根据基矢构造哈密顿量<a class="anchor-link" href="posts/exact-diagonalization/#%E6%A0%B9%E6%8D%AE%E5%9F%BA%E7%9F%A2%E6%9E%84%E9%80%A0%E5%93%88%E5%AF%86%E9%A1%BF%E9%87%8F">¶</a>
</h4>
<p>从上面最一般的过程能看出，构造哈密顿量需要做大量的张量积计算，而且这些张量积中乘的项大多数都是单位矩阵，也就是说哈密顿量矩阵是非常稀疏的，所以我们其实可以用稀疏矩阵来表示哈密顿量，并且直接找到有数字的那些基矢，往哈密顿量里填数字就行了。</p>
<p>在上面的张量积构造过程中我们实际上取的表象是按照格点顺序排列的，即
$$
\begin{array}{lll}
|0\rangle &amp;= |\uparrow\uparrow\uparrow\uparrow\rangle     &amp;= (0000) \\
|1\rangle &amp;= |\uparrow\uparrow\uparrow\downarrow\rangle   &amp;= (0001) \\
|2\rangle &amp;= |\uparrow\uparrow\downarrow\uparrow\rangle   &amp;= (0010) \\
|3\rangle &amp;= |\uparrow\uparrow\downarrow\downarrow\rangle &amp;= (0011) \\
\cdots &amp;= \cdots &amp;= \cdots
\end{array}
$$
很容易发现基矢的表示自然地与数字的二进制联系起来了，因为每个格点恰好也只有两种可能的基矢，上下自旋分别对应于数字0和1。</p>
<p>这样我们就得到了一个关系
$$
\begin{array}{llll}
S^z &amp;\Rightarrow &amp; 0\rightarrow 0 &amp; 1\rightarrow 1 \\
S^- &amp;\Rightarrow &amp; 0\rightarrow \emptyset &amp; 1\rightarrow 0 \\
S^+ &amp;\Rightarrow &amp; 0\rightarrow 1 &amp; 1\rightarrow \emptyset
\end{array}
$$
即，$S^z$ 作用无效果，$S^-$ 相当于如果bit是0就翻转为1，如果是1，这个基矢就消失掉。</p>
<p>综合起来，对于最近邻的两个态的四种情况，哈密顿量的作用结果为
$$
\begin{array}{lllll}
               &amp;   (00)   &amp;     (01)   &amp;     (10)   &amp;     (11) \\
S_i^zS_{i+1}^z &amp;   (00)   &amp;   -1(01)   &amp;   -1(10)   &amp;     (11) \\
S_i^+S_{i+1}^- &amp;\emptyset &amp;     (10)   &amp;\emptyset   &amp;\emptyset \\
S_i^-S_{i+1}^+ &amp;\emptyset &amp;\emptyset   &amp;     (01)   &amp;\emptyset
\end{array}
$$</p>
<p>接下来只要遍历所有的基矢，并在每个基矢上作用一遍哈密顿量的所有项，找到对应的基矢，把这两个基矢作为指标填上数字就行了。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_state_index</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""获得一个整数某位置处的二进制值"""</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">index</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">state</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">index</span>


<span class="k">def</span> <span class="nf">flip_state</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""翻转一个整数某位置处的二进制值"""</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">index</span>
    <span class="k">return</span> <span class="n">state</span> <span class="o">^</span> <span class="n">mask</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">**</span> <span class="n">N</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">N</span><span class="p">))</span>

<span class="c1"># a is a basis</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">N</span><span class="p">):</span>
    <span class="c1"># i is position of this basis</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="c1"># j is the nearest neighbor, mod N for periodic boundary conditions</span>
        <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span>
        <span class="n">ai</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">aj</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

        <span class="c1"># Sz</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
        <span class="k">if</span> <span class="n">ai</span> <span class="o">==</span> <span class="n">aj</span><span class="p">:</span>
            <span class="n">H</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">H</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># SxSx + SySy</span>
        <span class="k">if</span> <span class="n">ai</span> <span class="o">!=</span> <span class="n">aj</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">flip_state</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">flip_state</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="n">H</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">H112</span> <span class="o">=</span> <span class="n">H</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>这样直接构造的结果与张量积乘出来的哈密顿量当然是一样的</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">eigsh</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">"SA"</span><span class="p">)</span>
<span class="n">eigvals</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">H112</span> <span class="o">-</span> <span class="n">H111</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[7]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>(array([-4.44948974]), True)</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="%E5%88%A9%E7%94%A8%E5%AF%B9%E7%A7%B0%E6%80%A7%EF%BC%9A%E7%BB%84%E5%90%88%E5%9E%8B">利用对称性：组合型<a class="anchor-link" href="posts/exact-diagonalization/#%E5%88%A9%E7%94%A8%E5%AF%B9%E7%A7%B0%E6%80%A7%EF%BC%9A%E7%BB%84%E5%90%88%E5%9E%8B">¶</a>
</h3>
<p>从基矢构造哈密顿量的过程实际上分为两步，首先要确定基矢的总数和表象，之前我们取得表象就是最自然的全部排列，一共有 $2^N$ 个，然后把这些基矢按照哈密顿量的规则变换成另一组基矢，两组基矢作为哈密顿量矩阵的两个指标来填数字。</p>
<p>利用对称性主要就是改变前一步，不同的对称性子空间实际上限制的是基矢的数目，只要我们把某个子空间中的全部基矢找到，再用这组基矢构造哈密顿量，得到的就是这个对称性子空间中的哈密顿量了。只要把所有子空间都对角化一遍，自然就能得到全部的本征态。</p>
<p>这里先利用的对称性是最简单的一类，这些对称性只与基矢的总数有关，而与基矢内部的排列方式无关，例如总磁矩和总粒子数。总磁矩就是把每个格点上的磁矩全部加起来，总粒子数同样就是把每个格点上的粒子数加起来。总和一样的那些基矢就全部属于同一个子空间。反过来看，也可以是一个总的量子数在所有格点上的不同组合。</p>
<p>这里利用的是Heisenberg模型的总磁矩守恒
$$S^z_{\mathrm{tot}} = \sum_i s[i] $$
例如 $|0011\rangle, |1010\rangle$ 这两个态的总磁矩就是一样的，都是 $1$。</p>
<p>所以找到总磁矩为 1 的所有基矢有两种方法，一是遍历一遍所有的态，二是按照组合数的方式找到N个格点中取2个的所有组合。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="c1"># 这里的总自旋写2是因为总的因子 1/2 被省略了</span>
<span class="n">Nz</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">state_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">N</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">bin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">"1"</span><span class="p">)</span> <span class="o">==</span> <span class="n">Nz</span><span class="p">:</span>
        <span class="n">state_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="n">state_list</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[8]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>[3, 5, 6, 9, 10, 12]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>

<span class="n">state_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">Nz</span><span class="p">)]</span>
<span class="n">state_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">state_list</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[9]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>[3, 5, 6, 9, 10, 12]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>接下来就是利用已经找到的这些基矢来构造哈密顿量，构造的过程完全一样，只是要注意，判断基矢规则时要用原来的基矢，之后要把这个基矢对应到新的子空间基矢里。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">state_list</span><span class="p">),)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">new_a</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span>
        <span class="n">ai</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">aj</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

        <span class="c1"># Sz</span>
        <span class="n">new_b</span> <span class="o">=</span> <span class="n">new_a</span>
        <span class="k">if</span> <span class="n">ai</span> <span class="o">==</span> <span class="n">aj</span><span class="p">:</span>
            <span class="n">H</span><span class="p">[</span><span class="n">new_a</span><span class="p">,</span> <span class="n">new_b</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">H</span><span class="p">[</span><span class="n">new_a</span><span class="p">,</span> <span class="n">new_b</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># SxSx + SySy</span>
        <span class="k">if</span> <span class="n">ai</span> <span class="o">!=</span> <span class="n">aj</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">flip_state</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">flip_state</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="n">new_b</span> <span class="o">=</span> <span class="n">state_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="n">H</span><span class="p">[</span><span class="n">new_a</span><span class="p">,</span> <span class="n">new_b</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>可以发现对于4格点周期边界情况，基态是在总自旋为1的空间里的，因为这是个反铁磁的Heisenberg链。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">eigsh</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">"SA"</span><span class="p">)</span>
<span class="n">eigvals</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[11]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>array([-4.44948974])</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="%E5%88%A9%E7%94%A8%E5%AF%B9%E7%A7%B0%E6%80%A7%EF%BC%9A%E5%B9%B3%E7%A7%BB%E5%AF%B9%E7%A7%B0%E6%80%A7">利用对称性：平移对称性<a class="anchor-link" href="posts/exact-diagonalization/#%E5%88%A9%E7%94%A8%E5%AF%B9%E7%A7%B0%E6%80%A7%EF%BC%9A%E5%B9%B3%E7%A7%BB%E5%AF%B9%E7%A7%B0%E6%80%A7">¶</a>
</h3>
<p>一维周期边界的链满足平移对称性，平移算符的本征态可以表示为
$$T | n \rangle = e^{ik}|n\rangle, k = m \frac{2\pi}{N}, m=0,1,\cdots,N-1$$
平移算符的作用就是把态在格点上移动一个
$$T | S^z_1, S^z_2, \cdots, S^z_N \rangle = | S^z_N, S^z_1, \cdots, S^z_{N-1} \rangle $$</p>
<p>在平移算符的本征子空间中的基矢可以由投影算符构造
$$ P_k = \frac{1}{L} \sum_r^{L-1} e^{ i \frac{2\pi}{L} k r } T^r$$
例如从 $|0011\rangle$ 生成的一组基矢为
$$ P_k |0011\rangle = \frac{1}{4} \left( |0011\rangle 
+ e^{i \frac{2\pi}{4} k \cdot 1} |0110\rangle 
+ e^{i \frac{2\pi}{4} k \cdot 2} |1100\rangle 
+ e^{i \frac{2\pi}{4} k \cdot 3} |1001\rangle \right) $$
这样就能够得到一组基矢，可以记作 $|r^a(k)\rangle=P_k|r^a\rangle$ ，对于其它的初始基矢还可以得到其它组基矢，记作 $|r^b(k)\rangle=P_k|r^b\rangle$ 等。</p>
<p>那么在这一组新的基矢 $\left\lbrace|r(k)\rangle\right\rbrace$ 下的哈密顿量一共有$L$ 个，分别对应 $k=0,1,\cdots,L-1$，它的矩阵元为
$$ H_{mn} = \langle r^m(k) | H | r^n(k) \rangle =  \langle r^m| P_k H P_k | r^n \rangle = \langle r^m| P_k H | r^n \rangle$$
其中用到 $[P_k, H]=0$ 因为 $[T,H]=0$ ，和 $P_k^2=P_k$ 因为 $P_k$ 是投影算符。注意：这里所有计算过程中保持归一化。</p>
<p>所以计算这个新的哈密顿量块只需要把每组新基矢在哈密顿量作用下进行变换，再求这个基矢与 $k=0$ 时的那个基矢的内积就行了。因为 $|r^a(k=0)\rangle = |r^a\rangle$ 。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">state_cycle_shift</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">shift</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""循环移位操作"""</span>
    <span class="n">low</span> <span class="o">=</span> <span class="n">state</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="n">shift</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="n">shift</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">high</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&amp;</span> <span class="n">state</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">high</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span><span class="p">)</span> <span class="o">+</span> <span class="n">low</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>首先要从所有态里面把属于同一组的找出来</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">state_list_temp</span> <span class="o">=</span> <span class="n">state_list</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">state_k_all</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_list_temp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">state_k_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">s_first</span> <span class="o">=</span> <span class="n">state_list_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s_first</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">state_k_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">state_list_temp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">s_next</span> <span class="o">=</span> <span class="n">state_cycle_shift</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s_next</span> <span class="o">==</span> <span class="n">s_first</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s_next</span>

    <span class="n">state_k_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">state_k_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_k_list</span><span class="p">)</span>

<span class="n">state_k_all</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[13]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>[[3, 6, 9, 12], [5, 10]]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>然后就可以构造哈密顿量了，构造哈密顿量的过程中需要计算哈密顿量与基矢的乘积，这里直接把基矢构造成矩阵，把最后一步整合成矩阵乘法了，否则的话要写嵌套4层循环才行。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Hk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">state_k_all</span><span class="p">),)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>

<span class="k">for</span> <span class="n">new_b</span><span class="p">,</span> <span class="n">b_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state_k_all</span><span class="p">):</span>

    <span class="c1"># build state_b</span>
    <span class="n">state_new_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_list</span><span class="p">)))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rb</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">b_list</span><span class="p">):</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">state_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">state_new_b</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">state_new_b</span> <span class="o">=</span> <span class="n">state_new_b</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">state_new_b</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">new_a</span><span class="p">,</span> <span class="n">a_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state_k_all</span><span class="p">):</span>
        <span class="n">state_new_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">state_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>

        <span class="c1"># build state_a</span>
        <span class="n">state_new_a_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">state_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ra</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a_list</span><span class="p">):</span>
            <span class="n">ia</span> <span class="o">=</span> <span class="n">state_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">state_new_a_temp</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">N</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">ra</span><span class="p">)</span>
        <span class="n">state_new_a_temp</span> <span class="o">=</span> <span class="n">state_new_a_temp</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">state_new_a_temp</span><span class="p">)</span>

        <span class="c1"># H @ state_a</span>
        <span class="k">for</span> <span class="n">ra</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a_list</span><span class="p">):</span>
            <span class="n">ia</span> <span class="o">=</span> <span class="n">state_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span>
                <span class="n">ai</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">aj</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                <span class="c1"># Sz</span>
                <span class="n">new_ia</span> <span class="o">=</span> <span class="n">ia</span>
                <span class="k">if</span> <span class="n">ai</span> <span class="o">==</span> <span class="n">aj</span><span class="p">:</span>
                    <span class="n">state_new_a</span><span class="p">[</span><span class="n">new_ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">state_new_a_temp</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">state_new_a</span><span class="p">[</span><span class="n">new_ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">state_new_a_temp</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                <span class="c1"># SxSx + SySy</span>
                <span class="k">if</span> <span class="n">ai</span> <span class="o">!=</span> <span class="n">aj</span><span class="p">:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">flip_state</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">flip_state</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                    <span class="n">new_ib</span> <span class="o">=</span> <span class="n">state_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="n">state_new_a</span><span class="p">[</span><span class="n">new_ib</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">state_new_a_temp</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Hk</span>
        <span class="n">Hk</span><span class="p">[</span><span class="n">new_a</span><span class="p">,</span> <span class="n">new_b</span><span class="p">]</span> <span class="o">=</span> <span class="n">state_new_b</span> <span class="o">@</span> <span class="n">state_new_a</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>这里构造得到的 $k=0$ 子空间只有 $2\times 2$ 维，从这里计算得到的也是基态。一般来说，基态总是在 $k=0$ 的子空间中。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">Hk</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[15]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>array([-4.44948974,  0.44948974])</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="%E5%88%A9%E7%94%A8%E5%AF%B9%E7%A7%B0%E6%80%A7%EF%BC%9A%E5%85%B6%E5%AE%83%E7%A6%BB%E6%95%A3%E5%AF%B9%E7%A7%B0%E6%80%A7">利用对称性：其它离散对称性<a class="anchor-link" href="posts/exact-diagonalization/#%E5%88%A9%E7%94%A8%E5%AF%B9%E7%A7%B0%E6%80%A7%EF%BC%9A%E5%85%B6%E5%AE%83%E7%A6%BB%E6%95%A3%E5%AF%B9%E7%A7%B0%E6%80%A7">¶</a>
</h3>
<p>除了总磁矩和平移对称性之外还有一些其它的离散对称性，例如对于 $k=0,\pi$ 时有宇称对称性和自旋翻转对称性等等。但是这些对称性与平移对称性并不对易，所以不能从平移对称性的结果中继续细分，而是要联合平移对称性一起去找基矢。</p>
<p>比如联合使用平移对称性和宇称对称性，要同时考虑平移算符和宇称算符来构造基矢，例如
$$ \mathcal{P}_k = \frac{1}{L} \sum_r^{L-1} C^\sigma\left( \frac{2\pi}{L} k r \right) T^r (1+P) $$
$$ C^\sigma\left( \frac{2\pi}{L} k r \right) = \left\lbrace \begin{array}{ll} 
\cos( \frac{2\pi}{L} k r), &amp; p = 1 \\
\sin( \frac{2\pi}{L} k r), &amp; p = -1
\end{array} \right. $$</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>程序待写</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Fermi-Hubbard-%E6%A8%A1%E5%9E%8B">Fermi-Hubbard 模型<a class="anchor-link" href="posts/exact-diagonalization/#Fermi-Hubbard-%E6%A8%A1%E5%9E%8B">¶</a>
</h3>
<p>$$ H = -t \sum_{i,\sigma} \left( c^\dagger_{i,\sigma} c_{i+1,\sigma} + c^\dagger_{i+1,\sigma} c_{i,\sigma}  \right) + U \sum_{i} n_{i\uparrow}n_{i\downarrow}$$</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>首先定义哈密顿量作用到基矢上的结果，基本原则就是如果作用有效果就返回作用后的基矢，如果作用为0就返回 <code>None</code>。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>


<span class="k">def</span> <span class="nf">check_U</span><span class="p">(</span><span class="n">state_up</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">state_down</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
    <span class="n">state_up_i</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">state_up</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">state_down_i</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">state_down</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">state_up_i</span> <span class="o">==</span> <span class="n">state_down_i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">state_up</span><span class="p">,</span> <span class="n">state_down</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">check_t</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">N</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
    <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span>
    <span class="n">state_i</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">state_j</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">state_i</span><span class="p">,</span> <span class="n">state_j</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">state_i</span><span class="p">,</span> <span class="n">state_j</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">state_new</span> <span class="o">=</span> <span class="n">flip_state</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">state_new</span> <span class="o">=</span> <span class="n">flip_state</span><span class="p">(</span><span class="n">state_new</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state_new</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>先实现一个全对角化，以此作为检查标准。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span> <span class="o">**</span> <span class="n">N</span><span class="p">,</span> <span class="mi">4</span> <span class="o">**</span> <span class="n">N</span><span class="p">))</span>
<span class="n">al</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">a_up</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">N</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">a_down</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">N</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_up</span> <span class="o">&lt;&lt;</span> <span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="n">a_down</span>
        <span class="n">al</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="c1"># t</span>
            <span class="n">b_up</span> <span class="o">=</span> <span class="n">check_t</span><span class="p">(</span><span class="n">a_up</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b_up</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_up</span> <span class="o">&lt;&lt;</span> <span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="n">a_down</span>
                <span class="n">H</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">t</span>

            <span class="n">b_down</span> <span class="o">=</span> <span class="n">check_t</span><span class="p">(</span><span class="n">a_down</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b_down</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_up</span> <span class="o">&lt;&lt;</span> <span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="n">b_down</span>
                <span class="n">H</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">t</span>

            <span class="c1"># U</span>
            <span class="n">b_result</span> <span class="o">=</span> <span class="n">check_U</span><span class="p">(</span><span class="n">a_up</span><span class="p">,</span> <span class="n">a_down</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="n">b_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">H</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">+=</span> <span class="n">U</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># eigvals, eigvecs = eigsh(H, k=1, which='SA')</span>
<span class="c1"># eigvals</span>
<span class="n">eigvals_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>首先利用粒子数对称性，这里考虑的是粒子数的分别守恒，总数守恒就把两组整数一起组合就行了。</p>
<p>这里取半满且两种自旋数目相同。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">Nup</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">Ndown</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">1</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>

<span class="n">state_up_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">Nup</span><span class="p">)]</span>
<span class="n">state_up_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">state_down_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">Ndown</span><span class="p">)]</span>
<span class="n">state_down_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">state_total_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">state_up_list</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">state_down_list</span><span class="p">]</span>
<span class="n">state_up_list</span><span class="p">,</span> <span class="n">state_down_list</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[19]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>([3, 5, 6, 9, 10, 12], [3, 5, 6, 9, 10, 12])</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>接下来找平移对称性，因为有两组基矢，所以平移的时候要同时对它们都操作。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">state_list_temp</span> <span class="o">=</span> <span class="n">state_total_list</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">state_k_all</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_list_temp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">state_k_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">s_first</span> <span class="o">=</span> <span class="n">state_list_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s_first</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">state_k_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">state_list_temp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="n">s0_next</span> <span class="o">=</span> <span class="n">state_cycle_shift</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="n">s1_next</span> <span class="o">=</span> <span class="n">state_cycle_shift</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="n">s_next</span> <span class="o">=</span> <span class="p">(</span><span class="n">s0_next</span><span class="p">,</span> <span class="n">s1_next</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">s_next</span> <span class="o">==</span> <span class="n">s_first</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s_next</span>

    <span class="n">state_k_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">state_k_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_k_list</span><span class="p">)</span>

<span class="c1"># state_k_all</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>接下来就构造哈密顿量。</p>
<p>这里取动量为$0$。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Hk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">state_k_all</span><span class="p">),)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>

<span class="k">for</span> <span class="n">new_b</span><span class="p">,</span> <span class="n">b_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state_k_all</span><span class="p">):</span>

    <span class="c1"># build state_b</span>
    <span class="n">state_new_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_total_list</span><span class="p">)))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rb</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">b_list</span><span class="p">):</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">state_total_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">state_new_b</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">state_new_b</span> <span class="o">=</span> <span class="n">state_new_b</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">state_new_b</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">new_a</span><span class="p">,</span> <span class="n">a_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state_k_all</span><span class="p">):</span>
        <span class="n">state_new_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">state_total_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>

        <span class="c1"># build state_a</span>
        <span class="n">state_new_a_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">state_total_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ra</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a_list</span><span class="p">):</span>
            <span class="n">ia</span> <span class="o">=</span> <span class="n">state_total_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">state_new_a_temp</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">N</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">ra</span><span class="p">)</span>
        <span class="n">state_new_a_temp</span> <span class="o">=</span> <span class="n">state_new_a_temp</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">state_new_a_temp</span><span class="p">)</span>

        <span class="c1"># H @ state_a</span>
        <span class="k">for</span> <span class="n">ra</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a_list</span><span class="p">):</span>
            <span class="n">a_up</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">a_down</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ia</span> <span class="o">=</span> <span class="n">state_total_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>

                <span class="c1"># t</span>
                <span class="n">b_up</span> <span class="o">=</span> <span class="n">check_t</span><span class="p">(</span><span class="n">a_up</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">b_up</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_up</span><span class="p">,</span> <span class="n">a_down</span><span class="p">)</span>
                    <span class="n">new_ib</span> <span class="o">=</span> <span class="n">state_total_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="n">state_new_a</span><span class="p">[</span><span class="n">new_ib</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">t</span> <span class="o">*</span> <span class="n">state_new_a_temp</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                <span class="n">b_down</span> <span class="o">=</span> <span class="n">check_t</span><span class="p">(</span><span class="n">a_down</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">b_down</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_up</span><span class="p">,</span> <span class="n">b_down</span><span class="p">)</span>
                    <span class="n">new_ib</span> <span class="o">=</span> <span class="n">state_total_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="n">state_new_a</span><span class="p">[</span><span class="n">new_ib</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">t</span> <span class="o">*</span> <span class="n">state_new_a_temp</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                <span class="c1"># U</span>
                <span class="n">b_result</span> <span class="o">=</span> <span class="n">check_U</span><span class="p">(</span><span class="n">a_up</span><span class="p">,</span> <span class="n">a_down</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">b_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">b_result</span>
                    <span class="n">new_ib</span> <span class="o">=</span> <span class="n">state_total_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="n">state_new_a</span><span class="p">[</span><span class="n">new_ib</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">state_new_a_temp</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Hk</span>
        <span class="n">Hk</span><span class="p">[</span><span class="n">new_a</span><span class="p">,</span> <span class="n">new_b</span><span class="p">]</span> <span class="o">=</span> <span class="n">state_new_b</span> <span class="o">@</span> <span class="n">state_new_a</span>

<span class="c1"># Hk</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>对角化一下新构造的哈密顿量，这个新哈密顿量的所有本征值都在全哈密顿量的谱里，这说明写对了。</p>
<p>从这个结果中我们知道，Fermi-Hubbard 模型的基态既是半满的，又是动量为$0$的。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">eigvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">Hk</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">eigvals</span><span class="p">:</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eigvals_all</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">eigvals_all</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">x</span><span class="p">),</span> <span class="n">eigvals_all</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>True -4.723265519527195 -4.723265519527192
True 1.3836255242112377e-16 1.1102230246251525e-16
True 0.5058018686891442 0.5058018686891443
True 0.9999999999999989 0.999999999999999
True 0.9999999999999996 0.9999999999999996
True 1.0 1.0
True 1.0000000000000002 1.0000000000000002
True 1.4941981313108506 1.494198131310855
True 2.0 2.0
True 6.723265519527201 6.723265519527191
</pre>
</div>
</div>
</div>
</div>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/gram-schmidt-orthogonalization/" class="u-url">Gram-Schmidt Orthogonalization</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        chimez
                    </span></p>
            <p class="dateline">
            <a href="posts/gram-schmidt-orthogonalization/" rel="bookmark">
            <time class="published dt-published" datetime="2020-12-19T16:11:37+08:00" itemprop="datePublished" title="2020-12-19 16:11">2020-12-19 16:11</time></a>
            </p>
                        <p class="commentline">
    
    <a href="posts/gram-schmidt-orthogonalization/#disqus_thread" data-disqus-identifier="cache/posts/gram-schmidt-orthogonalization.html">评论</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Gram-Schmidt-%E6%AD%A3%E4%BA%A4%E5%8C%96%E6%96%B9%E6%B3%95">Gram-Schmidt 正交化方法<a class="anchor-link" href="posts/gram-schmidt-orthogonalization/#Gram-Schmidt-%E6%AD%A3%E4%BA%A4%E5%8C%96%E6%96%B9%E6%B3%95">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>把一组向量正交化的常用方法就是 Gram-Schmidt 正交化过程。
这个过程基于投影
$$
\mathrm{proj}_u(v) = \frac{\langle u,v \rangle}{\langle u , u \rangle} u
$$
每一次迭代得到一个与之前所有矢量都正交的新矢量
$$
\begin{array}{lll}
b_1 &amp;=&amp; a_1 \\
b_2 &amp;=&amp; a_2 - \mathrm{proj}_{b_1}(a_2) \\
b_3 &amp;=&amp; a_3 - \mathrm{proj}_{b_1}(a_3) - \mathrm{proj}_{b_2}(a_3) \\
b_k &amp;=&amp; a_k - \sum_{i=1}^{k-1}\mathrm{proj}_{b_i}(a_k)
\end{array}
$$</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">proj</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">do_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">do_norm</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">gram_schmidt</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">b</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> 
                  <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span>
                      <span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">proj</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">b</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> 
                      <span class="mi">0</span><span class="p">,</span> 
                      <span class="n">b</span><span class="p">[:,:</span><span class="n">i</span><span class="p">]),</span>
                           <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="n">b</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">b</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">b</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">gram_schmidt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">b</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">@</span> <span class="n">b</span><span class="p">[:,</span><span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>True
True
True
True
True
True
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/power-method-for-eigenvalues/" class="u-url">Power Method for Eigenvalues</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        chimez
                    </span></p>
            <p class="dateline">
            <a href="posts/power-method-for-eigenvalues/" rel="bookmark">
            <time class="published dt-published" datetime="2020-12-19T15:20:52+08:00" itemprop="datePublished" title="2020-12-19 15:20">2020-12-19 15:20</time></a>
            </p>
                        <p class="commentline">
    
    <a href="posts/power-method-for-eigenvalues/#disqus_thread" data-disqus-identifier="cache/posts/power-method-for-eigenvalues.html">评论</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="%E5%B9%82%E6%B3%95%EF%BC%9A%E7%9F%A9%E9%98%B5%E6%9C%AC%E5%BE%81%E5%80%BC%E8%BF%AD%E4%BB%A3%E6%B1%82%E8%A7%A3%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%96%B9%E6%B3%95">幂法：矩阵本征值迭代求解的基本方法<a class="anchor-link" href="posts/power-method-for-eigenvalues/#%E5%B9%82%E6%B3%95%EF%BC%9A%E7%9F%A9%E9%98%B5%E6%9C%AC%E5%BE%81%E5%80%BC%E8%BF%AD%E4%BB%A3%E6%B1%82%E8%A7%A3%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%96%B9%E6%B3%95">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%B9%82%E6%B3%95%EF%BC%9A%E6%B1%82%E7%9F%A9%E9%98%B5%E7%9A%84%E6%9C%80%E5%A4%A7%E6%9C%AC%E5%BE%81%E5%80%BC">基本的幂法：求矩阵的最大本征值<a class="anchor-link" href="posts/power-method-for-eigenvalues/#%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%B9%82%E6%B3%95%EF%BC%9A%E6%B1%82%E7%9F%A9%E9%98%B5%E7%9A%84%E6%9C%80%E5%A4%A7%E6%9C%AC%E5%BE%81%E5%80%BC">¶</a>
</h3>
<p>$$
Ax^{(k)} = x^{(k+1)}
$$</p>
<p>只要把任何一个初始随机向量反复地被一个矩阵作用，同时除以一个足够大的数保证不超过数值精度，那么最终的收敛结果就是矩阵的最大本征矢。</p>
<p>这种方法可行的原因是，矩阵可以看做是一个线性变换，对任何一个向量连续地作用同一个变换的结果，总是会让这个向量趋近于变换的主向量，也就是矩阵的最大本征值对应的本征矢。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">power_iteration</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">num_simulations</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">v0</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">v0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">v</span> <span class="o">=</span> <span class="n">v0</span>
        
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_simulations</span><span class="p">):</span>     
        <span class="n">v</span> <span class="o">=</span> <span class="n">A</span> <span class="o">@</span> <span class="n">v</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">e2</span><span class="p">,</span><span class="n">v2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">ei2</span> <span class="o">=</span> <span class="n">e2</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
<span class="n">e2</span><span class="p">[</span><span class="n">ei2</span><span class="p">],</span> <span class="n">v2</span><span class="p">[:,</span><span class="n">ei2</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v2</span><span class="p">[:,</span><span class="n">ei2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[3]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>((2.1973691032607885+0j),
 array([0.54317076+0.j, 0.56821252+0.j, 0.28769568+0.j, 0.54711174+0.j]))</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">v1</span> <span class="o">=</span> <span class="n">power_iteration</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="p">(</span><span class="n">a</span> <span class="o">@</span> <span class="n">v1</span> <span class="o">/</span> <span class="n">v1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v1</span><span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[4]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>(2.197369103260788, array([0.54317076, 0.56821252, 0.28769568, 0.54711174]))</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="%E5%8F%8D%E5%B9%82%E6%B3%95%EF%BC%9A%E6%B1%82%E7%9F%A9%E9%98%B5%E7%9A%84%E6%9C%80%E5%B0%8F%E6%9C%AC%E5%BE%81%E7%9F%A2">反幂法：求矩阵的最小本征矢<a class="anchor-link" href="posts/power-method-for-eigenvalues/#%E5%8F%8D%E5%B9%82%E6%B3%95%EF%BC%9A%E6%B1%82%E7%9F%A9%E9%98%B5%E7%9A%84%E6%9C%80%E5%B0%8F%E6%9C%AC%E5%BE%81%E7%9F%A2">¶</a>
</h3>
<p>与幂法完全相同，只不过迭代的是矩阵的逆，显然矩阵的逆的最大本征值就是原矩阵的模最小的本征值。
$$
A^{-1}x^{(k)} = x^{(k+1)}
$$
不过由于矩阵求逆计算复杂度很大，可以把它转化成求线性方程组：
$$
A x^{(k+1)} = x^{(k)}
$$</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">inverse_power_iteration</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">num_simulations</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">v0</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">v0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">v</span> <span class="o">=</span> <span class="n">v0</span>
        
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_simulations</span><span class="p">):</span>  
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> 
        <span class="c1"># v = np.linalg.inv(A) @ v</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
    
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">e2</span><span class="p">,</span><span class="n">v2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">ei2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
<span class="n">e2</span><span class="p">[</span><span class="n">ei2</span><span class="p">],</span> <span class="n">v2</span><span class="p">[:,</span><span class="n">ei2</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v2</span><span class="p">[:,</span><span class="n">ei2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[6]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>(0.0934634074161824,
 array([ 0.06236468, -0.34577788,  0.87179586, -0.34135067]))</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">v1</span> <span class="o">=</span> <span class="n">inverse_power_iteration</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="mi">1</span><span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">@</span> <span class="n">v1</span> <span class="o">/</span> <span class="n">v1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v1</span><span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[7]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>(0.09346340741618211,
 array([ 0.06236468, -0.34577788,  0.87179586, -0.34135067]))</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/nikola-static-site-generator/" class="u-url">nikola: static site generator</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        chimez
                    </span></p>
            <p class="dateline">
            <a href="posts/nikola-static-site-generator/" rel="bookmark">
            <time class="published dt-published" datetime="2020-12-19T15:19:12+08:00" itemprop="datePublished" title="2020-12-19 15:19">2020-12-19 15:19</time></a>
            </p>
                        <p class="commentline">
    
    <a href="posts/nikola-static-site-generator/#disqus_thread" data-disqus-identifier="cache/posts/nikola-static-site-generator.html">评论</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div id="outline-container-org07a492a" class="outline-2">
<h2 id="org07a492a">Nikola: 基本用法</h2>
<div class="outline-text-2" id="text-org07a492a">
<p>
Nikola 是一个 python 写的静态博客生成器。参见官网<a href="https://getnikola.com">getnikola</a> 。主要的特色是原生支持 orgmode 和 ipynb 格式作为博客，看起来很方便。
</p>
</div>
</div>



<div id="outline-container-orgb250231" class="outline-2">
<h2 id="orgb250231">备查资料</h2>
<div class="outline-text-2" id="text-orgb250231">
</div>
<div id="outline-container-orgfe3da07" class="outline-3">
<h3 id="orgfe3da07">时间的格式</h3>
<div class="outline-text-3" id="text-orgfe3da07">
<div class="highlight"><pre><span></span>date +"%F %T UTC%:z"
</pre></div>
</div>
</div>
</div>


<div id="outline-container-orgc16e48b" class="outline-2">
<h2 id="orgc16e48b">博客模板</h2>
<div class="outline-text-2" id="text-orgc16e48b">
<p>
tags 用逗号分隔， category 被看做一个词。
</p>
</div>

<div id="outline-container-org8180bf3" class="outline-3">
<h3 id="org8180bf3">orgmode</h3>
<div class="outline-text-3" id="text-org8180bf3">
<div class="highlight"><pre><span></span>#+BEGIN_COMMENT
.. title: nikola: static site generator
.. slug: nikola-static-site-generator
.. date: 2020-12-19 15:19:12 UTC+08:00
.. tags: python, blog
.. category: tools
.. link: 
.. description: 
.. type: text
.. has_math: true

#+END_COMMENT

blog here.
</pre></div>
</div>
</div>

<div id="outline-container-org6f30608" class="outline-3">
<h3 id="org6f30608">ipynb</h3>
<div class="outline-text-3" id="text-org6f30608">
<div class="highlight"><pre><span></span>   "metadata": {
     "nikola": {
      "title": "Power Method for Eigenvalues",
      "slug": "power-method-for-eigenvalues",
      "date": "2020-12-19 15:20:52 UTC+08:00",
      "tags": "Numerical Algorithm,Linear Algebra",
      "category": "Algorithm",
      "link": "",
      "description": "",
      "type": "text"
     }
   }
</pre></div>
</div>
</div>
</div>
                </div>
            </article>
</div>
    
        <ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-2.html" rel="prev">较新的文章</a></li>
        </ul>
<script>var disqus_shortname="chimezz";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script><script>
                renderMathInElement(document.body,
                    {
                        
delimiters: [
    {left: "$$", right: "$$", display: true},
    {left: "\\[", right: "\\]", display: true},
    {left: "\\begin{equation*}", right: "\\end{equation*}", display: true},
    {left: "$", right: "$", display: false},
    {left: "\\(", right: "\\)", display: false}
]

                    }
                );
            </script><!--End of body content--><footer id="footer">
            Contents © 2023         <a href="mailto:chimez@163.com">chimez</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>

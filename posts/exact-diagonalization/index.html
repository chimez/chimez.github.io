<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Exact Diagonalization | chimez's blog</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://chimez.github.io/posts/exact-diagonalization/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="chimez">
<link rel="prev" href="../gram-schmidt-orthogonalization/" title="Gram-Schmidt Orthogonalization" type="text/html">
<link rel="next" href="../samba/" title="samba 文件共享" type="text/html">
<meta property="og:site_name" content="chimez's blog">
<meta property="og:title" content="Exact Diagonalization">
<meta property="og:url" content="https://chimez.github.io/posts/exact-diagonalization/">
<meta property="og:description" content='精确对角化¶参考材料：

Anders W. Sandvik 的综述 Computational Studies of Quantum Spin Systems 
以及他的课程ppt XIV Training Course in the Physics of Strongly Correlated Systems 
Ralf Schneider, et.al. "Computational Man'>
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-12-20T13:18:31+08:00">
<meta property="article:tag" content="Correlated Electronic Systems">
<meta property="article:tag" content="Exact Diagonalization">
<meta property="article:tag" content="Numerical Method">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="../../">

            <span id="blog-title">chimez's blog</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav">
<li class="nav-item">
    <a href="index.ipynb" id="sourcelink" class="nav-link">Source</a>
    </li>


                    
            </ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Exact Diagonalization</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    chimez
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2020-12-20T13:18:31+08:00" itemprop="datePublished" title="2020-12-20 13:18">2020-12-20 13:18</time></a>
            </p>
            
        <p class="sourceline"><a href="index.ipynb" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="%E7%B2%BE%E7%A1%AE%E5%AF%B9%E8%A7%92%E5%8C%96">精确对角化<a class="anchor-link" href="#%E7%B2%BE%E7%A1%AE%E5%AF%B9%E8%A7%92%E5%8C%96">¶</a>
</h2>
<p>参考材料：</p>
<ol>
<li>Anders W. Sandvik 的综述 <a href="https://arxiv.org/abs/1101.3281">Computational Studies of Quantum Spin Systems</a> </li>
<li>以及他的课程ppt <a href="https://physics.bu.edu/~sandvik/vietri/index.html">XIV Training Course in the Physics of Strongly Correlated Systems </a>
</li>
<li>Ralf Schneider, et.al. "Computational Many-Particle Physics" 的第 18 章</li>
</ol>
<p>精确对角化实际上就是把哈密顿量写成矩阵表示，然后再求这个矩阵的最小本征值和本征矢，也就是基态和基态能量。</p>
<p>对于单电子图像的哈密顿量是很容易表示成矩阵形式的，多体哈密顿量的直接表示也不是很难。但是由于多体系统随着尺寸增加，矩阵的维数迅速增大，很容易就会超过计算机甚至超算的内存能力。所以精确对角化方法的核心就是如何利用系统的对称性把哈密顿量的矩阵划分成更小的矩阵。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>下面先以海森堡自旋 $\frac{1}{2}$ 链为例说明如何利用对称性划分哈密顿量矩阵。最后再给出一个利用这些对称性的 Fermi-Hubbard 模型例子。其它所有一维电子模型都可以用与这两个例子类似的方法实现。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="%E7%9B%B4%E6%8E%A5%E8%A1%A8%E7%A4%BA%E5%93%88%E5%AF%86%E9%A1%BF%E9%87%8F%E7%9A%84%E7%9F%A9%E9%98%B5">直接表示哈密顿量的矩阵<a class="anchor-link" href="#%E7%9B%B4%E6%8E%A5%E8%A1%A8%E7%A4%BA%E5%93%88%E5%AF%86%E9%A1%BF%E9%87%8F%E7%9A%84%E7%9F%A9%E9%98%B5">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Heisenberg $S= \frac{1}{2}$ 链
$$ H = J\sum_{i=1}^{N} S_i \cdot S_{i+1} = J \sum_{i=1}^{N} \left( S_i^xS_{i+1}^x+S_i^yS_{i+1}^y+S_i^zS_{i+1}^z \right) $$
$$ H = J \sum_{i=1}^{N} \left[ \frac{1}{2} \left( S_i^+S_{i+1}^-+S_i^-S_{i+1}^+ \right) + S_i^zS_{i+1}^z \right] $$</p>
<p>为了简化起见，下面都取 $J=1$ ，即反铁磁Heisenberg模型。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="%E7%AE%97%E7%AC%A6%E5%BC%A0%E9%87%8F%E7%A7%AF%E6%9E%84%E9%80%A0%E5%93%88%E5%AF%86%E9%A1%BF%E9%87%8F">算符张量积构造哈密顿量<a class="anchor-link" href="#%E7%AE%97%E7%AC%A6%E5%BC%A0%E9%87%8F%E7%A7%AF%E6%9E%84%E9%80%A0%E5%93%88%E5%AF%86%E9%A1%BF%E9%87%8F">¶</a>
</h4>
<p>一般单粒子的哈密顿量都会由算符的张量积构造得到，如下</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">tensor_product</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>首先定义每个格点上的算符</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Sz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">Sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="n">Sm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="n">II</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>接下来把所有格点的项全部加起来，这里以4个格点为例</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">H</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">tensor_product</span><span class="p">(</span><span class="n">Sp</span><span class="p">,</span> <span class="n">Sm</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">)</span> <span class="o">+</span> <span class="n">tensor_product</span><span class="p">(</span><span class="n">Sm</span><span class="p">,</span> <span class="n">Sp</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">tensor_product</span><span class="p">(</span><span class="n">Sz</span><span class="p">,</span> <span class="n">Sz</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">)</span>
    <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">tensor_product</span><span class="p">(</span><span class="n">II</span><span class="p">,</span> <span class="n">Sp</span><span class="p">,</span> <span class="n">Sm</span><span class="p">,</span> <span class="n">II</span><span class="p">)</span> <span class="o">+</span> <span class="n">tensor_product</span><span class="p">(</span><span class="n">II</span><span class="p">,</span> <span class="n">Sm</span><span class="p">,</span> <span class="n">Sp</span><span class="p">,</span> <span class="n">II</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">tensor_product</span><span class="p">(</span><span class="n">II</span><span class="p">,</span> <span class="n">Sz</span><span class="p">,</span> <span class="n">Sz</span><span class="p">,</span> <span class="n">II</span><span class="p">)</span>
    <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">tensor_product</span><span class="p">(</span><span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">Sp</span><span class="p">,</span> <span class="n">Sm</span><span class="p">)</span> <span class="o">+</span> <span class="n">tensor_product</span><span class="p">(</span><span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">Sm</span><span class="p">,</span> <span class="n">Sp</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">tensor_product</span><span class="p">(</span><span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">Sz</span><span class="p">,</span> <span class="n">Sz</span><span class="p">)</span>
    <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">tensor_product</span><span class="p">(</span><span class="n">Sm</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">Sp</span><span class="p">)</span> <span class="o">+</span> <span class="n">tensor_product</span><span class="p">(</span><span class="n">Sp</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">Sm</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">tensor_product</span><span class="p">(</span><span class="n">Sz</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">II</span><span class="p">,</span> <span class="n">Sz</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">H111</span> <span class="o">=</span> <span class="n">H</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>有了哈密顿量矩阵就可以对它进行对角化求基态了，这里调用 Arpack 求最小的本征值</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">eigsh</span>

<span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">eigsh</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">"SA"</span><span class="p">)</span>
<span class="n">eigvals</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[4]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>array([-4.44948974])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="%E6%A0%B9%E6%8D%AE%E5%9F%BA%E7%9F%A2%E6%9E%84%E9%80%A0%E5%93%88%E5%AF%86%E9%A1%BF%E9%87%8F">根据基矢构造哈密顿量<a class="anchor-link" href="#%E6%A0%B9%E6%8D%AE%E5%9F%BA%E7%9F%A2%E6%9E%84%E9%80%A0%E5%93%88%E5%AF%86%E9%A1%BF%E9%87%8F">¶</a>
</h4>
<p>从上面最一般的过程能看出，构造哈密顿量需要做大量的张量积计算，而且这些张量积中乘的项大多数都是单位矩阵，也就是说哈密顿量矩阵是非常稀疏的，所以我们其实可以用稀疏矩阵来表示哈密顿量，并且直接找到有数字的那些基矢，往哈密顿量里填数字就行了。</p>
<p>在上面的张量积构造过程中我们实际上取的表象是按照格点顺序排列的，即
$$
\begin{array}{lll}
|0\rangle &amp;= |\uparrow\uparrow\uparrow\uparrow\rangle     &amp;= (0000) \\
|1\rangle &amp;= |\uparrow\uparrow\uparrow\downarrow\rangle   &amp;= (0001) \\
|2\rangle &amp;= |\uparrow\uparrow\downarrow\uparrow\rangle   &amp;= (0010) \\
|3\rangle &amp;= |\uparrow\uparrow\downarrow\downarrow\rangle &amp;= (0011) \\
\cdots &amp;= \cdots &amp;= \cdots
\end{array}
$$
很容易发现基矢的表示自然地与数字的二进制联系起来了，因为每个格点恰好也只有两种可能的基矢，上下自旋分别对应于数字0和1。</p>
<p>这样我们就得到了一个关系
$$
\begin{array}{llll}
S^z &amp;\Rightarrow &amp; 0\rightarrow 0 &amp; 1\rightarrow 1 \\
S^- &amp;\Rightarrow &amp; 0\rightarrow \emptyset &amp; 1\rightarrow 0 \\
S^+ &amp;\Rightarrow &amp; 0\rightarrow 1 &amp; 1\rightarrow \emptyset
\end{array}
$$
即，$S^z$ 作用无效果，$S^-$ 相当于如果bit是0就翻转为1，如果是1，这个基矢就消失掉。</p>
<p>综合起来，对于最近邻的两个态的四种情况，哈密顿量的作用结果为
$$
\begin{array}{lllll}
               &amp;   (00)   &amp;     (01)   &amp;     (10)   &amp;     (11) \\
S_i^zS_{i+1}^z &amp;   (00)   &amp;   -1(01)   &amp;   -1(10)   &amp;     (11) \\
S_i^+S_{i+1}^- &amp;\emptyset &amp;     (10)   &amp;\emptyset   &amp;\emptyset \\
S_i^-S_{i+1}^+ &amp;\emptyset &amp;\emptyset   &amp;     (01)   &amp;\emptyset
\end{array}
$$</p>
<p>接下来只要遍历所有的基矢，并在每个基矢上作用一遍哈密顿量的所有项，找到对应的基矢，把这两个基矢作为指标填上数字就行了。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_state_index</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""获得一个整数某位置处的二进制值"""</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">index</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">state</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">index</span>


<span class="k">def</span> <span class="nf">flip_state</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""翻转一个整数某位置处的二进制值"""</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">index</span>
    <span class="k">return</span> <span class="n">state</span> <span class="o">^</span> <span class="n">mask</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">**</span> <span class="n">N</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">N</span><span class="p">))</span>

<span class="c1"># a is a basis</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">N</span><span class="p">):</span>
    <span class="c1"># i is position of this basis</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="c1"># j is the nearest neighbor, mod N for periodic boundary conditions</span>
        <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span>
        <span class="n">ai</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">aj</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

        <span class="c1"># Sz</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
        <span class="k">if</span> <span class="n">ai</span> <span class="o">==</span> <span class="n">aj</span><span class="p">:</span>
            <span class="n">H</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">H</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># SxSx + SySy</span>
        <span class="k">if</span> <span class="n">ai</span> <span class="o">!=</span> <span class="n">aj</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">flip_state</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">flip_state</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="n">H</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">H112</span> <span class="o">=</span> <span class="n">H</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>这样直接构造的结果与张量积乘出来的哈密顿量当然是一样的</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">eigsh</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">"SA"</span><span class="p">)</span>
<span class="n">eigvals</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">H112</span> <span class="o">-</span> <span class="n">H111</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[7]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>(array([-4.44948974]), True)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="%E5%88%A9%E7%94%A8%E5%AF%B9%E7%A7%B0%E6%80%A7%EF%BC%9A%E7%BB%84%E5%90%88%E5%9E%8B">利用对称性：组合型<a class="anchor-link" href="#%E5%88%A9%E7%94%A8%E5%AF%B9%E7%A7%B0%E6%80%A7%EF%BC%9A%E7%BB%84%E5%90%88%E5%9E%8B">¶</a>
</h3>
<p>从基矢构造哈密顿量的过程实际上分为两步，首先要确定基矢的总数和表象，之前我们取得表象就是最自然的全部排列，一共有 $2^N$ 个，然后把这些基矢按照哈密顿量的规则变换成另一组基矢，两组基矢作为哈密顿量矩阵的两个指标来填数字。</p>
<p>利用对称性主要就是改变前一步，不同的对称性子空间实际上限制的是基矢的数目，只要我们把某个子空间中的全部基矢找到，再用这组基矢构造哈密顿量，得到的就是这个对称性子空间中的哈密顿量了。只要把所有子空间都对角化一遍，自然就能得到全部的本征态。</p>
<p>这里先利用的对称性是最简单的一类，这些对称性只与基矢的总数有关，而与基矢内部的排列方式无关，例如总磁矩和总粒子数。总磁矩就是把每个格点上的磁矩全部加起来，总粒子数同样就是把每个格点上的粒子数加起来。总和一样的那些基矢就全部属于同一个子空间。反过来看，也可以是一个总的量子数在所有格点上的不同组合。</p>
<p>这里利用的是Heisenberg模型的总磁矩守恒
$$S^z_{\mathrm{tot}} = \sum_i s[i] $$
例如 $|0011\rangle, |1010\rangle$ 这两个态的总磁矩就是一样的，都是 $1$。</p>
<p>所以找到总磁矩为 1 的所有基矢有两种方法，一是遍历一遍所有的态，二是按照组合数的方式找到N个格点中取2个的所有组合。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="c1"># 这里的总自旋写2是因为总的因子 1/2 被省略了</span>
<span class="n">Nz</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">state_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">N</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">bin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">"1"</span><span class="p">)</span> <span class="o">==</span> <span class="n">Nz</span><span class="p">:</span>
        <span class="n">state_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="n">state_list</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[8]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>[3, 5, 6, 9, 10, 12]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>

<span class="n">state_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">Nz</span><span class="p">)]</span>
<span class="n">state_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">state_list</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[9]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>[3, 5, 6, 9, 10, 12]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>接下来就是利用已经找到的这些基矢来构造哈密顿量，构造的过程完全一样，只是要注意，判断基矢规则时要用原来的基矢，之后要把这个基矢对应到新的子空间基矢里。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">state_list</span><span class="p">),)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">new_a</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span>
        <span class="n">ai</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">aj</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

        <span class="c1"># Sz</span>
        <span class="n">new_b</span> <span class="o">=</span> <span class="n">new_a</span>
        <span class="k">if</span> <span class="n">ai</span> <span class="o">==</span> <span class="n">aj</span><span class="p">:</span>
            <span class="n">H</span><span class="p">[</span><span class="n">new_a</span><span class="p">,</span> <span class="n">new_b</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">H</span><span class="p">[</span><span class="n">new_a</span><span class="p">,</span> <span class="n">new_b</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># SxSx + SySy</span>
        <span class="k">if</span> <span class="n">ai</span> <span class="o">!=</span> <span class="n">aj</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">flip_state</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">flip_state</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="n">new_b</span> <span class="o">=</span> <span class="n">state_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="n">H</span><span class="p">[</span><span class="n">new_a</span><span class="p">,</span> <span class="n">new_b</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>可以发现对于4格点周期边界情况，基态是在总自旋为1的空间里的，因为这是个反铁磁的Heisenberg链。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">eigsh</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">"SA"</span><span class="p">)</span>
<span class="n">eigvals</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[11]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>array([-4.44948974])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="%E5%88%A9%E7%94%A8%E5%AF%B9%E7%A7%B0%E6%80%A7%EF%BC%9A%E5%B9%B3%E7%A7%BB%E5%AF%B9%E7%A7%B0%E6%80%A7">利用对称性：平移对称性<a class="anchor-link" href="#%E5%88%A9%E7%94%A8%E5%AF%B9%E7%A7%B0%E6%80%A7%EF%BC%9A%E5%B9%B3%E7%A7%BB%E5%AF%B9%E7%A7%B0%E6%80%A7">¶</a>
</h3>
<p>一维周期边界的链满足平移对称性，平移算符的本征态可以表示为
$$T | n \rangle = e^{ik}|n\rangle, k = m \frac{2\pi}{N}, m=0,1,\cdots,N-1$$
平移算符的作用就是把态在格点上移动一个
$$T | S^z_1, S^z_2, \cdots, S^z_N \rangle = | S^z_N, S^z_1, \cdots, S^z_{N-1} \rangle $$</p>
<p>在平移算符的本征子空间中的基矢可以由投影算符构造
$$ P_k = \frac{1}{L} \sum_r^{L-1} e^{ i \frac{2\pi}{L} k r } T^r$$
例如从 $|0011\rangle$ 生成的一组基矢为
\[ P_k |0011\rangle = \frac{1}{4} \left( |0011\rangle</p>
<ul>
<li>e^{i \frac{2\pi}{4} k \cdot 1} |0110\rangle </li>
<li>e^{i \frac{2\pi}{4} k \cdot 2} |1100\rangle </li>
<li>e^{i \frac{2\pi}{4} k \cdot 3} |1001\rangle \right) \]
这样就能够得到一组基矢，可以记作 $|r^a(k)\rangle=P_k|r^a\rangle$ ，对于其它的初始基矢还可以得到其它组基矢，记作 $|r^b(k)\rangle=P_k|r^b\rangle$ 等。</li>
</ul>
<p>那么在这一组新的基矢 $\left\lbrace|r(k)\rangle\right\rbrace$ 下的哈密顿量一共有$L$ 个，分别对应 $k=0,1,\cdots,L-1$，它的矩阵元为
$$ H_{mn} = \langle r^m(k) | H | r^n(k) \rangle =  \langle r^m| P_k H P_k | r^n \rangle = \langle r^m| P_k H | r^n \rangle$$ 
其中用到 $[P_k, H]=0$ 因为 $[T,H]=0$ ，和 $P_k^2=P_k$ 因为 $P_k$ 是投影算符。注意：这里所有计算过程中保持归一化。</p>
<p>所以计算这个新的哈密顿量块只需要把每组新基矢在哈密顿量作用下进行变换，再求这个基矢与 $k=0$ 时的那个基矢的内积就行了。因为 $|r^a(k=0)\rangle = |r^a\rangle$ 。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">state_cycle_shift</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">shift</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""循环移位操作"""</span>
    <span class="n">low</span> <span class="o">=</span> <span class="n">state</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="n">shift</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="n">shift</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">high</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&amp;</span> <span class="n">state</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">high</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span><span class="p">)</span> <span class="o">+</span> <span class="n">low</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>首先要从所有态里面把属于同一组的找出来</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">state_list_temp</span> <span class="o">=</span> <span class="n">state_list</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">state_k_all</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_list_temp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">state_k_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">s_first</span> <span class="o">=</span> <span class="n">state_list_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s_first</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">state_k_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">state_list_temp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">s_next</span> <span class="o">=</span> <span class="n">state_cycle_shift</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s_next</span> <span class="o">==</span> <span class="n">s_first</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s_next</span>

    <span class="n">state_k_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">state_k_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_k_list</span><span class="p">)</span>

<span class="n">state_k_all</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[13]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>[[3, 6, 9, 12], [5, 10]]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>然后就可以构造哈密顿量了，构造哈密顿量的过程中需要计算哈密顿量与基矢的乘积，这里直接把基矢构造成矩阵，把最后一步整合成矩阵乘法了，否则的话要写嵌套4层循环才行。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Hk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">state_k_all</span><span class="p">),)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>

<span class="k">for</span> <span class="n">new_b</span><span class="p">,</span> <span class="n">b_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state_k_all</span><span class="p">):</span>

    <span class="c1"># build state_b</span>
    <span class="n">state_new_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_list</span><span class="p">)))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rb</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">b_list</span><span class="p">):</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">state_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">state_new_b</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">state_new_b</span> <span class="o">=</span> <span class="n">state_new_b</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">state_new_b</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">new_a</span><span class="p">,</span> <span class="n">a_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state_k_all</span><span class="p">):</span>
        <span class="n">state_new_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">state_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>

        <span class="c1"># build state_a</span>
        <span class="n">state_new_a_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">state_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ra</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a_list</span><span class="p">):</span>
            <span class="n">ia</span> <span class="o">=</span> <span class="n">state_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">state_new_a_temp</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">N</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">ra</span><span class="p">)</span>
        <span class="n">state_new_a_temp</span> <span class="o">=</span> <span class="n">state_new_a_temp</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">state_new_a_temp</span><span class="p">)</span>

        <span class="c1"># H @ state_a</span>
        <span class="k">for</span> <span class="n">ra</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a_list</span><span class="p">):</span>
            <span class="n">ia</span> <span class="o">=</span> <span class="n">state_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span>
                <span class="n">ai</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">aj</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

                <span class="c1"># Sz</span>
                <span class="n">new_ia</span> <span class="o">=</span> <span class="n">ia</span>
                <span class="k">if</span> <span class="n">ai</span> <span class="o">==</span> <span class="n">aj</span><span class="p">:</span>
                    <span class="n">state_new_a</span><span class="p">[</span><span class="n">new_ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">state_new_a_temp</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">state_new_a</span><span class="p">[</span><span class="n">new_ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">state_new_a_temp</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                <span class="c1"># SxSx + SySy</span>
                <span class="k">if</span> <span class="n">ai</span> <span class="o">!=</span> <span class="n">aj</span><span class="p">:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">flip_state</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">flip_state</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                    <span class="n">new_ib</span> <span class="o">=</span> <span class="n">state_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="n">state_new_a</span><span class="p">[</span><span class="n">new_ib</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">state_new_a_temp</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Hk</span>
        <span class="n">Hk</span><span class="p">[</span><span class="n">new_a</span><span class="p">,</span> <span class="n">new_b</span><span class="p">]</span> <span class="o">=</span> <span class="n">state_new_b</span> <span class="o">@</span> <span class="n">state_new_a</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>这里构造得到的 $k=0$ 子空间只有 $2\times 2$ 维，从这里计算得到的也是基态。一般来说，基态总是在 $k=0$ 的子空间中。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">Hk</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[15]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>array([-4.44948974,  0.44948974])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="%E5%88%A9%E7%94%A8%E5%AF%B9%E7%A7%B0%E6%80%A7%EF%BC%9A%E5%85%B6%E5%AE%83%E7%A6%BB%E6%95%A3%E5%AF%B9%E7%A7%B0%E6%80%A7">利用对称性：其它离散对称性<a class="anchor-link" href="#%E5%88%A9%E7%94%A8%E5%AF%B9%E7%A7%B0%E6%80%A7%EF%BC%9A%E5%85%B6%E5%AE%83%E7%A6%BB%E6%95%A3%E5%AF%B9%E7%A7%B0%E6%80%A7">¶</a>
</h3>
<p>除了总磁矩和平移对称性之外还有一些其它的离散对称性，例如对于 $k=0,\pi$ 时有宇称对称性和自旋翻转对称性等等。但是这些对称性与平移对称性并不对易，所以不能从平移对称性的结果中继续细分，而是要联合平移对称性一起去找基矢。</p>
<p>比如联合使用平移对称性和宇称对称性，要同时考虑平移算符和宇称算符来构造基矢，例如
$$ \mathcal{P}_k = \frac{1}{L} \sum_r^{L-1} C^\sigma\left( \frac{2\pi}{L} k r \right) T^r (1+P) $$
$$ C^\sigma\left( \frac{2\pi}{L} k r \right) = \left\lbrace \begin{array}{ll} 
\cos( \frac{2\pi}{L} k r), &amp; p = 1 \\
\sin( \frac{2\pi}{L} k r), &amp; p = -1
\end{array} \right. $$</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>程序待写</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Fermi-Hubbard-%E6%A8%A1%E5%9E%8B">Fermi-Hubbard 模型<a class="anchor-link" href="#Fermi-Hubbard-%E6%A8%A1%E5%9E%8B">¶</a>
</h3>$$ H = -t \sum_{i,\sigma} \left( c^\dagger_{i,\sigma} c_{i+1,\sigma} + c^\dagger_{i+1,\sigma} c_{i,\sigma}  \right) + U \sum_{i} n_{i\uparrow}n_{i\downarrow}$$
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>首先定义哈密顿量作用到基矢上的结果，基本原则就是如果作用有效果就返回作用后的基矢，如果作用为0就返回 <code>None</code>。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>


<span class="k">def</span> <span class="nf">check_U</span><span class="p">(</span><span class="n">state_up</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">state_down</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
    <span class="n">state_up_i</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">state_up</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">state_down_i</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">state_down</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">state_up_i</span> <span class="o">==</span> <span class="n">state_down_i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">state_up</span><span class="p">,</span> <span class="n">state_down</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">check_t</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">N</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
    <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span>
    <span class="n">state_i</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">state_j</span> <span class="o">=</span> <span class="n">get_state_index</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">state_i</span><span class="p">,</span> <span class="n">state_j</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">state_i</span><span class="p">,</span> <span class="n">state_j</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">state_new</span> <span class="o">=</span> <span class="n">flip_state</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">state_new</span> <span class="o">=</span> <span class="n">flip_state</span><span class="p">(</span><span class="n">state_new</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state_new</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>先实现一个全对角化，以此作为检查标准。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span> <span class="o">**</span> <span class="n">N</span><span class="p">,</span> <span class="mi">4</span> <span class="o">**</span> <span class="n">N</span><span class="p">))</span>
<span class="n">al</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">a_up</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">N</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">a_down</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">N</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_up</span> <span class="o">&lt;&lt;</span> <span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="n">a_down</span>
        <span class="n">al</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="c1"># t</span>
            <span class="n">b_up</span> <span class="o">=</span> <span class="n">check_t</span><span class="p">(</span><span class="n">a_up</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b_up</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_up</span> <span class="o">&lt;&lt;</span> <span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="n">a_down</span>
                <span class="n">H</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">t</span>

            <span class="n">b_down</span> <span class="o">=</span> <span class="n">check_t</span><span class="p">(</span><span class="n">a_down</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b_down</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_up</span> <span class="o">&lt;&lt;</span> <span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="n">b_down</span>
                <span class="n">H</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">t</span>

            <span class="c1"># U</span>
            <span class="n">b_result</span> <span class="o">=</span> <span class="n">check_U</span><span class="p">(</span><span class="n">a_up</span><span class="p">,</span> <span class="n">a_down</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="n">b_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">H</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">+=</span> <span class="n">U</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># eigvals, eigvecs = eigsh(H, k=1, which='SA')</span>
<span class="c1"># eigvals</span>
<span class="n">eigvals_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>首先利用粒子数对称性，这里考虑的是粒子数的分别守恒，总数守恒就把两组整数一起组合就行了。</p>
<p>这里取半满且两种自旋数目相同。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">Nup</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">Ndown</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">1</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>

<span class="n">state_up_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">Nup</span><span class="p">)]</span>
<span class="n">state_up_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">state_down_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">Ndown</span><span class="p">)]</span>
<span class="n">state_down_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">state_total_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">state_up_list</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">state_down_list</span><span class="p">]</span>
<span class="n">state_up_list</span><span class="p">,</span> <span class="n">state_down_list</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[19]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>([3, 5, 6, 9, 10, 12], [3, 5, 6, 9, 10, 12])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>接下来找平移对称性，因为有两组基矢，所以平移的时候要同时对它们都操作。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">state_list_temp</span> <span class="o">=</span> <span class="n">state_total_list</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">state_k_all</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_list_temp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">state_k_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">s_first</span> <span class="o">=</span> <span class="n">state_list_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s_first</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">state_k_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">state_list_temp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="n">s0_next</span> <span class="o">=</span> <span class="n">state_cycle_shift</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="n">s1_next</span> <span class="o">=</span> <span class="n">state_cycle_shift</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="n">s_next</span> <span class="o">=</span> <span class="p">(</span><span class="n">s0_next</span><span class="p">,</span> <span class="n">s1_next</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">s_next</span> <span class="o">==</span> <span class="n">s_first</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s_next</span>

    <span class="n">state_k_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">state_k_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_k_list</span><span class="p">)</span>

<span class="c1"># state_k_all</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>接下来就构造哈密顿量。</p>
<p>这里取动量为$0$。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Hk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">state_k_all</span><span class="p">),)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>

<span class="k">for</span> <span class="n">new_b</span><span class="p">,</span> <span class="n">b_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state_k_all</span><span class="p">):</span>

    <span class="c1"># build state_b</span>
    <span class="n">state_new_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_total_list</span><span class="p">)))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rb</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">b_list</span><span class="p">):</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">state_total_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">state_new_b</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">state_new_b</span> <span class="o">=</span> <span class="n">state_new_b</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">state_new_b</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">new_a</span><span class="p">,</span> <span class="n">a_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state_k_all</span><span class="p">):</span>
        <span class="n">state_new_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">state_total_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>

        <span class="c1"># build state_a</span>
        <span class="n">state_new_a_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">state_total_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ra</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a_list</span><span class="p">):</span>
            <span class="n">ia</span> <span class="o">=</span> <span class="n">state_total_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">state_new_a_temp</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">N</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">ra</span><span class="p">)</span>
        <span class="n">state_new_a_temp</span> <span class="o">=</span> <span class="n">state_new_a_temp</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">state_new_a_temp</span><span class="p">)</span>

        <span class="c1"># H @ state_a</span>
        <span class="k">for</span> <span class="n">ra</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a_list</span><span class="p">):</span>
            <span class="n">a_up</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">a_down</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ia</span> <span class="o">=</span> <span class="n">state_total_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>

                <span class="c1"># t</span>
                <span class="n">b_up</span> <span class="o">=</span> <span class="n">check_t</span><span class="p">(</span><span class="n">a_up</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">b_up</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_up</span><span class="p">,</span> <span class="n">a_down</span><span class="p">)</span>
                    <span class="n">new_ib</span> <span class="o">=</span> <span class="n">state_total_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="n">state_new_a</span><span class="p">[</span><span class="n">new_ib</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">t</span> <span class="o">*</span> <span class="n">state_new_a_temp</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                <span class="n">b_down</span> <span class="o">=</span> <span class="n">check_t</span><span class="p">(</span><span class="n">a_down</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">b_down</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_up</span><span class="p">,</span> <span class="n">b_down</span><span class="p">)</span>
                    <span class="n">new_ib</span> <span class="o">=</span> <span class="n">state_total_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="n">state_new_a</span><span class="p">[</span><span class="n">new_ib</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">t</span> <span class="o">*</span> <span class="n">state_new_a_temp</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                <span class="c1"># U</span>
                <span class="n">b_result</span> <span class="o">=</span> <span class="n">check_U</span><span class="p">(</span><span class="n">a_up</span><span class="p">,</span> <span class="n">a_down</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">b_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">b_result</span>
                    <span class="n">new_ib</span> <span class="o">=</span> <span class="n">state_total_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="n">state_new_a</span><span class="p">[</span><span class="n">new_ib</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">state_new_a_temp</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Hk</span>
        <span class="n">Hk</span><span class="p">[</span><span class="n">new_a</span><span class="p">,</span> <span class="n">new_b</span><span class="p">]</span> <span class="o">=</span> <span class="n">state_new_b</span> <span class="o">@</span> <span class="n">state_new_a</span>

<span class="c1"># Hk</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>对角化一下新构造的哈密顿量，这个新哈密顿量的所有本征值都在全哈密顿量的谱里，这说明写对了。</p>
<p>从这个结果中我们知道，Fermi-Hubbard 模型的基态既是半满的，又是动量为$0$的。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">eigvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">Hk</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">eigvals</span><span class="p">:</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eigvals_all</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">eigvals_all</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">x</span><span class="p">),</span> <span class="n">eigvals_all</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>True -4.723265519527195 -4.723265519527192
True 1.3836255242112377e-16 1.1102230246251525e-16
True 0.5058018686891442 0.5058018686891443
True 0.9999999999999989 0.999999999999999
True 0.9999999999999996 0.9999999999999996
True 1.0 1.0
True 1.0000000000000002 1.0000000000000002
True 1.4941981313108506 1.494198131310855
True 2.0 2.0
True 6.723265519527201 6.723265519527191
</pre>
</div>
</div>

</div>
</div>

</div>
</div>
</div></article>
</div>
</div>
</body>
</html><html>
<aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="/categories/correlated-electronic-systems/" rel="tag">Correlated Electronic Systems</a></li>
            <li><a class="tag p-category" href="/categories/exact-diagonalization/" rel="tag">Exact Diagonalization</a></li>
            <li><a class="tag p-category" href="/categories/numerical-method/" rel="tag">Numerical Method</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="/posts/gram-schmidt-orthogonalization/" rel="prev" title="Gram-Schmidt Orthogonalization">Previous post</a>
            </li>
            <li class="next">
                <a href="/posts/samba/" rel="next" title="samba 文件共享">Next post</a>
            </li>
        </ul></nav></aside><script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script><script>
                renderMathInElement(document.body,
                    {
                        
delimiters: [
    {left: "$$", right: "$$", display: true},
    {left: "\\[", right: "\\]", display: true},
    {left: "\\begin{equation*}", right: "\\end{equation*}", display: true},
    {left: "$", right: "$", display: false},
    {left: "\\(", right: "\\)", display: false}
]

                    }
                );
            </script><!--End of body content--><footer id="footer">
            Contents © 2021         <a href="mailto:chimez@163.com">chimez</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer><script src="/assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</html>


<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-09-27 Sun 17:23 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>common lisp</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="chimez" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">common lisp</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgb70f78b">1. 基本语法</a>
<ul>
<li><a href="#org404ce5a">1.1. 特殊操作符</a></li>
<li><a href="#org6d7a13c">1.2. 函数</a>
<ul>
<li><a href="#orge403d1f">1.2.1. 基本函数定义 <code>defun</code></a></li>
<li><a href="#org9b77133">1.2.2. 可选形参 <code>&amp;optional</code></a></li>
<li><a href="#org81ae674">1.2.3. 剩余形参 <code>&amp;rest</code></a></li>
<li><a href="#orgbcabbe5">1.2.4. 关键字形参 <code>&amp;key</code></a></li>
<li><a href="#orgfddf826">1.2.5. 强制返回值 <code>return-from</code></a></li>
<li><a href="#org067b93c">1.2.6. 获得函数对象 <code>function, #'</code></a></li>
<li><a href="#org14499c5">1.2.7. 调用函数 <code>funcall</code></a></li>
<li><a href="#orgf9158b2">1.2.8. 应用函数 <code>apply</code></a></li>
<li><a href="#orgc68c87c">1.2.9. 匿名函数 <code>lambda</code></a></li>
</ul>
</li>
<li><a href="#orge088734">1.3. 变量</a>
<ul>
<li><a href="#orgdce4ecc">1.3.1. 等价 <code>eq,eql</code></a></li>
<li><a href="#org1286aae">1.3.2. 局部变量 <code>let</code></a></li>
<li><a href="#org68c5def">1.3.3. 嵌套的局部变量 <code>let*</code></a></li>
<li><a href="#orgbc8ccba">1.3.4. 赋值和闭包 <code>setf, set, setq</code></a></li>
<li><a href="#org618a198">1.3.5. 全局变量 <code>defparameter</code></a></li>
<li><a href="#org2c9e984">1.3.6. 全局变量 <code>defvar</code></a></li>
<li><a href="#org083f388">1.3.7. 全局常量 <code>defconstant</code></a></li>
</ul>
</li>
<li><a href="#orgb0c92a7">1.4. 流程控制</a>
<ul>
<li><a href="#org4b2f504">1.4.1. 条件 <code>if</code></a></li>
<li><a href="#org4bc9f1b">1.4.2. <code>when, unless</code></a></li>
<li><a href="#org4547e44">1.4.3. 多重分支 <code>cond</code></a></li>
<li><a href="#orgb799906">1.4.4. 布尔运算 <code>and, or, not</code></a></li>
<li><a href="#org3c38b92">1.4.5. 列表上循环 <code>dolist</code></a></li>
<li><a href="#org21939e7">1.4.6. 次数循环 <code>dotimes</code></a></li>
<li><a href="#org95d338b">1.4.7. 一般循环 <code>do</code></a></li>
<li><a href="#orgf140ac8">1.4.8. <code>loop</code> 宏</a></li>
</ul>
</li>
<li><a href="#org280877f">1.5. 宏</a>
<ul>
<li><a href="#org6edf953">1.5.1. 定义宏 <code>defmacro</code></a></li>
<li><a href="#orgbfbc4d3">1.5.2. 反引用 <code>`,@</code></a></li>
<li><a href="#orgd2c6086">1.5.3. 展开宏与调试 <code>macroexpand-1</code></a></li>
<li><a href="#org83e376a">1.5.4. 自动生成变量名 <code>gensym</code></a></li>
</ul>
</li>
<li><a href="#org917d4ca">1.6. 面向对象 CLOS</a>
<ul>
<li><a href="#org6bb88c3">1.6.1. 创建类和访问实例的属性 <code>defclass, make-instance, slot-value, with-accessors</code></a></li>
<li><a href="#org6905515">1.6.2. 创建和使用方法 <code>defgeneric,defmethod,call-next-method</code></a></li>
</ul>
</li>
<li><a href="#orge1de78d">1.7. 错误处理</a></li>
<li><a href="#org0bcfee9">1.8. 包系统</a></li>
<li><a href="#orgca7738a">1.9. 类型与注解</a></li>
<li><a href="#org5aa5207">1.10. loop 宏</a></li>
<li><a href="#orgb80a672">1.11. format 宏</a></li>
</ul>
</li>
<li><a href="#org121978e">2. 标准库</a>
<ul>
<li><a href="#orgd96fc95">2.1. 数字</a>
<ul>
<li><a href="#org4b93b58">2.1.1. 数字的表示</a></li>
<li><a href="#org7202dd6">2.1.2. 算术运算 <code>mod,rem,floor,ceiling,truncate,round</code></a></li>
<li><a href="#orgb27107b">2.1.3. 数值比较</a></li>
<li><a href="#org928933a">2.1.4. 数学函数</a></li>
</ul>
</li>
<li><a href="#orgc01eff0">2.2. 字符</a>
<ul>
<li><a href="#org512f8a5">2.2.1. 字符的表示</a></li>
<li><a href="#org545b5eb">2.2.2. 字符的比较</a></li>
</ul>
</li>
<li><a href="#org449aeaa">2.3. 字符串</a>
<ul>
<li><a href="#org40c4128">2.3.1. 字符串的表示</a></li>
<li><a href="#orgf1c8791">2.3.2. 字符串的比较</a></li>
</ul>
</li>
<li><a href="#org13c1f99">2.4. 向量或序列</a>
<ul>
<li><a href="#org62f57fc">2.4.1. 创建向量 <code>vector, make-array</code></a></li>
<li><a href="#org700c5e4">2.4.2. 项操作函数 <code>count,find,position,remove,substitute</code></a></li>
<li><a href="#orgdbda18c">2.4.3. 序列整体操作函数 <code>copy-seq,reverse,concatenate, sort,merge, subseq, search, mismatch</code></a></li>
<li><a href="#orgf54990a">2.4.4. 遍历操作函数 <code>every,some,notany,notevery, map,reduce</code></a></li>
</ul>
</li>
<li><a href="#org4afa8f4">2.5. 哈希表</a>
<ul>
<li><a href="#orgecf1b70">2.5.1. 基本操作 <code>make-hash-table, gethash</code></a></li>
<li><a href="#org431219f">2.5.2. 迭代函数 <code>maphash</code></a></li>
</ul>
</li>
<li><a href="#org802811c">2.6. 列表</a>
<ul>
<li><a href="#org710c94f">2.6.1. 基本操作 <code>cons,car,cdr,list, nth,null,listp</code></a></li>
<li><a href="#orge5e35d4">2.6.2. 函数 <code>append,reverse,push,remove,mapcar,maplist</code></a></li>
</ul>
</li>
<li><a href="#org0b0e5de">2.7. 文件和I/O</a>
<ul>
<li><a href="#org4f700ce">2.7.1. 文件操作函数 <code>with-open-file, read, write, pprint</code></a></li>
<li><a href="#orge24e38c">2.7.2. 文件名和路径函数 <code>pathname, namestring</code></a></li>
<li><a href="#org90d849a">2.7.3. 文件系统交互函数  <code>probe-file,delete-file,rename-file</code></a></li>
<li><a href="#orgb726a2d">2.7.4. 其它I/O流 <code>with-input-from-string, with-output-to-string</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org35c74fd">3. 坑与技巧</a>
<ul>
<li><a href="#org5cfcd02">3.1. 在REPL里删除各种东西</a>
<ul>
<li><a href="#orgcb2e7d3">3.1.1. 删除变量</a></li>
<li><a href="#org9133918">3.1.2. 删除类和方法</a></li>
</ul>
</li>
<li><a href="#org98b66ab">3.2. 查询包中的符号</a>
<ul>
<li><a href="#org6b05699">3.2.1. 查询符号在哪个包中</a></li>
<li><a href="#orga2b3771">3.2.2. 列出包中所有符号</a></li>
<li><a href="#org624435e">3.2.3. 查询包使用了哪些包</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd92f3fe">4. 构建项目与测试</a>
<ul>
<li><a href="#org0674e6a">4.1. roswell</a>
<ul>
<li><a href="#org2ce924d">4.1.1. 常用命令</a></li>
</ul>
</li>
<li><a href="#org5f894e7">4.2. quicklisp</a>
<ul>
<li><a href="#orgcd2ad18">4.2.1. 常用命令</a></li>
<li><a href="#orga5c930a">4.2.2. 问题</a></li>
</ul>
</li>
<li><a href="#org37f01aa">4.3. asdf</a>
<ul>
<li><a href="#org7d1e848">4.3.1. 加载 ASDF</a></li>
<li><a href="#org25e0f83">4.3.2. 配置 ASDF</a></li>
<li><a href="#org9306525">4.3.3. 使用 ASDF</a></li>
<li><a href="#org7608912">4.3.4. 定义系统</a></li>
</ul>
</li>
<li><a href="#org58d4023">4.4. rove</a></li>
<li><a href="#org56a52ad">4.5. 项目模板</a>
<ul>
<li><a href="#org16568bb">4.5.1. 文件目录</a></li>
<li><a href="#org49a563c">4.5.2. asd 文件</a></li>
<li><a href="#org506adcb">4.5.3. 源文件</a></li>
<li><a href="#orgf355f21">4.5.4. 测试文件</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgf49b665">5. FFI</a>
<ul>
<li><a href="#orgd74cecf">5.1. CFFI</a>
<ul>
<li><a href="#orge175a39">5.1.1. 基本过程</a></li>
<li><a href="#org58e04ac">5.1.2. 类型参考</a></li>
<li><a href="#org753f387">5.1.3. 问题解决</a></li>
</ul>
</li>
<li><a href="#orgedcefaa">5.2. cl-autowrap</a>
<ul>
<li><a href="#org0e921f2">5.2.1. 安装 c2ffi</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd6aef35">6. iterate : 代替 loop 宏</a></li>
<li><a href="#orge453a9e">7. ugly-tiny-infix-macro</a></li>
<li><a href="#org09901e8">8. eazy-gnuplot</a></li>
</ul>
</div>
</div>





<div id="outline-container-orgb70f78b" class="outline-2">
<h2 id="orgb70f78b"><span class="section-number-2">1</span> 基本语法</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org404ce5a" class="outline-3">
<h3 id="org404ce5a"><span class="section-number-3">1.1</span> 特殊操作符</h3>
<div class="outline-text-3" id="text-1-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><b>控制求值</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>quote</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>if</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>progn</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><b>维护词法环境</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>let</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>let*</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>setq</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>flet</code></td>
<td class="org-left">局部函数</td>
</tr>

<tr>
<td class="org-left"><code>labels</code></td>
<td class="org-left">局部函数</td>
</tr>

<tr>
<td class="org-left"><code>macrolet</code></td>
<td class="org-left">局部宏</td>
</tr>

<tr>
<td class="org-left"><code>symbol-macrolet</code></td>
<td class="org-left">局部符号宏</td>
</tr>

<tr>
<td class="org-left"><code>function</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><b>局部控制流</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>block</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>return-from</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>tagbody</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>go</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><b>控制栈</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>catch</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>throw</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>unwind-protect</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><b>多重返回值</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>multiple-value-call</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><b>eval-when</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>eval-when</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><b>其它</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>locally</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>the</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>load-time-value</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>progv</code></td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org6d7a13c" class="outline-3">
<h3 id="org6d7a13c"><span class="section-number-3">1.2</span> 函数</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-orge403d1f" class="outline-4">
<h4 id="orge403d1f"><span class="section-number-4">1.2.1</span> 基本函数定义 <code>defun</code></h4>
<div class="outline-text-4" id="text-1-2-1">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">f</span> <span style="color: #b58900;">(</span>x<span style="color: #b58900;">)</span>
  x<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>f 3<span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">
3
</pre>
</div>
</div>

<div id="outline-container-org9b77133" class="outline-4">
<h4 id="org9b77133"><span class="section-number-4">1.2.2</span> 可选形参 <code>&amp;optional</code></h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
未提供的参数会自动绑定为 <code>nil</code>
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">f</span> <span style="color: #b58900;">(</span>a <span style="color: #b58900;">&amp;optional</span> b<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>list a b<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>f 2 3<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>f 2<span style="color: #2aa198;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-left">NIL</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org81ae674" class="outline-4">
<h4 id="org81ae674"><span class="section-number-4">1.2.3</span> 剩余形参 <code>&amp;rest</code></h4>
<div class="outline-text-4" id="text-1-2-3">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">f</span> <span style="color: #b58900;">(</span>a <span style="color: #b58900;">&amp;rest</span> vals<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>list a vals<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>f 1 2 3 4 5<span style="color: #2aa198;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">(2 3 4 5)</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgbcabbe5" class="outline-4">
<h4 id="orgbcabbe5"><span class="section-number-4">1.2.4</span> 关键字形参 <code>&amp;key</code></h4>
<div class="outline-text-4" id="text-1-2-4">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">f</span> <span style="color: #b58900;">(</span><span style="color: #b58900;">&amp;key</span> a b c<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>list a b c<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
  
<span style="color: #2aa198;">(</span>f <span style="color: #657b83; font-weight: bold;">:a</span> 2 <span style="color: #657b83; font-weight: bold;">:c</span> 1 <span style="color: #657b83; font-weight: bold;">:b</span> 3<span style="color: #2aa198;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgfddf826" class="outline-4">
<h4 id="orgfddf826"><span class="section-number-4">1.2.5</span> 强制返回值 <code>return-from</code></h4>
<div class="outline-text-4" id="text-1-2-5">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">f</span> <span style="color: #b58900;">()</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">dotimes</span> <span style="color: #268bd2;">(</span>i 10<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">dotimes</span> <span style="color: #6c71c4;">(</span>j 10<span style="color: #6c71c4;">)</span>
      <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">return-from</span> f <span style="color: #859900;">(</span>list 2<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
      
<span style="color: #2aa198;">(</span>f<span style="color: #2aa198;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org067b93c" class="outline-4">
<h4 id="org067b93c"><span class="section-number-4">1.2.6</span> 获得函数对象 <code>function, #'</code></h4>
<div class="outline-text-4" id="text-1-2-6">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">f</span> <span style="color: #b58900;">()</span> 2<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>function f<span style="color: #2aa198;">)</span>
#'f
</pre>
</div>

<pre class="example">
#&lt;FUNCTION F&gt;
</pre>
</div>
</div>

<div id="outline-container-org14499c5" class="outline-4">
<h4 id="org14499c5"><span class="section-number-4">1.2.7</span> 调用函数 <code>funcall</code></h4>
<div class="outline-text-4" id="text-1-2-7">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>funcall #'<span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #268bd2;">(</span>x y<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>+ x y<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span> 1 2<span style="color: #2aa198;">)</span> 
</pre>
</div>

<pre class="example">
3
</pre>
</div>
</div>

<div id="outline-container-orgf9158b2" class="outline-4">
<h4 id="orgf9158b2"><span class="section-number-4">1.2.8</span> 应用函数 <code>apply</code></h4>
<div class="outline-text-4" id="text-1-2-8">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>apply #'<span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #268bd2;">(</span>x y<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>+ x y<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span> '<span style="color: #b58900;">(</span>1 2<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">
3
</pre>
</div>
</div>

<div id="outline-container-orgc68c87c" class="outline-4">
<h4 id="orgc68c87c"><span class="section-number-4">1.2.9</span> 匿名函数 <code>lambda</code></h4>
<div class="outline-text-4" id="text-1-2-9">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #268bd2;">(</span>x<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>* x 5<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span> 2<span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">
10
</pre>
</div>
</div>
</div>

<div id="outline-container-orge088734" class="outline-3">
<h3 id="orge088734"><span class="section-number-3">1.3</span> 变量</h3>
<div class="outline-text-3" id="text-1-3">
</div>
<div id="outline-container-orgdce4ecc" class="outline-4">
<h4 id="orgdce4ecc"><span class="section-number-4">1.3.1</span> 等价 <code>eq,eql</code></h4>
<div class="outline-text-4" id="text-1-3-1">
<ol class="org-ol">
<li><code>eq</code> 比较是否为同一对象，相当于比较指针</li>
<li><code>eql</code> 比较类型和值是否都一样</li>
</ol>
</div>
</div>
<div id="outline-container-org1286aae" class="outline-4">
<h4 id="org1286aae"><span class="section-number-4">1.3.2</span> 局部变量 <code>let</code></h4>
<div class="outline-text-4" id="text-1-3-2">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>x 2<span style="color: #268bd2;">)</span>
      <span style="color: #268bd2;">(</span>y 3<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>+ x y<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">
5
</pre>
</div>
</div>
<div id="outline-container-org68c5def" class="outline-4">
<h4 id="org68c5def"><span class="section-number-4">1.3.3</span> 嵌套的局部变量 <code>let*</code></h4>
<div class="outline-text-4" id="text-1-3-3">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">let*</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>x 2<span style="color: #268bd2;">)</span>
       <span style="color: #268bd2;">(</span>y <span style="color: #6c71c4;">(</span>+ 1 x<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>+ x y<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">
5
</pre>
</div>
</div>
<div id="outline-container-orgbc8ccba" class="outline-4">
<h4 id="orgbc8ccba"><span class="section-number-4">1.3.4</span> 赋值和闭包 <code>setf, set, setq</code></h4>
<div class="outline-text-4" id="text-1-3-4">
<ol class="org-ol">
<li>改变的量只在闭包里</li>
<li><code>set</code> 只作用于符号</li>
<li><code>setq</code> 自动把第一个值变成符号</li>
<li><code>setf</code> 是一个宏，自动把第一个值转换成合适的东西，比如修改列表中的某一项</li>
</ol>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>x 1<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>x 2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>print x<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>setf x 3<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>print x<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>print x<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">

2 
3 
1 
</pre>


<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>x 1<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>print x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>set 'x 2<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>print x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>setq x 3<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>print x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>setf <span style="color: #268bd2;">(</span>car <span style="color: #6c71c4;">(</span>list x<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> 4<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>print x<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">

1 
1 
3 
3 
</pre>
</div>
</div>

<div id="outline-container-org618a198" class="outline-4">
<h4 id="org618a198"><span class="section-number-4">1.3.5</span> 全局变量 <code>defparameter</code></h4>
<div class="outline-text-4" id="text-1-3-5">
<p>
可以重新定义，可以修改
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defparameter</span> <span style="color: #268bd2;">*x*</span> 1
  <span style="color: #2aa198;">"docs"</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>print *x*<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defparameter</span> <span style="color: #268bd2;">*x*</span> 2<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>print *x*<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>setf *x* 3<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>print *x*<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>setq *x* 4<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>print *x*<span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">

1 
2 
3 
4 
</pre>
</div>
</div>

<div id="outline-container-org2c9e984" class="outline-4">
<h4 id="org2c9e984"><span class="section-number-4">1.3.6</span> 全局变量 <code>defvar</code></h4>
<div class="outline-text-4" id="text-1-3-6">
<p>
不能重新定义，可以修改
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defvar</span> <span style="color: #268bd2;">*y*</span> 1
  <span style="color: #2aa198;">"docs"</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>print *y*<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defvar</span> <span style="color: #268bd2;">*y*</span> 2<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>print *y*<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>setf *y* 3<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>print *y*<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>setq *y* 4<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>print *y*<span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">

1 
1 
3 
4 
</pre>
</div>
</div>

<div id="outline-container-org083f388" class="outline-4">
<h4 id="org083f388"><span class="section-number-4">1.3.7</span> 全局常量 <code>defconstant</code></h4>
<div class="outline-text-4" id="text-1-3-7">
<p>
修改和重新定义都会报错
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defconstant</span> <span style="color: #268bd2;">const-x</span> 1<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>print const-x<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>setf const-x 2<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>print const-x<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defconstant</span> <span style="color: #268bd2;">const-x</span> 3<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>print const-x<span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">
3
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb0c92a7" class="outline-3">
<h3 id="orgb0c92a7"><span class="section-number-3">1.4</span> 流程控制</h3>
<div class="outline-text-3" id="text-1-4">
</div>
<div id="outline-container-org4b2f504" class="outline-4">
<h4 id="org4b2f504"><span class="section-number-4">1.4.1</span> 条件 <code>if</code></h4>
<div class="outline-text-4" id="text-1-4-1">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>x 1<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>= x 1<span style="color: #268bd2;">)</span>
      2
      3<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">
2
</pre>
</div>
</div>
<div id="outline-container-org4bc9f1b" class="outline-4">
<h4 id="org4bc9f1b"><span class="section-number-4">1.4.2</span> <code>when, unless</code></h4>
<div class="outline-text-4" id="text-1-4-2">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>x 1 <span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">when</span> <span style="color: #268bd2;">(</span>= x 1<span style="color: #268bd2;">)</span>
    2<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">
2
</pre>


<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>x 1<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">unless</span> <span style="color: #268bd2;">(</span>= x 1<span style="color: #268bd2;">)</span> 2<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">
NIL
</pre>
</div>
</div>
<div id="outline-container-org4547e44" class="outline-4">
<h4 id="org4547e44"><span class="section-number-4">1.4.3</span> 多重分支 <code>cond</code></h4>
<div class="outline-text-4" id="text-1-4-3">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>x 1<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span>
    <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>= x 1<span style="color: #6c71c4;">)</span> 2<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>= x 2<span style="color: #6c71c4;">)</span> 3<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">
2
</pre>
</div>
</div>
<div id="outline-container-orgb799906" class="outline-4">
<h4 id="orgb799906"><span class="section-number-4">1.4.4</span> 布尔运算 <code>and, or, not</code></h4>
<div class="outline-text-4" id="text-1-4-4">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>x 1<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>and <span style="color: #6c71c4;">(</span>or <span style="color: #859900;">(</span>= x 1<span style="color: #859900;">)</span>
               <span style="color: #859900;">(</span>= x 2<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
           <span style="color: #6c71c4;">(</span>not <span style="color: #859900;">(</span>= x 2<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
      2
      3<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">
2
</pre>
</div>
</div>
<div id="outline-container-org3c38b92" class="outline-4">
<h4 id="org3c38b92"><span class="section-number-4">1.4.5</span> 列表上循环 <code>dolist</code></h4>
<div class="outline-text-4" id="text-1-4-5">
<ol class="org-ol">
<li>可以使用 <code>return</code> 结束循环</li>
<li>返回值是 <code>nil</code></li>
</ol>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>x 0<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">dolist</span> <span style="color: #268bd2;">(</span>i '<span style="color: #6c71c4;">(</span>1 2 3<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">(</span>= i 2<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">return</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>setq x <span style="color: #6c71c4;">(</span>+ x i<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  x<span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">
1
</pre>
</div>
</div>
<div id="outline-container-org21939e7" class="outline-4">
<h4 id="org21939e7"><span class="section-number-4">1.4.6</span> 次数循环 <code>dotimes</code></h4>
<div class="outline-text-4" id="text-1-4-6">
<ol class="org-ol">
<li>从0 到 n-1</li>
<li>也可以使用 <code>return</code></li>
</ol>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>x '<span style="color: #6c71c4;">()</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">dotimes</span> <span style="color: #268bd2;">(</span>i 3<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>setf x <span style="color: #6c71c4;">(</span>cons i x<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  x<span style="color: #2aa198;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org95d338b" class="outline-4">
<h4 id="org95d338b"><span class="section-number-4">1.4.7</span> 一般循环 <code>do</code></h4>
<div class="outline-text-4" id="text-1-4-7">
<ol class="org-ol">
<li>变量 <code>var</code> 初始值 <code>init-form</code> 步长 <code>step-form</code> 可以有多个变量</li>
<li>每次之后计算 <code>end-test-form</code> 只要是 <code>nil</code> 就停止循环</li>
<li>停止循环后把 <code>result-form</code> 计算后返回</li>
</ol>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">do</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>var init-form step-form<span style="color: #268bd2;">)</span>* <span style="color: #b58900;">)</span>
    <span style="color: #b58900;">(</span>end-test-form result-form*<span style="color: #b58900;">)</span>
  statement*<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf140ac8" class="outline-4">
<h4 id="orgf140ac8"><span class="section-number-4">1.4.8</span> <code>loop</code> 宏</h4>
<div class="outline-text-4" id="text-1-4-8">
</div>
<ol class="org-ol">
<li><a id="orgad90077"></a>无限循环<br />
<div class="outline-text-5" id="text-1-4-8-1">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">loop</span> 
body<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org22f4198"></a>辅助的宏<br />
<div class="outline-text-5" id="text-1-4-8-2">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">loop</span> for x across <span style="color: #2aa198;">"abcdefghijkl"</span>
     counting <span style="color: #b58900;">(</span>find x <span style="color: #2aa198;">"aeiou"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">
3
</pre>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org280877f" class="outline-3">
<h3 id="org280877f"><span class="section-number-3">1.5</span> 宏</h3>
<div class="outline-text-3" id="text-1-5">
</div>
<div id="outline-container-org6edf953" class="outline-4">
<h4 id="org6edf953"><span class="section-number-4">1.5.1</span> 定义宏 <code>defmacro</code></h4>
<div class="outline-text-4" id="text-1-5-1">
<p>
基本语法：
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmacro</span> <span style="color: #268bd2;">name</span> <span style="color: #b58900;">(</span>parameter*<span style="color: #b58900;">)</span>
  <span style="color: #2aa198;">"Optional documentation string"</span>
  body-form*<span style="color: #2aa198;">)</span>
</pre>
</div>

<p>
宏的实质是构造一个 list ，然后运行这个list。
下面构造了列表语句 <code>(list (funcall #'f) (funcall #'f))</code>
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmacro</span> <span style="color: #268bd2;">m</span> <span style="color: #b58900;">(</span>x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>x <span style="color: #859900;">(</span>funcall x<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
        <span style="color: #6c71c4;">(</span>r '<span style="color: #859900;">(</span>list<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">dotimes</span> <span style="color: #6c71c4;">(</span>i 2<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>setq r <span style="color: #859900;">(</span>append r '<span style="color: #b58900;">(</span>x<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    r<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
    
    
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">f</span> <span style="color: #b58900;">()</span> 2<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>m f<span style="color: #2aa198;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgbfbc4d3" class="outline-4">
<h4 id="orgbfbc4d3"><span class="section-number-4">1.5.2</span> 反引用 <code>`,@</code></h4>
<div class="outline-text-4" id="text-1-5-2">
<ol class="org-ol">
<li>反引用和引用作用是一样的</li>
<li>用逗号恢复求值，方便构造列表</li>
<li><p>
解开列表用 <code>,@</code>
</p>

<p>
这个例子和上面的作用一样，不加逗号的话得到的不是值而是符号
</p></li>
</ol>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmacro</span> <span style="color: #268bd2;">m</span> <span style="color: #b58900;">(</span>x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>x <span style="color: #859900;">(</span>funcall x<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    `<span style="color: #268bd2;">(</span>list ,x ,x ,x<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">f</span> <span style="color: #b58900;">()</span> 2<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>m f<span style="color: #2aa198;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>


<p>
这里显示了解开列表的作用
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmacro</span> <span style="color: #268bd2;">m</span> <span style="color: #b58900;">(</span>x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>x <span style="color: #859900;">(</span>funcall x<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    `<span style="color: #268bd2;">(</span>list ,@x<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">f</span> <span style="color: #b58900;">()</span> '<span style="color: #b58900;">(</span>2 2 2<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>m f<span style="color: #2aa198;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgd2c6086" class="outline-4">
<h4 id="orgd2c6086"><span class="section-number-4">1.5.3</span> 展开宏与调试 <code>macroexpand-1</code></h4>
<div class="outline-text-4" id="text-1-5-3">
<ol class="org-ol">
<li>使用 <code>macrooexpand-1</code> 展开宏，可以看出宏最后要运行的表达式是什么</li>
<li>slime 可以用快捷键 <code>C-c RET</code> 快速展开宏</li>
<li><p>
使用时要转换成列表
</p>

<div class="org-src-container">
<pre class="src src-lisp">    <span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmacro</span> <span style="color: #268bd2;">m</span> <span style="color: #b58900;">(</span>x<span style="color: #b58900;">)</span>
      <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>x <span style="color: #859900;">(</span>funcall x<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
        `<span style="color: #268bd2;">(</span>list ,@x<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

    <span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">f</span> <span style="color: #b58900;">()</span> '<span style="color: #b58900;">(</span>2 2 2<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
    <span style="color: #2aa198;">(</span>macroexpand-1 '<span style="color: #b58900;">(</span>m f<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">LIST</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table></li>
</ol>
</div>
</div>
<div id="outline-container-org83e376a" class="outline-4">
<h4 id="org83e376a"><span class="section-number-4">1.5.4</span> 自动生成变量名 <code>gensym</code></h4>
<div class="outline-text-4" id="text-1-5-4">
<ol class="org-ol">
<li><p>
防止自己使用的变量名与输入的符号重复
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmacro</span> <span style="color: #268bd2;">m</span> <span style="color: #b58900;">(</span>x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let*</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>p <span style="color: #859900;">(</span>gensym<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>x <span style="color: #859900;">(</span>funcall x<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    `<span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">dotimes</span> <span style="color: #6c71c4;">(</span>,p 10<span style="color: #6c71c4;">)</span>
       <span style="color: #6c71c4;">(</span>print <span style="color: #859900;">(</span>list ,p ,@x<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">f</span> <span style="color: #b58900;">()</span> '<span style="color: #b58900;">(</span>1 2 3<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>m f<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>macroexpand-1 '<span style="color: #268bd2;">(</span>m f<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">

       (0 1 2 3) 
       (1 1 2 3) 
       (2 1 2 3) 
       (3 1 2 3) 
       (4 1 2 3) 
       (5 1 2 3) 
       (6 1 2 3) 
       (7 1 2 3) 
       (8 1 2 3) 
       (9 1 2 3) 
       (DOTIMES (#:G576 10) (PRINT (LIST #:G576 1 2 3))) 
</pre></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org917d4ca" class="outline-3">
<h3 id="org917d4ca"><span class="section-number-3">1.6</span> 面向对象 CLOS</h3>
<div class="outline-text-3" id="text-1-6">
</div>
<div id="outline-container-org6bb88c3" class="outline-4">
<h4 id="org6bb88c3"><span class="section-number-4">1.6.1</span> 创建类和访问实例的属性 <code>defclass, make-instance, slot-value, with-accessors</code></h4>
<div class="outline-text-4" id="text-1-6-1">
<ol class="org-ol">
<li>类由 <code>defclass</code> 定义</li>
<li>属性叫做槽 slot</li>
<li>初始化实例用 <code>make-instance</code></li>
<li>访问实例的属性用 <code>with-accessors, with-slots, slot-value</code></li>
</ol>

<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21019;&#24314;&#31867;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#27133; slots &#23383;&#27573;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:initarg &#21021;&#22987;&#21270;&#26102;&#20351;&#29992;&#30340;&#31526;&#21495;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:initform &#40664;&#35748;&#20540;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:accesor &#35775;&#38382;&#20989;&#25968;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:documentation &#23383;&#27573;&#30340;&#25991;&#26723;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:allocation :class &#25351;&#23450;&#27133;&#26159;&#31867;&#25152;&#26377;&#23454;&#20363;&#20844;&#29992;&#30340;,&#40664;&#35748;&#20540; :instance</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defclass</span> <span style="color: #b58900;">person</span> <span style="color: #b58900;">()</span>
  <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>name <span style="color: #657b83; font-weight: bold;">:initarg</span> <span style="color: #657b83; font-weight: bold;">:name</span>
         <span style="color: #657b83; font-weight: bold;">:initform</span> <span style="color: #2aa198;">"name"</span>
         <span style="color: #657b83; font-weight: bold;">:accessor</span> name
         <span style="color: #657b83; font-weight: bold;">:documentation</span> <span style="color: #2aa198;">"doc of name"</span><span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span>lisper <span style="color: #657b83; font-weight: bold;">:initform</span> nil
           <span style="color: #657b83; font-weight: bold;">:accessor</span> lisper<span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span>all <span style="color: #657b83; font-weight: bold;">:initform</span> <span style="color: #2aa198;">"all"</span>
        <span style="color: #657b83; font-weight: bold;">:accessor</span> all
        <span style="color: #657b83; font-weight: bold;">:allocation</span> <span style="color: #657b83; font-weight: bold;">:class</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21019;&#24314;&#31867;&#30340;&#23454;&#20363;&#65292;&#21516;&#26102;&#25351;&#23450;&#21021;&#22987;&#21270;&#20540;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defvar</span> <span style="color: #268bd2;">p1</span> <span style="color: #b58900;">(</span>make-instance 'person <span style="color: #657b83; font-weight: bold;">:name</span> <span style="color: #2aa198;">"p1"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defvar</span> <span style="color: #268bd2;">p2</span> <span style="color: #b58900;">(</span>make-instance 'person<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#35775;&#38382;&#23454;&#20363;&#30340;&#23646;&#24615;&#20540;</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>slot-value p2 'name<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#36890;&#36807;&#35775;&#38382;&#20989;&#25968;&#33719;&#21462;&#23454;&#20363;&#30340;&#23646;&#24615;&#20540;</span>
<span style="color: #2aa198;">(</span>format t <span style="color: #2aa198;">"accessor (name p1):~t~s"</span> <span style="color: #b58900;">(</span>name p1<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>setf <span style="color: #b58900;">(</span>lisper p1<span style="color: #b58900;">)</span> t<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>format t <span style="color: #2aa198;">"accessor (lisper p1):~t~s"</span> <span style="color: #b58900;">(</span>lisper p1<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#20351;&#29992;&#27133;&#30340;&#21517;&#23383;&#36827;&#34892;&#35775;&#38382;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">with-slots</span> <span style="color: #b58900;">(</span>name lisper<span style="color: #b58900;">)</span> p1
  <span style="color: #b58900;">(</span>pprint name<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#20351;&#29992;&#35775;&#38382;&#20989;&#25968;&#30340;&#21517;&#23383;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">with-accessors</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>n1 name<span style="color: #268bd2;">)</span>
                 <span style="color: #268bd2;">(</span>a1 all<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span> <span style="color: #cb4b16; font-weight: bold;">p1</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">with-accessors</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>n2 name<span style="color: #6c71c4;">)</span>
                   <span style="color: #6c71c4;">(</span>a2 all<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> <span style="color: #cb4b16; font-weight: bold;">p2</span>
    <span style="color: #268bd2;">(</span>format t <span style="color: #2aa198;">"&#35775;&#38382;&#23454;&#20363;&#23646;&#24615;&#65306;p1.name:~s,~tp2.name:~s"</span> n1 n2<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>setf a1 <span style="color: #2aa198;">"a1"</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>setf a2 <span style="color: #2aa198;">"a2"</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>format t <span style="color: #2aa198;">"&#35775;&#38382;&#20844;&#29992;&#23646;&#24615;&#65306;p1.all:~s,~tp2.all:~s"</span> a1 a2<span style="color: #268bd2;">)</span>
    <span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>



<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21021;&#22987;&#21270;&#20989;&#25968;&#65292;&#20063;&#23601;&#26159;&#26500;&#36896;&#20989;&#25968;&#65292;&#21644;python&#30340; __init__ &#19968;&#26679;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">initialize-instance</span> <span style="color: #657b83; font-weight: bold;">:after</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>p person<span style="color: #268bd2;">)</span>  <span style="color: #b58900;">&amp;key</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>print <span style="color: #268bd2;">(</span>slot-value p 'name<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>setf <span style="color: #268bd2;">(</span>slot-value p 'lisper<span style="color: #268bd2;">)</span> t<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21024;&#38500;&#26576;&#31867;&#30340;&#26041;&#27861;</span>
<span style="color: #2aa198;">(</span>remove-method #'initialize-instance
               <span style="color: #b58900;">(</span>find-method #'initialize-instance <span style="color: #268bd2;">()</span>
                            <span style="color: #268bd2;">(</span>list <span style="color: #6c71c4;">(</span>find-class 'person<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org6905515" class="outline-4">
<h4 id="org6905515"><span class="section-number-4">1.6.2</span> 创建和使用方法 <code>defgeneric,defmethod,call-next-method</code></h4>
<div class="outline-text-4" id="text-1-6-2">
<ol class="org-ol">
<li>抽象函数的定义不是必须的，但为了有个地方放文档，还是要把它定义出来</li>
<li>抽象函数的参数表没有任何限制，所有只要实现方法时对不同参数指定不同的类就能实现方法的组合，即多重分发，这在一般的语言中是不能实现的</li>
<li>特化得到有效方法的组合， <code>call-next-method</code> 会找到所有可以执行的函数，然后按照一定的顺序执行它们，子类总是最先执行的</li>
<li>方法组合有 9 种和两个顺序，绝大多数情况都是标准顺序不用动
<ol class="org-ol">
<li><code>+, and, append, list, max, min, nconc, or, progn, standard</code></li>
<li><code>:most-specific-first, :most-specific-last</code></li>
</ol></li>
</ol>

<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defclass</span> <span style="color: #b58900;">person</span> <span style="color: #b58900;">()</span>
  <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>name <span style="color: #657b83; font-weight: bold;">:initform</span> <span style="color: #2aa198;">"name"</span>
         <span style="color: #657b83; font-weight: bold;">:initarg</span> <span style="color: #657b83; font-weight: bold;">:name</span><span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span>age <span style="color: #657b83; font-weight: bold;">:initform</span> 0
        <span style="color: #657b83; font-weight: bold;">:initarg</span> <span style="color: #657b83; font-weight: bold;">:age</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defclass</span> <span style="color: #b58900;">child</span> <span style="color: #b58900;">(</span>person<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>ischild <span style="color: #657b83; font-weight: bold;">:initform</span> nil
            <span style="color: #657b83; font-weight: bold;">:initarg</span> <span style="color: #657b83; font-weight: bold;">:ischild</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#23450;&#20041;&#25277;&#35937;&#20989;&#25968;,&#21442;&#25968;&#21482;&#34920;&#31034;&#20301;&#32622;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26041;&#27861;&#32452;&#21512;&#40664;&#35748;&#20026;&#30456;&#20851;&#20248;&#20808;&#39034;&#24207; standard</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defgeneric</span> <span style="color: #268bd2;">name-times</span> <span style="color: #b58900;">(</span>person times<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:documentation</span> <span style="color: #2aa198;">"print name for n times"</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:method-combination</span> standard<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#20026;&#29238;&#31867;&#23454;&#29616;&#20989;&#25968;&#65292;&#21442;&#25968;&#34920;&#31532;&#20108;&#20803;&#32032;&#34920;&#31034;&#21442;&#25968;&#30340;&#31867;&#65292;&#40664;&#35748;&#20026; t&#65292;&#21363;&#25152;&#26377;&#31867;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">name-times</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>p person<span style="color: #268bd2;">)</span> times<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">dotimes</span> <span style="color: #268bd2;">(</span>i times<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>print <span style="color: #6c71c4;">(</span>slot-value p 'name<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#20026;&#23376;&#31867;&#23454;&#29616;&#20989;&#25968;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">call-next-method &#34920;&#31034;&#25191;&#34892;&#21487;&#32452;&#21512;&#30340;&#20854;&#23427;&#26041;&#27861;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">name-times</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>p child<span style="color: #268bd2;">)</span> times<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>print <span style="color: #2aa198;">"child:\t"</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>call-next-method<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26631;&#20934;&#26041;&#27861;&#32452;&#21512;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:before &#20027;&#20989;&#25968;&#20043;&#21069;&#36816;&#34892;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">name-times</span> <span style="color: #657b83; font-weight: bold;">:before</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>p child<span style="color: #268bd2;">)</span> times<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>print <span style="color: #2aa198;">"child:before;"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:after &#26368;&#21518;&#36816;&#34892;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">name-times</span> <span style="color: #657b83; font-weight: bold;">:after</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>p child<span style="color: #268bd2;">)</span> times<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>print <span style="color: #2aa198;">"child:after;"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:around &#22312;&#25152;&#26377;&#26041;&#27861;&#20043;&#21069;&#36816;&#34892;&#65292;&#38656;&#35201;&#21547;&#26377; call-next-method&#25165;&#34892;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">name-times</span> <span style="color: #657b83; font-weight: bold;">:around</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>p child<span style="color: #268bd2;">)</span> times<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>print <span style="color: #2aa198;">"child:around;"</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>call-next-method<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>p1 <span style="color: #6c71c4;">(</span>make-instance 'child <span style="color: #657b83; font-weight: bold;">:ischild</span> t<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>name-times p1 4<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">

"child:around;" 
"child:before;" 
"child:t" 
"name" 
"name" 
"name" 
"name" 
"child:after;" 
</pre>
</div>
</div>
</div>

<div id="outline-container-orge1de78d" class="outline-3">
<h3 id="orge1de78d"><span class="section-number-3">1.7</span> 错误处理</h3>
<div class="outline-text-3" id="text-1-7">
<ol class="org-ol">
<li>定义新的异常用 <code>define-condition</code></li>
<li>抛出异常 <code>error</code></li>
<li>处理异常用 <code>handler-bind, handler-case</code></li>
<li>再启动用 <code>restart-case, invoke-restart</code></li>
</ol>

<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#23450;&#20041;&#29366;&#20917;,&#21644;&#31867;&#19968;&#26679;,&#20063;&#23601;&#26159;&#24322;&#24120;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define-condition</span> <span style="color: #268bd2;">my-error</span> <span style="color: #b58900;">(</span><span style="color: #cb4b16; font-weight: bold;">error</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>text <span style="color: #657b83; font-weight: bold;">:initarg</span> <span style="color: #657b83; font-weight: bold;">:text</span> <span style="color: #657b83; font-weight: bold;">:initform</span> <span style="color: #2aa198;">"error"</span> <span style="color: #657b83; font-weight: bold;">:accessor</span> text<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define-condition</span> <span style="color: #268bd2;">my-error-2</span> <span style="color: #b58900;">(</span><span style="color: #cb4b16; font-weight: bold;">error</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>text <span style="color: #657b83; font-weight: bold;">:initarg</span> <span style="color: #657b83; font-weight: bold;">:text</span> <span style="color: #657b83; font-weight: bold;">:initform</span> <span style="color: #2aa198;">"error"</span> <span style="color: #657b83; font-weight: bold;">:accessor</span> text<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>


<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#25243;&#20986;&#19968;&#20010;&#24322;&#24120;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">dotimes</span> <span style="color: #b58900;">(</span>i 10<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">when</span> <span style="color: #268bd2;">(</span>= i 3<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #cb4b16; font-weight: bold;">error</span> 'my-error <span style="color: #657b83; font-weight: bold;">:text</span> <span style="color: #2aa198;">"e"</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>print i<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#22788;&#29702;&#24322;&#24120;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">dotimes</span> <span style="color: #b58900;">(</span>i 10<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">handler-case</span>
      <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">progn</span>
        <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">when</span> <span style="color: #859900;">(</span>= i 2<span style="color: #859900;">)</span> 
          <span style="color: #859900;">(</span><span style="color: #cb4b16; font-weight: bold;">error</span> 'my-error <span style="color: #657b83; font-weight: bold;">:text</span> <span style="color: #2aa198;">"e"</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
        <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">when</span> <span style="color: #859900;">(</span>= i 4<span style="color: #859900;">)</span> 
          <span style="color: #859900;">(</span><span style="color: #cb4b16; font-weight: bold;">error</span> 'my-error-2 <span style="color: #657b83; font-weight: bold;">:text</span> <span style="color: #2aa198;">"e"</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
        <span style="color: #6c71c4;">(</span>print i<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>my-error <span style="color: #6c71c4;">()</span> <span style="color: #6c71c4;">(</span>print <span style="color: #2aa198;">"asd"</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>my-error-2 <span style="color: #6c71c4;">(</span>c<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>print <span style="color: #859900;">(</span>text c<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#20877;&#21551;&#21160;&#22788;&#29702;&#24322;&#24120;&#65292;&#25163;&#21160;&#36873;&#25321;&#25191;&#34892;&#21738;&#20010;&#20989;&#25968;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">restart-case</span>
    <span style="color: #b58900;">(</span><span style="color: #cb4b16; font-weight: bold;">error</span> 'my-error<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>use-value <span style="color: #268bd2;">(</span>value<span style="color: #268bd2;">)</span> value<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>return-nil <span style="color: #268bd2;">()</span> nil<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>skip-it <span style="color: #268bd2;">()</span> <span style="color: #268bd2;">(</span>print <span style="color: #2aa198;">"skip"</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>input-a-number <span style="color: #268bd2;">(</span>v<span style="color: #268bd2;">)</span>
    <span style="color: #657b83; font-weight: bold;">:report</span> <span style="color: #2aa198;">"please input a number"</span>
    <span style="color: #657b83; font-weight: bold;">:interactive</span> <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #6c71c4;">()</span>
                   <span style="color: #6c71c4;">(</span>format t <span style="color: #2aa198;">"Enter: "</span><span style="color: #6c71c4;">)</span>
                   <span style="color: #6c71c4;">(</span>list <span style="color: #859900;">(</span>read<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>format t <span style="color: #2aa198;">"you input: ~a~&amp;"</span> v<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>


<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#33258;&#21160;&#25191;&#34892;&#19968;&#20010;&#20989;&#25968;&#65292;&#28982;&#21518;&#36827;&#20837;&#20877;&#21551;&#21160;&#27169;&#24335;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">my-error-skip</span> <span style="color: #b58900;">(</span>c<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">declare</span> <span style="color: #268bd2;">(</span>ignore c<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>print <span style="color: #2aa198;">"my error skip"</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>r <span style="color: #859900;">(</span>find-restart 'my-error-skip<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">when</span> r  <span style="color: #6c71c4;">(</span>invoke-restart r<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">handler-bind</span>
    <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>my-error #'my-error-skip<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #cb4b16; font-weight: bold;">error</span> 'my-error<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>


<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#24573;&#30053;&#25152;&#26377;&#24322;&#24120;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">ignore-errors</span>
  <span style="color: #b58900;">(</span><span style="color: #cb4b16; font-weight: bold;">error</span> 'my-error<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#25429;&#33719;&#25152;&#26377;&#24322;&#24120;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">handler-case</span> <span style="color: #b58900;">(</span>/ 3 0<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #cb4b16; font-weight: bold;">error</span> <span style="color: #268bd2;">(</span>c<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>format t <span style="color: #2aa198;">"We caught a condition.~&amp;"</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>values 0 c<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#20351;&#29992; use-value &#20195;&#26367;&#38169;&#35823;&#30340;&#20540;&#65292;&#38656;&#35201;&#23450;&#21046;&#24322;&#24120;&#31867;&#22411;&#25165;&#33021;&#24037;&#20316;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">c-use-value</span> <span style="color: #b58900;">(</span>c<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>use-value <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #6c71c4;">(</span>arg<span style="color: #6c71c4;">)</span>
               <span style="color: #6c71c4;">(</span>format t <span style="color: #2aa198;">"~%dummy function with arg ~a~%"</span> arg<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
             c<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">handler-bind</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>undefined-function #'c-use-value<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>this-function-does-not-exist <span style="color: #2aa198;">"foo"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#20135;&#29983;&#35686;&#21578;</span>
<span style="color: #2aa198;">(</span><span style="color: #cb4b16; font-weight: bold;">warn</span> <span style="color: #2aa198;">"asd"</span><span style="color: #2aa198;">)</span>



</pre>
</div>
</div>
</div>

<div id="outline-container-org0bcfee9" class="outline-3">
<h3 id="org0bcfee9"><span class="section-number-3">1.8</span> 包系统</h3>
<div class="outline-text-3" id="text-1-8">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#23450;&#20041;&#21253;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:nicknames &#35774;&#32622;&#21253;&#30340;&#21035;&#21517;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:use &#25351;&#23450;&#20351;&#29992;&#30340;&#21253;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:export &#25351;&#23450;&#22806;&#37096;&#21517;&#23383;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:shadow &#19981;&#23548;&#20837;&#30340;&#20989;&#25968;&#21517;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:import-from &#20174;&#21253;&#23548;&#20837;&#20989;&#25968;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:shdowing-import-from &#20351;&#29992;&#20854;&#23427;&#21253;&#20013;&#30340;&#20989;&#25968;&#32780;&#19981;&#26159;&#33258;&#24049;&#21253;&#20013;&#30340;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defpackage</span> <span style="color: #b58900;">:com.my.p1</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:nicknames</span> <span style="color: #657b83; font-weight: bold;">:cmp1</span> <span style="color: #657b83; font-weight: bold;">:cmpp1</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:use</span> <span style="color: #657b83; font-weight: bold;">:common-lisp</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:export</span> <span style="color: #93a1a1;">#:</span><span style="color: #2aa198;">func1</span> <span style="color: #93a1a1;">#:</span><span style="color: #2aa198;">func2</span> <span style="color: #93a1a1;">#:</span><span style="color: #2aa198;">func3</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>


<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defpackage</span> <span style="color: #b58900;">:com.my.p2</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:use</span> <span style="color: #657b83; font-weight: bold;">:common-lisp</span> <span style="color: #657b83; font-weight: bold;">:com.my.p1</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:import-from</span> <span style="color: #657b83; font-weight: bold;">:com.my.p1</span> <span style="color: #657b83; font-weight: bold;">:func1</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:shadow</span> <span style="color: #657b83; font-weight: bold;">:func2</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:shadowing-import-from</span> <span style="color: #657b83; font-weight: bold;">:com.my.p1</span> <span style="color: #657b83; font-weight: bold;">:func3</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#25104;&#20026;&#24403;&#21069;&#21253;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">in-package</span> <span style="color: #657b83; font-weight: bold;">:com.my.p1</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">func1</span> <span style="color: #b58900;">()</span> <span style="color: #b58900;">(</span>print <span style="color: #2aa198;">"func1 from p1"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">func2</span> <span style="color: #b58900;">()</span> <span style="color: #b58900;">(</span>print <span style="color: #2aa198;">"func2 from p1"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">func3</span> <span style="color: #b58900;">()</span> <span style="color: #b58900;">(</span>print <span style="color: #2aa198;">"func3 from p1"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#35774;&#32622;&#21253;&#30340;&#23616;&#22495;&#21035;&#21517;</span>
<span style="color: #2aa198;">(</span>rename-package <span style="color: #657b83; font-weight: bold;">:common-lisp</span> <span style="color: #657b83; font-weight: bold;">:common-lisp</span> '<span style="color: #b58900;">(</span>mmp<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>symbol-package 'mmp:defun<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26597;&#30475;&#24403;&#21069;&#21253;&#21517;</span>
<span style="color: #2aa198;">(</span>print *package*<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26597;&#35810;&#31526;&#21495;&#22312;&#21738;&#20010;&#21253;&#20013;</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>package-name <span style="color: #268bd2;">(</span>symbol-package 'defun<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21015;&#20986;&#21253;&#20013;&#25152;&#26377;&#31526;&#21495;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #b58900;">(</span>symbols<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">do-external-symbols</span> <span style="color: #268bd2;">(</span>s <span style="color: #6c71c4;">(</span>find-package <span style="color: #2aa198;">"COMMON-LISP"</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>push s symbols<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  symbols<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26597;&#35810;&#21253;&#20351;&#29992;&#20102;&#21738;&#20123;&#21253;</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>mapcar #'package-name <span style="color: #268bd2;">(</span>package-use-list <span style="color: #657b83; font-weight: bold;">:cl-user</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgca7738a" class="outline-3">
<h3 id="orgca7738a"><span class="section-number-3">1.9</span> 类型与注解</h3>
</div>
<div id="outline-container-org5aa5207" class="outline-3">
<h3 id="org5aa5207"><span class="section-number-3">1.10</span> loop 宏</h3>
</div>
<div id="outline-container-orgb80a672" class="outline-3">
<h3 id="orgb80a672"><span class="section-number-3">1.11</span> format 宏</h3>
</div>
</div>
<div id="outline-container-org121978e" class="outline-2">
<h2 id="org121978e"><span class="section-number-2">2</span> 标准库</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgd96fc95" class="outline-3">
<h3 id="orgd96fc95"><span class="section-number-3">2.1</span> 数字</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-org4b93b58" class="outline-4">
<h4 id="org4b93b58"><span class="section-number-4">2.1.1</span> 数字的表示</h4>
<div class="outline-text-4" id="text-2-1-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><code>123</code></td>
<td class="org-left">任意大整数</td>
</tr>

<tr>
<td class="org-left"><code>-1/2</code></td>
<td class="org-left">分数</td>
</tr>

<tr>
<td class="org-left"><code>1.3</code></td>
<td class="org-left">分数</td>
</tr>

<tr>
<td class="org-left"><code>#b101</code></td>
<td class="org-left">二进制</td>
</tr>

<tr>
<td class="org-left"><code>#o777</code></td>
<td class="org-left">八进制</td>
</tr>

<tr>
<td class="org-left"><code>#xDA</code></td>
<td class="org-left">十六进制</td>
</tr>

<tr>
<td class="org-left"><code>#36rASD</code></td>
<td class="org-left">三十六进制</td>
</tr>

<tr>
<td class="org-left"><code>1e2</code></td>
<td class="org-left">科学计数法</td>
</tr>

<tr>
<td class="org-left"><code>1s</code></td>
<td class="org-left">短型浮点数</td>
</tr>

<tr>
<td class="org-left"><code>1f</code></td>
<td class="org-left">单精度浮点数</td>
</tr>

<tr>
<td class="org-left"><code>1d</code></td>
<td class="org-left">双精度浮点数</td>
</tr>

<tr>
<td class="org-left"><code>1l</code></td>
<td class="org-left">长型浮点数</td>
</tr>

<tr>
<td class="org-left"><code>#c(2,3)</code></td>
<td class="org-left">复数</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org7202dd6" class="outline-4">
<h4 id="org7202dd6"><span class="section-number-4">2.1.2</span> 算术运算 <code>mod,rem,floor,ceiling,truncate,round</code></h4>
<div class="outline-text-4" id="text-2-1-2">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>+ 1 2<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#21152;</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>- 1 2<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#20943;</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>* 1 2<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#20056;</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>/ 1 2<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#38500;</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>mod 5 3<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#21462;&#27169;</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>rem 5 3<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#20313;&#25968;</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>floor 1.35<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#21521;&#36127;&#26080;&#31351;&#25130;&#26029;</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>ceiling 1.35<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#21521;&#27491;&#26080;&#31351;&#25130;&#26029;</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>truncate 1.35<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#21521;&#38646;&#25130;&#26029;</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>truncate -1.35<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#21521;&#38646;&#25130;&#26029;</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>round 1.35<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#22235;&#33293;&#20116;&#20837;</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>round 1.5<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#22235;&#33293;&#20116;&#20837;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>x 1<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>incf x<span style="color: #b58900;">)</span> <span style="color: #93a1a1;">; &#33258;&#20943;1&#65292;&#20462;&#25913;&#20540;</span>
  <span style="color: #b58900;">(</span>decf x<span style="color: #b58900;">)</span> <span style="color: #93a1a1;">; &#33258;&#22686;1&#65292;&#20462;&#25913;&#20540;</span>
  <span style="color: #b58900;">(</span>1+ x<span style="color: #b58900;">)</span> <span style="color: #93a1a1;">; &#21152;1&#65292;&#19981;&#20462;&#25913;&#20540;</span>
  <span style="color: #b58900;">(</span>1- x<span style="color: #b58900;">)</span> <span style="color: #93a1a1;">; &#20943;1&#65292; &#19981;&#20462;&#25913;&#20540;</span>
  <span style="color: #2aa198;">)</span>
</pre>
</div>

<pre class="example">

3 
-1 
2 
1/2 
2 
2 
1 
2 
1 
-1 
1 
2 
</pre>
</div>
</div>
<div id="outline-container-orgb27107b" class="outline-4">
<h4 id="orgb27107b"><span class="section-number-4">2.1.3</span> 数值比较</h4>
<div class="outline-text-4" id="text-2-1-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><code>=</code></td>
<td class="org-left">相等</td>
</tr>

<tr>
<td class="org-left"><code>/=</code></td>
<td class="org-left">不相等</td>
</tr>

<tr>
<td class="org-left"><code>&lt;,&gt;,&gt;=,&lt;=</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>max</code></td>
<td class="org-left">最大值</td>
</tr>

<tr>
<td class="org-left"><code>min</code></td>
<td class="org-left">最小值</td>
</tr>

<tr>
<td class="org-left"><code>zerop</code></td>
<td class="org-left">等于0</td>
</tr>

<tr>
<td class="org-left"><code>minusp</code></td>
<td class="org-left">小于0</td>
</tr>

<tr>
<td class="org-left"><code>plusp</code></td>
<td class="org-left">大于0</td>
</tr>

<tr>
<td class="org-left"><code>evenp</code></td>
<td class="org-left">偶数</td>
</tr>

<tr>
<td class="org-left"><code>oddp</code></td>
<td class="org-left">奇数</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org928933a" class="outline-4">
<h4 id="org928933a"><span class="section-number-4">2.1.4</span> 数学函数</h4>
<div class="outline-text-4" id="text-2-1-4">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><code>log</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>exp</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>expt</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>sin,cos,tan</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>asin,acos,atan</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>sinh,cosh,tanh</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>asinh,acosh,atanh</code></td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-orgc01eff0" class="outline-3">
<h3 id="orgc01eff0"><span class="section-number-3">2.2</span> 字符</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-org512f8a5" class="outline-4">
<h4 id="org512f8a5"><span class="section-number-4">2.2.1</span> 字符的表示</h4>
<div class="outline-text-4" id="text-2-2-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><code>#\x</code></td>
<td class="org-left">x</td>
</tr>

<tr>
<td class="org-left"><code>#\Space</code></td>
<td class="org-left">空格</td>
</tr>

<tr>
<td class="org-left"><code>#\Newline</code></td>
<td class="org-left">换行</td>
</tr>

<tr>
<td class="org-left"><code>#\Tab</code></td>
<td class="org-left">制表符</td>
</tr>

<tr>
<td class="org-left"><code>#\Backspace</code></td>
<td class="org-left">退格</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org545b5eb" class="outline-4">
<h4 id="org545b5eb"><span class="section-number-4">2.2.2</span> 字符的比较</h4>
<div class="outline-text-4" id="text-2-2-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><code>char=</code></td>
<td class="org-left">相等,大小写相关</td>
</tr>

<tr>
<td class="org-left"><code>char-equal</code></td>
<td class="org-left">相等，大小写无关</td>
</tr>

<tr>
<td class="org-left"><code>char/=</code></td>
<td class="org-left">不等，大小写相关</td>
</tr>

<tr>
<td class="org-left"><code>char-not-equal</code></td>
<td class="org-left">不等，大小写无关</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-org449aeaa" class="outline-3">
<h3 id="org449aeaa"><span class="section-number-3">2.3</span> 字符串</h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-org40c4128" class="outline-4">
<h4 id="org40c4128"><span class="section-number-4">2.3.1</span> 字符串的表示</h4>
<div class="outline-text-4" id="text-2-3-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><code>"asd"</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>"\""</code></td>
<td class="org-left">转义</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgf1c8791" class="outline-4">
<h4 id="orgf1c8791"><span class="section-number-4">2.3.2</span> 字符串的比较</h4>
<div class="outline-text-4" id="text-2-3-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><code>string=</code></td>
<td class="org-left">相等,大小写相关</td>
</tr>

<tr>
<td class="org-left"><code>string-equal</code></td>
<td class="org-left">相等，大小写无关</td>
</tr>

<tr>
<td class="org-left"><code>string/=</code></td>
<td class="org-left">不等，大小写相关</td>
</tr>

<tr>
<td class="org-left"><code>string-not-equal</code></td>
<td class="org-left">不等，大小写无关</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-org13c1f99" class="outline-3">
<h3 id="org13c1f99"><span class="section-number-3">2.4</span> 向量或序列</h3>
<div class="outline-text-3" id="text-2-4">
<p>
vector, 一维数组 sequence
</p>
</div>
<div id="outline-container-org62f57fc" class="outline-4">
<h4 id="org62f57fc"><span class="section-number-4">2.4.1</span> 创建向量 <code>vector, make-array</code></h4>
<div class="outline-text-4" id="text-2-4-1">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21019;&#24314;&#21521;&#37327;</span>
<span style="color: #2aa198;">(</span>vector 1<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#23383;&#38754;&#37327;</span>
#<span style="color: #2aa198;">(</span>1<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#35774;&#32622;&#21021;&#20540;&#21644;&#22823;&#23567;</span>
<span style="color: #2aa198;">(</span>make-array 4 <span style="color: #657b83; font-weight: bold;">:initial-element</span> nil<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21019;&#24314;&#23450;&#38271;&#21487;&#21464;&#25968;&#32452;</span>
<span style="color: #2aa198;">(</span>make-array 5 <span style="color: #657b83; font-weight: bold;">:fill-pointer</span> 0<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#22635;&#20805;&#21487;&#21464;&#25968;&#32452;</span>
<span style="color: #2aa198;">(</span>vector-push 'a vec<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21462;&#20986;&#21487;&#21464;&#25968;&#32452;</span>
<span style="color: #2aa198;">(</span>vector-pop vec<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21019;&#24314;&#21487;&#21464;&#38271;&#25968;&#32452;</span>
<span style="color: #2aa198;">(</span>make-array 5 <span style="color: #657b83; font-weight: bold;">:fill-pointer</span> <span style="color: #657b83; font-weight: bold;">:adjustable</span> t<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21487;&#21464;&#38271;&#23383;&#31526;&#25968;&#32452;&#65292;&#20063;&#23601;&#26159;&#23383;&#31526;&#20018;</span>
<span style="color: #2aa198;">(</span>make-array 5 <span style="color: #657b83; font-weight: bold;">:fill-pointer</span> <span style="color: #657b83; font-weight: bold;">:adjustable</span> t <span style="color: #657b83; font-weight: bold;">:element-type</span> 'character<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21462;&#20986;&#31532;n&#20010;&#20803;&#32032;&#65292;&#21487;&#37325;&#35774;&#20540;&#22823;&#23567;</span>
<span style="color: #2aa198;">(</span>elt vec n<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>setf <span style="color: #b58900;">(</span>elt vec n<span style="color: #b58900;">)</span> x<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org700c5e4" class="outline-4">
<h4 id="org700c5e4"><span class="section-number-4">2.4.2</span> 项操作函数 <code>count,find,position,remove,substitute</code></h4>
<div class="outline-text-4" id="text-2-4-2">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#20986;&#29616;&#26576;&#39033;&#30340;&#27425;&#25968;</span>
<span style="color: #2aa198;">(</span>count 1 #<span style="color: #b58900;">(</span>1 2 3 1<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#25214;&#21040;&#31532;&#19968;&#20010;&#32034;&#24341;&#20301;&#32622;</span>
<span style="color: #2aa198;">(</span>find 2  #<span style="color: #b58900;">(</span>1 2 3 1<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#36820;&#22238;&#25152;&#26377;&#32034;&#24341;&#20301;&#32622;</span>
<span style="color: #2aa198;">(</span>position 1 #<span style="color: #b58900;">(</span>1 2 3 1<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#31227;&#38500;&#39033;</span>
<span style="color: #2aa198;">(</span>remove 1 #<span style="color: #b58900;">(</span>1 2 3 1<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#29992;&#26032;&#30340;&#39033;&#21462;&#20195;&#26087;&#30340;&#39033;</span>
<span style="color: #2aa198;">(</span>substitute 10 1 #<span style="color: #b58900;">(</span>1 2 3 1<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<p>
可以选择使用关键字参数改变行为
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><code>:test</code></td>
<td class="org-left">比较函数</td>
</tr>

<tr>
<td class="org-left"><code>:key</code></td>
<td class="org-left">对每项修改后用于比较</td>
</tr>

<tr>
<td class="org-left"><code>:start</code></td>
<td class="org-left">开始位置</td>
</tr>

<tr>
<td class="org-left"><code>:end</code></td>
<td class="org-left">结束位置</td>
</tr>

<tr>
<td class="org-left"><code>:from-end</code></td>
<td class="org-left">逆序</td>
</tr>

<tr>
<td class="org-left"><code>:count</code></td>
<td class="org-left">执行次数</td>
</tr>
</tbody>
</table>

<p>
对每个函数都有相应的 <code>-if</code> 和 <code>-if-not</code> 版本，用来加比较函数，只有为真的才被处理。
</p>
</div>
</div>
<div id="outline-container-orgdbda18c" class="outline-4">
<h4 id="orgdbda18c"><span class="section-number-4">2.4.3</span> 序列整体操作函数 <code>copy-seq,reverse,concatenate, sort,merge, subseq, search, mismatch</code></h4>
<div class="outline-text-4" id="text-2-4-3">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#22797;&#21046;</span>
<span style="color: #2aa198;">(</span>copy-seq vec<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21453;&#24207;</span>
<span style="color: #2aa198;">(</span>reverse vec<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#36830;&#25509;&#22810;&#20010;&#24207;&#21015;&#65292;&#31532;&#19968;&#20010;&#21442;&#25968;&#38656;&#35201;&#25351;&#23450;&#29983;&#25104;&#30340;&#31867;&#22411;</span>
<span style="color: #2aa198;">(</span>concatenate 'vector #<span style="color: #b58900;">(</span>1 2<span style="color: #b58900;">)</span> #<span style="color: #b58900;">(</span>3 4<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>concatenate 'list #<span style="color: #b58900;">(</span>1 2<span style="color: #b58900;">)</span> #<span style="color: #b58900;">(</span>3 4<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#25490;&#24207;</span>
<span style="color: #2aa198;">(</span>sort #<span style="color: #b58900;">(</span>1 2 3<span style="color: #b58900;">)</span> #'&gt;<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21512;&#24182;&#25490;&#24207;&#20004;&#20010;&#24207;&#21015;&#65292;&#38656;&#35201;&#25351;&#23450;&#29983;&#25104;&#31867;&#22411;</span>
<span style="color: #2aa198;">(</span>merge 'vector #<span style="color: #b58900;">(</span>1 2<span style="color: #b58900;">)</span> #<span style="color: #b58900;">(</span>3 4<span style="color: #b58900;">)</span> #'&gt;<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21462;&#20986;&#23376;&#24207;&#21015;</span>
<span style="color: #2aa198;">(</span>subseq #<span style="color: #b58900;">(</span>1 2 3 4<span style="color: #b58900;">)</span> 3<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>subseq #<span style="color: #b58900;">(</span>1 2 3 4<span style="color: #b58900;">)</span> 1 3<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#23376;&#24207;&#21015;&#30340;&#20301;&#32622;</span>
<span style="color: #2aa198;">(</span>search #<span style="color: #b58900;">(</span>1 2<span style="color: #b58900;">)</span> #<span style="color: #b58900;">(</span>1 2 3 4<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#27604;&#36739;&#24207;&#21015;&#65292;&#36820;&#22238;&#31532;&#19968;&#20010;&#19981;&#21516;&#20301;&#32622;</span>
<span style="color: #2aa198;">(</span>mismatch seq1 seq2<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf54990a" class="outline-4">
<h4 id="orgf54990a"><span class="section-number-4">2.4.4</span> 遍历操作函数 <code>every,some,notany,notevery, map,reduce</code></h4>
<div class="outline-text-4" id="text-2-4-4">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#27599;&#19968;&#20010;&#37117;&#20026;&#30495;</span>
<span style="color: #2aa198;">(</span>every #'evenp #<span style="color: #b58900;">(</span>1 2 3 4<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26377;&#19968;&#20010;&#20026;&#30495;</span>
<span style="color: #2aa198;">(</span>some #'evenp #<span style="color: #b58900;">(</span>1 2 3 4<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26377;&#30495;&#26102;&#36820;&#22238;&#20551;</span>
<span style="color: #2aa198;">(</span>notany #'evenp #<span style="color: #b58900;">(</span>1 2 3 4<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#37117;&#30495;&#26102;&#36820;&#22238;&#20551;</span>
<span style="color: #2aa198;">(</span>notevery #'evenp #<span style="color: #b58900;">(</span>1 2 3 4<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#19978;&#38754;&#22235;&#20010;&#20989;&#25968;&#37117;&#21487;&#27604;&#36739;&#20004;&#20010;&#24207;&#21015;</span>
<span style="color: #2aa198;">(</span>every #'&gt; #<span style="color: #b58900;">(</span>1 2<span style="color: #b58900;">)</span> #<span style="color: #b58900;">(</span>3 4<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26144;&#23556;&#65292;&#21019;&#24314;&#26032;&#24207;&#21015;&#65292;n-&#21442;&#20989;&#25968;&#21644;n&#20010;&#24207;&#21015;</span>
<span style="color: #2aa198;">(</span>map 'vector #'* #<span style="color: #b58900;">(</span>1 2<span style="color: #b58900;">)</span> #<span style="color: #b58900;">(</span>3 4<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26144;&#23556;&#65292;&#20256;&#36882;&#21040;&#31532;&#19968;&#20010;&#21442;&#25968;&#37324;</span>
<span style="color: #2aa198;">(</span>map-into a #'+ a b<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#32423;&#32852;&#36816;&#31639;, &#20174;&#19968;&#20010;&#24207;&#21015;&#24471;&#21040;&#19968;&#20010;&#20540;,</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#25903;&#25345; :key :from-end :start :end &#21442;&#25968;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21487;&#20197;&#20351;&#29992; :intial-value &#32473;&#20989;&#25968;&#19968;&#20010;&#21021;&#20540;&#29992;&#26469;&#27604;&#36739;</span>
<span style="color: #2aa198;">(</span>reduce #'+ #<span style="color: #b58900;">(</span>1 2 3<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org4afa8f4" class="outline-3">
<h3 id="org4afa8f4"><span class="section-number-3">2.5</span> 哈希表</h3>
<div class="outline-text-3" id="text-2-5">
</div>
<div id="outline-container-orgecf1b70" class="outline-4">
<h4 id="orgecf1b70"><span class="section-number-4">2.5.1</span> 基本操作 <code>make-hash-table, gethash</code></h4>
<div class="outline-text-4" id="text-2-5-1">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21019;&#24314;hash&#34920;&#65292;&#23383;&#31526;&#20018;&#20570;&#38190;&#38656;&#35201;&#25351;&#23450; :test 'equal</span>
<span style="color: #2aa198;">(</span>make-hash-table<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21462;&#20986;&#38190;&#23545;&#24212;&#30340;&#20540;</span>
<span style="color: #2aa198;">(</span>gethash 'key ht<span style="color: #2aa198;">)</span>

</pre>
</div>
</div>
</div>
<div id="outline-container-org431219f" class="outline-4">
<h4 id="org431219f"><span class="section-number-4">2.5.2</span> 迭代函数 <code>maphash</code></h4>
<div class="outline-text-4" id="text-2-5-2">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#36941;&#21382;&#25152;&#26377;&#38190;&#20540;&#23545;</span>
<span style="color: #2aa198;">(</span>maphash #'<span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #268bd2;">(</span>k v<span style="color: #268bd2;">)</span> v<span style="color: #b58900;">)</span> ht<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">loop &#23439;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">loop</span> for k being the hash-keys in ht using <span style="color: #b58900;">(</span>hash-value v<span style="color: #b58900;">)</span>
     do func<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org802811c" class="outline-3">
<h3 id="org802811c"><span class="section-number-3">2.6</span> 列表</h3>
<div class="outline-text-3" id="text-2-6">
<p>
有副作用的操作分破坏性和回收性，破坏性操作如 <code>setf</code> 这类函数不应该用于函数式代码，回收性操作的副作用是用来优化速度的，保持无副作用的操作速度会比较慢。
</p>
</div>
<div id="outline-container-org710c94f" class="outline-4">
<h4 id="org710c94f"><span class="section-number-4">2.6.1</span> 基本操作 <code>cons,car,cdr,list, nth,null,listp</code></h4>
<div class="outline-text-4" id="text-2-6-1">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#36830;&#25509;&#20004;&#20010;&#20803;&#32032;</span>
<span style="color: #2aa198;">(</span>cons 1 2<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21462;&#20986;&#31532;&#19968;&#39033;</span>
<span style="color: #2aa198;">(</span>car '<span style="color: #b58900;">(</span>1 2<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>first '<span style="color: #b58900;">(</span>1 2<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#24471;&#21040;&#21097;&#20313;&#39033;</span>
<span style="color: #2aa198;">(</span>cdr '<span style="color: #b58900;">(</span>1 2 3<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>rest '<span style="color: #b58900;">(</span>1 2 3<span style="color: #b58900;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#24471;&#21040;&#31532;n&#39033;</span>
<span style="color: #b58900;">(</span>nth 1 '<span style="color: #268bd2;">(</span>1 2<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
<span style="color: #b58900;">(</span>nthcdr 1 '<span style="color: #268bd2;">(</span>1 2<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>


<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26500;&#36896;&#21015;&#34920;</span>
<span style="color: #b58900;">(</span>list  1 2 3<span style="color: #b58900;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26159;&#21542;&#20026;&#28857;&#23545;&#21333;&#20803;</span>
<span style="color: #b58900;">(</span>consp o<span style="color: #b58900;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26159;&#21542;&#19981;&#26159;&#28857;&#23545;&#21333;&#20803;</span>
<span style="color: #b58900;">(</span>atom o<span style="color: #b58900;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26159;&#21542;&#20026;&#28857;&#30340;&#21333;&#20803;&#25110;nil</span>
<span style="color: #b58900;">(</span>listp o<span style="color: #b58900;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26159;&#21542;&#20026; nil</span>
<span style="color: #b58900;">(</span>null o<span style="color: #b58900;">)</span>

</pre>
</div>
</div>
</div>
<div id="outline-container-orge5e35d4" class="outline-4">
<h4 id="orge5e35d4"><span class="section-number-4">2.6.2</span> 函数 <code>append,reverse,push,remove,mapcar,maplist</code></h4>
<div class="outline-text-4" id="text-2-6-2">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#36830;&#25509;&#21015;&#34920;</span>
<span style="color: #2aa198;">(</span>append '<span style="color: #b58900;">(</span>1 2<span style="color: #b58900;">)</span> '<span style="color: #b58900;">(</span>3 4<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#36830;&#25509;&#21015;&#34920;&#65292;&#22238;&#25910;&#24615;</span>
<span style="color: #2aa198;">(</span>nconc '<span style="color: #b58900;">(</span>1 2<span style="color: #b58900;">)</span> '<span style="color: #b58900;">(</span>1 2<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21453;&#24207;</span>
<span style="color: #2aa198;">(</span>reverse '<span style="color: #b58900;">(</span>1 2<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21453;&#24207;&#65292;&#22238;&#25910;&#24615;</span>
<span style="color: #2aa198;">(</span>nreverse '<span style="color: #b58900;">(</span>1 2<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#28155;&#21152;&#39033;</span>
<span style="color: #2aa198;">(</span>push i l<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#31227;&#38500;&#39033;</span>
<span style="color: #2aa198;">(</span>remove i l<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#31227;&#38500;&#39033;&#65292;&#22238;&#25910;&#24615;</span>
<span style="color: #2aa198;">(</span>delete i l<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26144;&#23556;&#65292;&#23545;&#20803;&#32032;</span>
<span style="color: #2aa198;">(</span>mapcar #'f l<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26144;&#23556;&#65292;&#23545;&#28857;&#23545;&#21333;&#20803;</span>
<span style="color: #2aa198;">(</span>maplist #f l<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org0b0e5de" class="outline-3">
<h3 id="org0b0e5de"><span class="section-number-3">2.7</span> 文件和I/O</h3>
<div class="outline-text-3" id="text-2-7">
</div>
<div id="outline-container-org4f700ce" class="outline-4">
<h4 id="org4f700ce"><span class="section-number-4">2.7.1</span> 文件操作函数 <code>with-open-file, read, write, pprint</code></h4>
<div class="outline-text-4" id="text-2-7-1">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#25171;&#24320;&#25991;&#20214;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:if-dose-not-exist :error &#25253;&#38169;&#65292; :create &#21019;&#24314; , nil &#36820;&#22238;nil </span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:element-type '(unsigned-byte 8) &#35835;&#21462;&#20108;&#36827;&#21046;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:direction :output &#36755;&#20986;&#25991;&#20214;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">:if-exists :supersede &#26367;&#25442;&#65292;:append &#36861;&#21152; ,:ouverwrite &#35206;&#30422; ,nil &#36820;&#22238;nil</span>
<span style="color: #2aa198;">(</span>open <span style="color: #2aa198;">"filename"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#20851;&#38381;&#25991;&#20214;</span>
<span style="color: #2aa198;">(</span>close s<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#25171;&#24320;&#24182;&#20851;&#38381;&#25991;&#20214;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">with-open-file</span> <span style="color: #b58900;">(</span>s <span style="color: #2aa198;">"filename"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#35835;&#21462;&#23383;&#31526;&#12289;&#35835;&#21462;&#34892;&#12289;&#35835;&#21462;s&#34920;&#36798;&#24335;&#12289;&#35835;&#21462;&#20108;&#36827;&#21046;&#12289;&#25209;&#37327;&#35835;&#21462;</span>
<span style="color: #2aa198;">(</span>read-char s<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>read-line s<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>read s<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>read-byte s<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>read-sequence seq s<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#36755;&#20986;&#23383;&#31526;&#12289;&#36755;&#20986;&#34892;&#12289;&#36755;&#20986;&#23383;&#31526;&#20018;&#19981;&#25442;&#34892;&#12289;&#36755;&#20986;&#25442;&#34892;&#31526;&#12289;&#36755;&#20986;S&#34920;&#36798;&#24335;</span>
<span style="color: #2aa198;">(</span>write-char c s<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>write-line str s<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>write-string str s<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>terpri s<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>fresh-line s<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>write obj s<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>print obj s<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#26377;&#25442;&#34892;</span>
<span style="color: #2aa198;">(</span>prin1 obj s<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#26080;&#25442;&#34892;</span>
<span style="color: #2aa198;">(</span>pprint obj s<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#32654;&#21270;&#26684;&#24335;</span>
<span style="color: #2aa198;">(</span>princ obj s<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#23383;&#31526;&#20018;&#26080;&#24341;&#21495;</span>
<span style="color: #2aa198;">(</span>write-sequence seq s<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#25209;&#37327;&#36755;&#20986;</span>


</pre>
</div>
</div>
</div>
<div id="outline-container-orge24e38c" class="outline-4">
<h4 id="orge24e38c"><span class="section-number-4">2.7.2</span> 文件名和路径函数 <code>pathname, namestring</code></h4>
<div class="outline-text-4" id="text-2-7-2">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#25991;&#20214;&#21517;&#23383;&#31526;&#20018;&#36716;&#25442;&#25104;&#36335;&#24452;&#23545;&#35937;</span>
<span style="color: #2aa198;">(</span>pathname <span style="color: #2aa198;">"path"</span><span style="color: #2aa198;">)</span>
#p<span style="color: #2aa198;">"path"</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#33719;&#21462;&#36335;&#24452;&#23545;&#35937;&#20013;&#30340;&#32452;&#20214;</span>
<span style="color: #2aa198;">(</span>pathname-directory p<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#25991;&#20214;&#22841;&#36335;&#24452;</span>
<span style="color: #2aa198;">(</span>pathname-name p<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#25991;&#20214;&#21517;</span>
<span style="color: #2aa198;">(</span>pathname-type p<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#25991;&#20214;&#25193;&#23637;&#21517;</span>
<span style="color: #2aa198;">(</span>pathname-host p<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; win&#19978;&#36820;&#22238;&#39537;&#21160;&#22120;&#23383;&#27597;</span>
<span style="color: #2aa198;">(</span>pathname-device p<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; win&#19978;&#36820;&#22238;&#39537;&#21160;&#22120;&#23383;&#27597;</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#33719;&#21462;&#36335;&#24452;&#30340;&#23383;&#31526;&#20018;</span>
<span style="color: #2aa198;">(</span>namestring p<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#23436;&#25972;&#36335;&#24452;&#23383;&#31526;&#20018;</span>
<span style="color: #2aa198;">(</span>directory-namestring p<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#25991;&#20214;&#22841;&#36335;&#24452;&#23383;&#31526;&#20018;</span>
<span style="color: #2aa198;">(</span>file-namestring p<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#25991;&#20214;&#21517;&#21644;&#25193;&#23637;&#21517;&#23383;&#31526;&#20018;</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26500;&#36896;&#36335;&#24452;&#21517;</span>
<span style="color: #2aa198;">(</span>make-pathname
 <span style="color: #657b83; font-weight: bold;">:device</span> <span style="color: #2aa198;">"c"</span>
 <span style="color: #657b83; font-weight: bold;">:directory</span> '<span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:absolute</span> <span style="color: #2aa198;">"foo"</span> <span style="color: #2aa198;">"bar"</span><span style="color: #b58900;">)</span>
 <span style="color: #657b83; font-weight: bold;">:name</span> <span style="color: #2aa198;">"baz"</span>
 <span style="color: #657b83; font-weight: bold;">:type</span> <span style="color: #2aa198;">"txt"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#20174;&#36755;&#20837;&#30340;&#36335;&#24452;&#26500;&#36896;&#26032;&#36335;&#24452;</span>
<span style="color: #2aa198;">(</span>make-pathname <span style="color: #657b83; font-weight: bold;">:type</span> <span style="color: #2aa198;">"html"</span> <span style="color: #657b83; font-weight: bold;">:default</span> input-pathname<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>make-pathname <span style="color: #657b83; font-weight: bold;">:directory</span> '<span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:relative</span> <span style="color: #2aa198;">"b"</span><span style="color: #b58900;">)</span>
               <span style="color: #657b83; font-weight: bold;">:default</span> input-pathname<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21512;&#24182;&#20004;&#20010;&#36335;&#24452;</span>
<span style="color: #2aa198;">(</span>merge-pathnames #p<span style="color: #2aa198;">"foo/bar.html"</span> #p<span style="color: #2aa198;">"/www/html/"</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org90d849a" class="outline-4">
<h4 id="org90d849a"><span class="section-number-4">2.7.3</span> 文件系统交互函数  <code>probe-file,delete-file,rename-file</code></h4>
<div class="outline-text-4" id="text-2-7-3">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#25991;&#20214;&#26159;&#21542;&#23384;&#22312;</span>
<span style="color: #2aa198;">(</span>probe-file <span style="color: #2aa198;">"path"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21024;&#38500;&#25991;&#20214;</span>
<span style="color: #2aa198;">(</span>delete-file <span style="color: #2aa198;">"path"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#37325;&#21629;&#21517;&#25991;&#20214;</span>
<span style="color: #2aa198;">(</span>rename-file <span style="color: #2aa198;">"old"</span> <span style="color: #2aa198;">"new"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21019;&#24314;&#30446;&#24405;</span>
<span style="color: #2aa198;">(</span>ensure-directories-exist <span style="color: #2aa198;">"path"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#33719;&#21462;&#25991;&#20214;&#20889;&#26102;&#38388;</span>
<span style="color: #2aa198;">(</span>file-write-date <span style="color: #2aa198;">"path"</span><span style="color: #2aa198;">)</span>

</pre>
</div>
</div>
</div>
<div id="outline-container-orgb726a2d" class="outline-4">
<h4 id="orgb726a2d"><span class="section-number-4">2.7.4</span> 其它I/O流 <code>with-input-from-string, with-output-to-string</code></h4>
<div class="outline-text-4" id="text-2-7-4">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#23383;&#31526;&#20018;&#27969;</span>
<span style="color: #2aa198;">(</span>string-stream<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>make-string-input-stream str<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#36755;&#20837;&#27969;</span>
<span style="color: #2aa198;">(</span>make-string-output-stream str<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#36755;&#20986;&#27969;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">with-input-from-string</span> <span style="color: #b58900;">(</span>s str<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#36755;&#20837;&#27969;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">with-output-to-string</span> <span style="color: #b58900;">(</span>s str<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#36755;&#20986;&#27969;</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#27969;&#25340;&#25509;</span>
<span style="color: #2aa198;">(</span>broadcast-stream<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#36755;&#20986;&#27969;&#36716;&#21457;</span>
<span style="color: #2aa198;">(</span>concatenated-stream<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#36755;&#20837;&#27969;&#25340;&#25509;</span>
<span style="color: #2aa198;">(</span>two-way-stream<span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#36755;&#20837;&#36755;&#20986;&#21452;&#21521;</span>
<span style="color: #2aa198;">(</span>echo-stream<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org35c74fd" class="outline-2">
<h2 id="org35c74fd"><span class="section-number-2">3</span> 坑与技巧</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org5cfcd02" class="outline-3">
<h3 id="org5cfcd02"><span class="section-number-3">3.1</span> 在REPL里删除各种东西</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-orgcb2e7d3" class="outline-4">
<h4 id="orgcb2e7d3"><span class="section-number-4">3.1.1</span> 删除变量</h4>
<div class="outline-text-4" id="text-3-1-1">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defvar</span> <span style="color: #268bd2;">a</span> 0<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>makunbound 'a<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>boundp 'a<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defparameter</span> <span style="color: #268bd2;">b</span> 0<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>makunbound 'b<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>boundp 'b<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org9133918" class="outline-4">
<h4 id="org9133918"><span class="section-number-4">3.1.2</span> 删除类和方法</h4>
<div class="outline-text-4" id="text-3-1-2">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defclass</span> <span style="color: #b58900;">c</span> <span style="color: #b58900;">()</span>
  <span style="color: #b58900;">()</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defgeneric</span> <span style="color: #268bd2;">f</span> <span style="color: #b58900;">(</span>c<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">f</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>c c<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>print nil<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>remove-method #'f
               <span style="color: #b58900;">(</span>find-method #'f
                            '<span style="color: #268bd2;">()</span>
                            <span style="color: #268bd2;">(</span>mapcar #'find-class '<span style="color: #6c71c4;">(</span>c<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>setf <span style="color: #b58900;">(</span>find-class 'c<span style="color: #b58900;">)</span> nil<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org98b66ab" class="outline-3">
<h3 id="org98b66ab"><span class="section-number-3">3.2</span> 查询包中的符号</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-org6b05699" class="outline-4">
<h4 id="org6b05699"><span class="section-number-4">3.2.1</span> 查询符号在哪个包中</h4>
<div class="outline-text-4" id="text-3-2-1">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>package-name <span style="color: #268bd2;">(</span>symbol-package 'defun<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga2b3771" class="outline-4">
<h4 id="orga2b3771"><span class="section-number-4">3.2.2</span> 列出包中所有符号</h4>
<div class="outline-text-4" id="text-3-2-2">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #b58900;">(</span>symbols<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">do-external-symbols</span> <span style="color: #268bd2;">(</span>s <span style="color: #6c71c4;">(</span>find-package <span style="color: #2aa198;">"COMMON-LISP"</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>push s symbols<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  symbols<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org624435e" class="outline-4">
<h4 id="org624435e"><span class="section-number-4">3.2.3</span> 查询包使用了哪些包</h4>
<div class="outline-text-4" id="text-3-2-3">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>print <span style="color: #b58900;">(</span>mapcar #'package-name <span style="color: #268bd2;">(</span>package-use-list <span style="color: #657b83; font-weight: bold;">:cl-user</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd92f3fe" class="outline-2">
<h2 id="orgd92f3fe"><span class="section-number-2">4</span> 构建项目与测试</h2>
<div class="outline-text-2" id="text-4">
<ol class="org-ol">
<li>roswell 用来下载和安装common lisp，和部分管理包，类似conda，  <a href="https://github.com/roswell/roswell">https://github.com/roswell/roswell</a></li>
<li>quicklisp 用来下载和管理包，类似pip， <a href="https://www.quicklisp.org/beta/">https://www.quicklisp.org/beta/</a></li>
<li>asdf 用来构建和编译包，类似setup.py <a href="https://common-lisp.net/project/asdf/">https://common-lisp.net/project/asdf/</a></li>
<li>rove 单元测试框架 <a href="https://github.com/fukamachi/rove">https://github.com/fukamachi/rove</a></li>
</ol>
</div>
<div id="outline-container-org0674e6a" class="outline-3">
<h3 id="org0674e6a"><span class="section-number-3">4.1</span> roswell</h3>
<div class="outline-text-3" id="text-4-1">
<ol class="org-ol">
<li>安上就能用了，最大的坑是安装包下载不下来，可以换别的工具下好以后放在 <code>~/.roswell/archives/</code> 文件夹里，~tmp~ 里的东西要删了之后再重新运行。</li>
</ol>
</div>
<div id="outline-container-org2ce924d" class="outline-4">
<h4 id="org2ce924d"><span class="section-number-4">4.1.1</span> 常用命令</h4>
<div class="outline-text-4" id="text-4-1-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><code>ros run</code></td>
<td class="org-left">运行repl</td>
</tr>

<tr>
<td class="org-left"><code>ros install</code></td>
<td class="org-left">可以从github安装包</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org5f894e7" class="outline-3">
<h3 id="org5f894e7"><span class="section-number-3">4.2</span> quicklisp</h3>
<div class="outline-text-3" id="text-4-2">
<p>
安装就按照官网即可，或用 roswell
</p>
</div>
<div id="outline-container-orgcd2ad18" class="outline-4">
<h4 id="orgcd2ad18"><span class="section-number-4">4.2.1</span> 常用命令</h4>
<div class="outline-text-4" id="text-4-2-1">
</div>
<ol class="org-ol">
<li><a id="org34b19bf"></a>下载并加载包<br />
<div class="outline-text-5" id="text-4-2-1-1">
<ol class="org-ol">
<li><code>:verbose t</code> ： 显示详细信息</li>
</ol>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>ql:quickload system-name<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org26169c3"></a>删除包<br />
<div class="outline-text-5" id="text-4-2-1-2">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>ql:uninstall system-name<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#25110;</span>
<span style="color: #2aa198;">(</span>ql-dist:uninstall <span style="color: #b58900;">(</span>ql-dist:release <span style="color: #2aa198;">"babel"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>ql-dist:clean <span style="color: #b58900;">(</span>ql-dist:dist <span style="color: #2aa198;">"quicklisp"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="orgb399082"></a>查询可用包<br />
<div class="outline-text-5" id="text-4-2-1-3">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>ql:system-apropos substring<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>ql:system-apropos <span style="color: #2aa198;">"xml"</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org6e6bc33"></a>升级包<br />
<div class="outline-text-5" id="text-4-2-1-4">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>ql:update-dist <span style="color: #2aa198;">"quicklisp"</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="orge21edb5"></a>升级quicklisp<br />
<div class="outline-text-5" id="text-4-2-1-5">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>ql:update-client<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org6c81c96"></a>查看包的依赖<br />
<div class="outline-text-5" id="text-4-2-1-6">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>ql:who-depends-on system-name<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="orgac5daaf"></a>查看已安装的包<br />
<div class="outline-text-5" id="text-4-2-1-7">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>ql-dist:installed-releases <span style="color: #b58900;">(</span>ql-dist:dist <span style="color: #2aa198;">"quicklisp"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>ql:where-is-system <span style="color: #2aa198;">"cl-ppcre"</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>ql:register-local-projects<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orga5c930a" class="outline-4">
<h4 id="orga5c930a"><span class="section-number-4">4.2.2</span> 问题</h4>
<div class="outline-text-4" id="text-4-2-2">
</div>
<ol class="org-ol">
<li><a id="org6a60934"></a>配置代理<br />
<div class="outline-text-5" id="text-4-2-2-1">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#23433;&#35013;&#26102;</span>
<span style="color: #2aa198;">(</span>quicklisp-quickstart:install <span style="color: #657b83; font-weight: bold;">:proxy</span> <span style="color: #2aa198;">"http://myproxy.site.com:8080/"</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26356;&#25913;&#20195;&#29702;&#35774;&#32622;</span>
<span style="color: #2aa198;">(</span>setf <span style="color: #b58900;">(</span>ql-config:config-value <span style="color: #2aa198;">"proxy-url"</span><span style="color: #b58900;">)</span> <span style="color: #2aa198;">"http://proxy.value.here"</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="orgf815bb7"></a>改变包安装位置<br />
<div class="outline-text-5" id="text-4-2-2-2">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>quicklisp-quickstart:install <span style="color: #657b83; font-weight: bold;">:path</span> <span style="color: #2aa198;">".quicklisp/"</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="orgc6289be"></a>安装本地包<br />
<div class="outline-text-5" id="text-4-2-2-3">
<p>
把项目放到 <code>local-projects</code> 里
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #657b83; font-weight: bold;">cd</span> ~/quicklisp/local-projects/
git clone git://github.com/xach/format-time.git
</pre>
</div>

<p>
然后
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>ql:quickload <span style="color: #2aa198;">"format-time"</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<p>
或者使用 asdf 的源注册系统
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>push #p<span style="color: #2aa198;">"/projects/my-project/"</span> asdf:*central-registry*<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>ql:quickload <span style="color: #2aa198;">"my-project"</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org37f01aa" class="outline-3">
<h3 id="org37f01aa"><span class="section-number-3">4.3</span> asdf</h3>
<div class="outline-text-3" id="text-4-3">
<p>
asdf 是用来构建软件包的事实标准，所有实现都应该附带了asdf。
asdf包括两部分
</p>
<ol class="org-ol">
<li><code>asdf/defsystem</code> 用来描述源码的组成和依赖，并编译和加载包。类似于 <code>make,autoconf,dlopen,libc</code> 这一套东西。也就是通常所说的 <code>asdf</code> 。</li>
<li><code>uiop</code> 是用来在不同的系统和实现上实现移植的辅助库，可以抹平不同系统之间的差异。可以单独作为一个库使用。</li>
</ol>
</div>

<div id="outline-container-org7d1e848" class="outline-4">
<h4 id="org7d1e848"><span class="section-number-4">4.3.1</span> 加载 ASDF</h4>
<div class="outline-text-4" id="text-4-3-1">
</div>
<ol class="org-ol">
<li><a id="org8a61010"></a>加载自带的ASDF<br />
<div class="outline-text-5" id="text-4-3-1-1">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">require</span> <span style="color: #2aa198;">"asdf"</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="org8dafb54"></a>判断是否已经加载ASDF<br />
<div class="outline-text-5" id="text-4-3-1-2">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>asdf:asdf-version<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org25e0f83" class="outline-4">
<h4 id="org25e0f83"><span class="section-number-4">4.3.2</span> 配置 ASDF</h4>
<div class="outline-text-4" id="text-4-3-2">
</div>
<ol class="org-ol">
<li><a id="orgb186dd1"></a>配置ASDF搜索系统的路径<br />
<div class="outline-text-5" id="text-4-3-2-1">
<p>
默认的搜索路径是
</p>
<ol class="org-ol">
<li>~/common-lisp/</li>
<li>~/.local/share/common-lisp/source/</li>
</ol>
<p>
如果使用了 quicklisp，已经配置好路径了，不需要自己动
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org9306525" class="outline-4">
<h4 id="org9306525"><span class="section-number-4">4.3.3</span> 使用 ASDF</h4>
<div class="outline-text-4" id="text-4-3-3">
</div>
<ol class="org-ol">
<li><a id="org9e07c64"></a>加载一个系统<br />
<div class="outline-text-5" id="text-4-3-3-1">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#27491;&#35268;&#29992;&#27861;</span>
<span style="color: #2aa198;">(</span>asdf:load-system <span style="color: #657b83; font-weight: bold;">:foo</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#22823;&#22810;&#25968;&#23454;&#29616;&#20013;&#21487;&#20197;&#30452;&#25509;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">require</span> <span style="color: #268bd2; font-weight: bold;">:foo</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="org15961eb"></a>其它可用函数<br />
<div class="outline-text-5" id="text-4-3-3-2">
<ol class="org-ol">
<li><code>load-system</code> 加载系统</li>
<li><code>compile-system</code> 只编译不加载</li>
<li><code>test-system</code> 运行测试</li>
<li><code>make</code> 默认就是加载系统，但是可以被系统的作者重载成别的功能</li>
<li><code>require-system</code> 加载系统，如果已经加载了就不重复加载</li>
<li><code>already-loaded-systems</code> 返回所有已经加载的系统名</li>
</ol>
</div>
</li>
</ol>
</div>
<div id="outline-container-org7608912" class="outline-4">
<h4 id="org7608912"><span class="section-number-4">4.3.4</span> 定义系统</h4>
<div class="outline-text-4" id="text-4-3-4">
</div>
<ol class="org-ol">
<li><a id="org357b0bb"></a>基本的定义系统<br />
<div class="outline-text-5" id="text-4-3-4-1">
<p>
在 <code>hello-lisp.asd</code> 文件中加入，这部分很直观了
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">Usual Lisp comments are allowed here</span>

<span style="color: #2aa198;">(</span>defsystem <span style="color: #2aa198;">"hello-lisp"</span>
    <span style="color: #657b83; font-weight: bold;">:description</span> <span style="color: #2aa198;">"hello-lisp: a sample Lisp system."</span>
    <span style="color: #657b83; font-weight: bold;">:version</span> <span style="color: #2aa198;">"0.0.1"</span>
    <span style="color: #657b83; font-weight: bold;">:author</span> <span style="color: #2aa198;">"Joe User <a href="mailto:joe%40example.com">&lt;joe@example.com&gt;</a>"</span>
    <span style="color: #657b83; font-weight: bold;">:licence</span> <span style="color: #2aa198;">"Public Domain"</span>
    <span style="color: #657b83; font-weight: bold;">:depends-on</span> <span style="color: #b58900;">(</span><span style="color: #2aa198;">"optima.ppcre"</span> <span style="color: #2aa198;">"command-line-arguments"</span><span style="color: #b58900;">)</span>
    <span style="color: #657b83; font-weight: bold;">:components</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span><span style="color: #657b83; font-weight: bold;">:file</span> <span style="color: #2aa198;">"packages"</span><span style="color: #268bd2;">)</span>
                 <span style="color: #268bd2;">(</span><span style="color: #657b83; font-weight: bold;">:file</span> <span style="color: #2aa198;">"macros"</span> <span style="color: #657b83; font-weight: bold;">:depends-on</span> <span style="color: #6c71c4;">(</span><span style="color: #2aa198;">"packages"</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
                 <span style="color: #268bd2;">(</span><span style="color: #657b83; font-weight: bold;">:file</span> <span style="color: #2aa198;">"hello"</span> <span style="color: #657b83; font-weight: bold;">:depends-on</span> <span style="color: #6c71c4;">(</span><span style="color: #2aa198;">"macros"</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org3986045"></a>复杂的例子<br />
<div class="outline-text-5" id="text-4-3-4-2">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">in-package</span> <span style="color: #657b83; font-weight: bold;">:asdf-user</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">; &#27809;&#26377;&#24517;&#35201;&#65292;&#20294;&#26159;&#36890;&#24120;&#22797;&#26434;&#24773;&#20917;&#26102;&#36824;&#26159;&#20250;&#26377;&#36825;&#21477;</span>

<span style="color: #2aa198;">(</span>defsystem <span style="color: #2aa198;">"foo"</span>
  <span style="color: #657b83; font-weight: bold;">:version</span> <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:read-file-form</span> <span style="color: #2aa198;">"variables"</span> <span style="color: #657b83; font-weight: bold;">:at</span> <span style="color: #268bd2;">(</span>3 2<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #657b83; font-weight: bold;">:components</span>
  <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span><span style="color: #657b83; font-weight: bold;">:file</span> <span style="color: #2aa198;">"package"</span><span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span><span style="color: #657b83; font-weight: bold;">:file</span> <span style="color: #2aa198;">"variables"</span> <span style="color: #657b83; font-weight: bold;">:depends-on</span> <span style="color: #6c71c4;">(</span><span style="color: #2aa198;">"package"</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span><span style="color: #657b83; font-weight: bold;">:module</span> <span style="color: #2aa198;">"mod"</span> <span style="color: #93a1a1;">; &#23450;&#20041;&#27169;&#22359;</span>
     <span style="color: #657b83; font-weight: bold;">:depends-on</span> <span style="color: #6c71c4;">(</span><span style="color: #2aa198;">"package"</span><span style="color: #6c71c4;">)</span> <span style="color: #93a1a1;">; &#27169;&#22359;&#20381;&#36182;&#25991;&#20214;</span>
     <span style="color: #657b83; font-weight: bold;">:serial</span> t <span style="color: #93a1a1;">; &#34920;&#31034;&#27169;&#22359;&#20869;&#30340;&#25991;&#20214;&#19979;&#19968;&#20010;&#20381;&#36182;&#19978;&#19968;&#20010;</span>
     <span style="color: #657b83; font-weight: bold;">:components</span> <span style="color: #6c71c4;">(</span><span style="color: #859900;">(</span><span style="color: #657b83; font-weight: bold;">:file</span> <span style="color: #2aa198;">"utils"</span><span style="color: #859900;">)</span>
                  <span style="color: #859900;">(</span><span style="color: #657b83; font-weight: bold;">:file</span> <span style="color: #2aa198;">"reader"</span><span style="color: #859900;">)</span>
                  <span style="color: #859900;">(</span><span style="color: #657b83; font-weight: bold;">:file</span> <span style="color: #2aa198;">"cooker"</span><span style="color: #859900;">)</span>
                  <span style="color: #859900;">(</span><span style="color: #657b83; font-weight: bold;">:static-file</span> <span style="color: #2aa198;">"data.raw"</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> <span style="color: #93a1a1;">; &#27809;&#26377;&#38544;&#21547;&#25193;&#23637;&#21517;&#65292;&#19981;&#26159;lisp&#28304;&#30721;</span>
     <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#20197;&#19979;&#20004;&#20010;&#26159;&#26041;&#27861;&#23450;&#20041;&#65292;&#29992;&#26469;&#23450;&#21046;asdf&#30340;&#34892;&#20026;</span>
     <span style="color: #657b83; font-weight: bold;">:output-files</span> <span style="color: #6c71c4;">(</span>compile-op <span style="color: #859900;">(</span>o c<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>list <span style="color: #2aa198;">"data.cooked"</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
     <span style="color: #657b83; font-weight: bold;">:perform</span> <span style="color: #6c71c4;">(</span>compile-op <span style="color: #657b83; font-weight: bold;">:after</span> <span style="color: #859900;">(</span>o c<span style="color: #859900;">)</span>
        <span style="color: #859900;">(</span>cook-data
         <span style="color: #657b83; font-weight: bold;">:in</span> <span style="color: #b58900;">(</span>component-pathname <span style="color: #268bd2;">(</span>find-component c <span style="color: #2aa198;">"data.raw"</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
         <span style="color: #657b83; font-weight: bold;">:out</span> <span style="color: #b58900;">(</span>first <span style="color: #268bd2;">(</span>output-files o c<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span><span style="color: #657b83; font-weight: bold;">:file</span> <span style="color: #2aa198;">"foo"</span> <span style="color: #657b83; font-weight: bold;">:depends-on</span> <span style="color: #6c71c4;">(</span><span style="color: #2aa198;">"mod"</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">action-description</span>
    <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>o compile-op<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>c <span style="color: #6c71c4;">(</span>eql <span style="color: #859900;">(</span>find-component <span style="color: #2aa198;">"foo"</span> <span style="color: #2aa198;">"mod"</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #2aa198;">"cooking data"</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="orgef3b2d2"></a>一个文件一个系统模式<br />
<div class="outline-text-5" id="text-4-3-4-3">
<p>
在 3.1.2 之后版本支持。这种方法可维护性更高一点。
只需要在顶级路径指定包名，之后可以自动推断子系统名。
<code>my-lib.asd</code>
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">This example is based on lil.asd of LISP-INTERFACE-LIBRARY.</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21028;&#26029;&#29256;&#26412;&#21495;&#65292;&#36825;&#19968;&#34892;&#27809;&#29992;&#20102;&#65292;&#22240;&#20026;&#25152;&#26377;&#23454;&#29616;&#37117;&#24102;&#20102;&#27604;&#36825;&#20010;&#26356;&#26032;&#30340;</span>
#-asdf3.1 <span style="color: #2aa198;">(</span><span style="color: #cb4b16; font-weight: bold;">error</span> <span style="color: #2aa198;">"MY-LIB requires ASDF 3.1 or later."</span><span style="color: #2aa198;">)</span> 
<span style="color: #2aa198;">(</span>defsystem <span style="color: #2aa198;">"my-lib"</span>
    <span style="color: #657b83; font-weight: bold;">:class</span> <span style="color: #657b83; font-weight: bold;">:package-inferred-system</span> <span style="color: #93a1a1;">; &#34920;&#31034;&#21551;&#29992;&#21333;&#25991;&#20214;&#31995;&#32479;&#27169;&#24335;</span>
    <span style="color: #657b83; font-weight: bold;">:depends-on</span> <span style="color: #b58900;">(</span><span style="color: #2aa198;">"my-lib/interface/all"</span>
                 <span style="color: #2aa198;">"my-lib/src/all"</span>
                 <span style="color: #2aa198;">"my-lib/extras/all"</span><span style="color: #b58900;">)</span>
    <span style="color: #657b83; font-weight: bold;">:in-order-to</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>test-op <span style="color: #6c71c4;">(</span>load-op <span style="color: #2aa198;">"my-lib/test/all"</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
    <span style="color: #657b83; font-weight: bold;">:perform</span> <span style="color: #b58900;">(</span>test-op <span style="color: #268bd2;">(</span>o c<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>symbol-call <span style="color: #657b83; font-weight: bold;">:my-lib/test/all</span> <span style="color: #657b83; font-weight: bold;">:test-suite</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>defsystem <span style="color: #2aa198;">"my-lib/test"</span> <span style="color: #657b83; font-weight: bold;">:depends-on</span> <span style="color: #b58900;">(</span><span style="color: #2aa198;">"my-lib/test/all"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#20195;&#30721;&#20013;&#20351;&#29992;&#30340;&#31995;&#32479;&#21517;&#21644;&#25991;&#20214;&#21517;&#19981;&#19968;&#26679;&#26102;&#38656;&#35201;&#27880;&#20876;&#26032;&#21517;&#23383;</span>
<span style="color: #2aa198;">(</span>register-system-packages <span style="color: #2aa198;">"my-lib/interface/all"</span> '<span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:my-lib-interface</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>register-system-packages <span style="color: #2aa198;">"my-lib/src/all"</span> '<span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:my-lib-implementation</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>register-system-packages <span style="color: #2aa198;">"my-lib/test/all"</span> '<span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:my-lib-test</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>register-system-packages
 <span style="color: #2aa198;">"closer-mop"</span>
 '<span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:c2mop</span>
   <span style="color: #657b83; font-weight: bold;">:closer-common-lisp</span>
   <span style="color: #657b83; font-weight: bold;">:c2cl</span>
   <span style="color: #657b83; font-weight: bold;">:closer-common-lisp-user</span>
   <span style="color: #657b83; font-weight: bold;">:c2cl-user</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<p>
源文件应该以系统定义开头： <code>interface/order.lisp</code>
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>uiop:define-package <span style="color: #657b83; font-weight: bold;">:my-lib/interface/order</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:use</span> <span style="color: #657b83; font-weight: bold;">:closer-common-lisp</span>
   <span style="color: #657b83; font-weight: bold;">:my-lib/interface/definition</span>
   <span style="color: #657b83; font-weight: bold;">:my-lib/interface/base</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:mix</span> <span style="color: #657b83; font-weight: bold;">:fare-utils</span> <span style="color: #657b83; font-weight: bold;">:uiop</span> <span style="color: #657b83; font-weight: bold;">:alexandria</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:export</span> ...<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<p>
子系统的顶级文件要重新导出 <code>interface/all.lisp</code>
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span>uiop:define-package <span style="color: #657b83; font-weight: bold;">:my-lib/interface/all</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:nicknames</span> <span style="color: #657b83; font-weight: bold;">:my-lib-interface</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:use</span> <span style="color: #657b83; font-weight: bold;">:closer-common-lisp</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:mix</span> <span style="color: #657b83; font-weight: bold;">:fare-utils</span> <span style="color: #657b83; font-weight: bold;">:uiop</span> <span style="color: #657b83; font-weight: bold;">:alexandria</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:use-reexport</span>
   <span style="color: #657b83; font-weight: bold;">:my-lib/interface/definition</span>
   <span style="color: #657b83; font-weight: bold;">:my-lib/interface/base</span>
   <span style="color: #657b83; font-weight: bold;">:my-lib/interface/order</span>
   <span style="color: #657b83; font-weight: bold;">:my-lib/interface/monad/continuation</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<p>
也可以使用 <code>:import-from</code> 自动生成依赖
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defpackage</span> <span style="color: #b58900;">:foo/bar</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:use</span> <span style="color: #657b83; font-weight: bold;">:cl</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:import-from</span> <span style="color: #657b83; font-weight: bold;">:foo/baz</span> <span style="color: #93a1a1;">#:</span><span style="color: #2aa198;">sym1</span> <span style="color: #93a1a1;">#:</span><span style="color: #2aa198;">sym2</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:import-from</span> <span style="color: #657b83; font-weight: bold;">:foo/quux</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:export</span> ...<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org58d4023" class="outline-3">
<h3 id="org58d4023"><span class="section-number-3">4.4</span> rove</h3>
<div class="outline-text-3" id="text-4-4">
<p>
从 quicklisp 直接安装即可，按照模板写，很简单
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#36816;&#34892;&#27979;&#35797;</span>
<span style="color: #2aa198;">(</span>use-package <span style="color: #657b83; font-weight: bold;">:rove</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>use-package <span style="color: #657b83; font-weight: bold;">:my-a-lib</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>run <span style="color: #657b83; font-weight: bold;">:my-a-lib/tests</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org56a52ad" class="outline-3">
<h3 id="org56a52ad"><span class="section-number-3">4.5</span> 项目模板</h3>
<div class="outline-text-3" id="text-4-5">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21152;&#36733;&#39033;&#30446;</span>
<span style="color: #2aa198;">(</span>ql:quickload <span style="color: #657b83; font-weight: bold;">:my-a-lib</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>use-package <span style="color: #657b83; font-weight: bold;">:my-a-lib</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>run<span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>ret 3<span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#36816;&#34892;&#27979;&#35797;</span>
<span style="color: #2aa198;">(</span>ql:quickload <span style="color: #657b83; font-weight: bold;">:rove</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>rove:run <span style="color: #657b83; font-weight: bold;">:my-a-lib/tests</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>

<div id="outline-container-org16568bb" class="outline-4">
<h4 id="org16568bb"><span class="section-number-4">4.5.1</span> 文件目录</h4>
<div class="outline-text-4" id="text-4-5-1">
<pre class="example">
my-a-lib
my-a-lib/my-a-lib.asd
my-a-lib/main.lisp
my-a-lib/src
my-a-lib/src/all.lisp
my-a-lib/src/p.lisp
my-a-lib/tests
my-a-lib/tests/test-all.lisp
</pre>
</div>
</div>

<div id="outline-container-org49a563c" class="outline-4">
<h4 id="org49a563c"><span class="section-number-4">4.5.2</span> asd 文件</h4>
<div class="outline-text-4" id="text-4-5-2">
<p>
<code>my-a-lib/my-a-lib.asd</code>
</p>
<div class="org-src-container">
<pre class="src src-lisp">#-asdf3.1 <span style="color: #2aa198;">(</span><span style="color: #cb4b16; font-weight: bold;">error</span> <span style="color: #2aa198;">"MY-LIB requires ASDF 3.1 or later."</span><span style="color: #2aa198;">)</span> 
<span style="color: #2aa198;">(</span>defsystem <span style="color: #2aa198;">"my-a-lib"</span>
  <span style="color: #657b83; font-weight: bold;">:class</span> <span style="color: #657b83; font-weight: bold;">:package-inferred-system</span>
  <span style="color: #657b83; font-weight: bold;">:version</span> <span style="color: #2aa198;">"0.0.1"</span>
  <span style="color: #657b83; font-weight: bold;">:author</span> <span style="color: #2aa198;">"c"</span>
  <span style="color: #657b83; font-weight: bold;">:description</span> <span style="color: #2aa198;">"description"</span>
  <span style="color: #657b83; font-weight: bold;">:license</span> <span style="color: #2aa198;">"BSD"</span>
  <span style="color: #657b83; font-weight: bold;">:depends-on</span> <span style="color: #b58900;">(</span><span style="color: #2aa198;">"my-a-lib/main"</span><span style="color: #b58900;">)</span>
  <span style="color: #657b83; font-weight: bold;">:in-order-to</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>test-op <span style="color: #6c71c4;">(</span>test-op <span style="color: #2aa198;">"my-a-lib/tests"</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>defsystem <span style="color: #2aa198;">"my-a-lib/tests"</span>
  <span style="color: #657b83; font-weight: bold;">:class</span> <span style="color: #657b83; font-weight: bold;">:package-inferred-system</span>
  <span style="color: #657b83; font-weight: bold;">:depends-on</span> <span style="color: #b58900;">(</span><span style="color: #2aa198;">"rove"</span>
               <span style="color: #2aa198;">"my-a-lib/tests/test-all"</span><span style="color: #b58900;">)</span>
  <span style="color: #657b83; font-weight: bold;">:perform</span> <span style="color: #b58900;">(</span>test-op <span style="color: #268bd2;">(</span>o c <span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>symbol-call <span style="color: #657b83; font-weight: bold;">:rove</span> '<span style="color: #93a1a1;">#:</span><span style="color: #2aa198;">run</span> c<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org506adcb" class="outline-4">
<h4 id="org506adcb"><span class="section-number-4">4.5.3</span> 源文件</h4>
<div class="outline-text-4" id="text-4-5-3">
</div>
<ol class="org-ol">
<li><a id="org1dec62c"></a>main.lisp<br />
<div class="outline-text-5" id="text-4-5-3-1">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">in-package</span> <span style="color: #657b83; font-weight: bold;">:cl-user</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defpackage</span> <span style="color: #b58900;">:my-a-lib/main</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:nicknames</span> <span style="color: #93a1a1;">#:</span><span style="color: #2aa198;">my-a-lib</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:use</span> <span style="color: #657b83; font-weight: bold;">:cl</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:import-from</span> <span style="color: #657b83; font-weight: bold;">:my-a-lib/src/all</span> <span style="color: #93a1a1;">#:</span><span style="color: #2aa198;">p</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:export</span> <span style="color: #93a1a1;">#:</span><span style="color: #2aa198;">run</span>
           <span style="color: #93a1a1;">#:</span><span style="color: #2aa198;">ret</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">in-package</span> <span style="color: #657b83; font-weight: bold;">:my-a-lib/main</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">run</span> <span style="color: #b58900;">()</span>
  <span style="color: #b58900;">(</span>p<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">ret</span> <span style="color: #b58900;">(</span>x<span style="color: #b58900;">)</span>
  x<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org38577ee"></a>src/all.lisp<br />
<div class="outline-text-5" id="text-4-5-3-2">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defpackage</span> <span style="color: #b58900;">:my-a-lib/src/all</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:use</span> <span style="color: #657b83; font-weight: bold;">:cl</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:import-from</span> <span style="color: #657b83; font-weight: bold;">:my-a-lib/src/p</span> <span style="color: #93a1a1;">#:</span><span style="color: #2aa198;">p</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:export</span> <span style="color: #93a1a1;">#:</span><span style="color: #2aa198;">p</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org3a2b855"></a>src/p.lisp<br />
<div class="outline-text-5" id="text-4-5-3-3">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defpackage</span> <span style="color: #b58900;">:my-a-lib/src/p</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:use</span> <span style="color: #657b83; font-weight: bold;">:cl</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:export</span> <span style="color: #93a1a1;">#:</span><span style="color: #2aa198;">p</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">in-package</span> <span style="color: #657b83; font-weight: bold;">:my-a-lib/src/p</span><span style="color: #2aa198;">)</span>


<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">p</span> <span style="color: #b58900;">()</span>
  <span style="color: #b58900;">(</span>print <span style="color: #2aa198;">"in p func"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgf355f21" class="outline-4">
<h4 id="orgf355f21"><span class="section-number-4">4.5.4</span> 测试文件</h4>
<div class="outline-text-4" id="text-4-5-4">
</div>
<ol class="org-ol">
<li><a id="org5fd5acc"></a>tests/test-all.lisp<br />
<div class="outline-text-5" id="text-4-5-4-1">
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defpackage</span> <span style="color: #b58900;">:my-a-lib/tests/test-all</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:use</span> <span style="color: #657b83; font-weight: bold;">:cl</span>
        <span style="color: #657b83; font-weight: bold;">:my-a-lib</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:import-from</span> <span style="color: #657b83; font-weight: bold;">:rove</span> <span style="color: #93a1a1;">#:</span><span style="color: #2aa198;">deftest</span> <span style="color: #93a1a1;">#:</span><span style="color: #2aa198;">testing</span> <span style="color: #93a1a1;">#:</span><span style="color: #2aa198;">ok</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:shadowing-import-from</span> <span style="color: #657b83; font-weight: bold;">:rove</span>
                          <span style="color: #657b83; font-weight: bold;">:*debug-on-error*</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">in-package</span> <span style="color: #657b83; font-weight: bold;">:my-a-lib/tests/test-all</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>deftest my-a-test
  <span style="color: #b58900;">(</span>testing <span style="color: #2aa198;">"test part 1"</span>
    <span style="color: #268bd2;">(</span>ok <span style="color: #6c71c4;">(</span>= <span style="color: #859900;">(</span>ret 1<span style="color: #859900;">)</span> 1<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>ok <span style="color: #6c71c4;">(</span>= <span style="color: #859900;">(</span>ret 2<span style="color: #859900;">)</span> 2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

  <span style="color: #b58900;">(</span>testing <span style="color: #2aa198;">"test part 2"</span>
    <span style="color: #268bd2;">(</span>ok <span style="color: #6c71c4;">(</span>= <span style="color: #859900;">(</span>ret 3<span style="color: #859900;">)</span> 3<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-orgf49b665" class="outline-2">
<h2 id="orgf49b665"><span class="section-number-2">5</span> FFI</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orgd74cecf" class="outline-3">
<h3 id="orgd74cecf"><span class="section-number-3">5.1</span> CFFI</h3>
<div class="outline-text-3" id="text-5-1">
<p>
<a href="https://common-lisp.net/project/cffi/">https://common-lisp.net/project/cffi/</a>
</p>
</div>
<div id="outline-container-orge175a39" class="outline-4">
<h4 id="orge175a39"><span class="section-number-4">5.1.1</span> 基本过程</h4>
<div class="outline-text-4" id="text-5-1-1">
<ol class="org-ol">
<li>定义和加载动态库</li>
<li>使用基本的c类型，或者自己定义复杂的c类型-lisp类的新类型</li>
<li>将c函数定义成lisp函数，或者创建更lisp式的接口</li>
</ol>
</div>
<ol class="org-ol">
<li><a id="orgd304fc4"></a>加载动态链接库<br />
<div class="outline-text-5" id="text-5-1-1-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#39318;&#20808;&#35201;&#36733;&#20837; cffi &#31995;&#32479;</span>
<span style="color: #2aa198;">(</span>asdf:load-system <span style="color: #657b83; font-weight: bold;">:cffi</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>defpackage <span style="color: #657b83; font-weight: bold;">:cffi-user</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:use</span> <span style="color: #657b83; font-weight: bold;">:common-lisp</span> <span style="color: #657b83; font-weight: bold;">:cffi</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>in-package <span style="color: #657b83; font-weight: bold;">:cffi-user</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#23450;&#20041;&#24211;&#65292;&#20027;&#35201;&#26159;&#25351;&#23450;&#21512;&#36866;&#30340;&#21517;&#23383;</span>
<span style="color: #2aa198;">(</span>define-foreign-library libcurl
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:windows</span> <span style="color: #268bd2;">(</span><span style="color: #657b83; font-weight: bold;">:or</span> <span style="color: #2aa198;">"libcurl-x86.dll"</span> <span style="color: #2aa198;">"libcurl-x64.dll"</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:darwin</span> <span style="color: #268bd2;">(</span><span style="color: #657b83; font-weight: bold;">:or</span> <span style="color: #2aa198;">"libcurl.3.dylib"</span> <span style="color: #2aa198;">"libcurl.dylib"</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:unix</span> <span style="color: #268bd2;">(</span><span style="color: #657b83; font-weight: bold;">:or</span> <span style="color: #2aa198;">"libcurl.so.3"</span> <span style="color: #2aa198;">"libcurl.so"</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>t <span style="color: #268bd2;">(</span><span style="color: #657b83; font-weight: bold;">:default</span> <span style="color: #2aa198;">"libcurl"</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#36733;&#20837;&#24211;</span>
<span style="color: #2aa198;">(</span>use-foreign-library libcurl<span style="color: #2aa198;">)</span>

</pre>
</div>
</div>
</li>
<li><a id="org338bcaf"></a>定义和使用基本类型与函数<br />
<div class="outline-text-5" id="text-5-1-1-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#23450;&#20041;&#22522;&#26412;&#31867;&#22411;&#65292;&#30456;&#24403;&#20110;c&#31867;&#22411;&#30340;&#21035;&#21517;</span>
<span style="color: #2aa198;">(</span>defctype curl-code <span style="color: #657b83; font-weight: bold;">:int</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#23450;&#20041;&#20989;&#25968;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#33258;&#21160;&#25226;&#21517;&#23383;&#36827;&#34892;&#36716;&#25442;&#65292;&#20063;&#21487;&#20197;&#29992; ~:lisp-name~ ~:foreign-name~ &#25351;&#23450;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#22914;&#26524;&#26377; ~&amp;rest~ &#23601;&#23450;&#20041;&#25104;&#21487;&#21464;&#21442;&#20989;&#25968;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#22914;&#26524;&#35201;&#20256;&#32467;&#26500;&#20307; ~(:struct ...)~ &#65292;&#23601;&#24471;&#21152;&#36733; ~cffi-libffi~ &#31995;&#32479;&#65292;&#36825;&#20381;&#36182; libffi</span>
<span style="color: #2aa198;">(</span>defcfun <span style="color: #2aa198;">"curl_global_init"</span> curl-code
  <span style="color: #b58900;">(</span>flags <span style="color: #657b83; font-weight: bold;">:long</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#20351;&#29992;&#20989;&#25968;&#65292;&#21644;&#26222;&#36890;&#30340;&#20989;&#25968;&#19968;&#26679;</span>
<span style="color: #2aa198;">(</span>curl-global-init 0<span style="color: #2aa198;">)</span>


<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#23383;&#31526;&#20018; :string &#23454;&#38469;&#19978;&#26159;&#19968;&#20010; char &#30340;&#21015;&#34920;&#65292;&#28982;&#21518;&#36820;&#22238;&#25351;&#38024; :pointer &#65292;&#21644; c &#37324;&#30340;&#19968;&#26679;&#12290;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#35201;&#27880;&#24847;&#23383;&#31526;&#20018;&#30340;&#29983;&#21629;&#21608;&#26399;&#65292;&#23427;&#20250;&#34987;&#33258;&#21160;&#37322;&#25918;&#25481;&#65292;&#22914;&#26524;&#24819;&#20445;&#25345;&#23427;&#65292;&#23601;&#24471;&#33258;&#24049;&#31649;&#29702;&#20869;&#23384;&#65292;&#20351;&#29992;&#20840;&#23616;&#21464;&#37327;&#25110;&#32773;&#31867;</span>
<span style="color: #2aa198;">(</span>defcfun <span style="color: #2aa198;">"sprintf"</span> <span style="color: #657b83; font-weight: bold;">:int</span>
  <span style="color: #b58900;">(</span>str <span style="color: #657b83; font-weight: bold;">:pointer</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>control <span style="color: #657b83; font-weight: bold;">:string</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">&amp;rest</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>with-foreign-pointer-as-string <span style="color: #b58900;">(</span>s 100<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>sprintf s <span style="color: #2aa198;">"%c %d %.2f %s"</span> <span style="color: #657b83; font-weight: bold;">:char</span> 90 <span style="color: #657b83; font-weight: bold;">:short</span> 42 <span style="color: #657b83; font-weight: bold;">:float</span> pi
           <span style="color: #657b83; font-weight: bold;">:string</span> <span style="color: #2aa198;">"super-locrian"</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>


<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26522;&#20030;&#21644;&#26222;&#36890;&#31867;&#22411;&#19968;&#26679;</span>
<span style="color: #2aa198;">(</span>defcenum curl-option
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:noprogress</span> 43<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:nosignal</span> 99<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:errorbuffer</span> 10010<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:url</span> 10002<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>foreign-funcall <span style="color: #2aa198;">"curl_easy_setopt"</span>
                 <span style="color: #657b83; font-weight: bold;">:pointer</span> *easy-handle*
                 curl-option <span style="color: #657b83; font-weight: bold;">:nosignal</span> <span style="color: #657b83; font-weight: bold;">:long</span> 1 curl-code<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org2e06a54"></a>回调函数<br />
<div class="outline-text-5" id="text-5-1-1-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #2aa198;">(</span>defctype size <span style="color: #657b83; font-weight: bold;">:unsigned-int</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#22238;&#35843;&#20989;&#25968;&#21487;&#20197;&#29992;lisp&#20889;&#65292;&#28982;&#21518;&#20250;&#33258;&#21160;&#29983;&#25104;&#21487;&#20197;&#34987;c&#35843;&#29992;&#30340;&#20989;&#25968;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#22238;&#35843;&#20989;&#25968;&#37324;&#21487;&#20197;&#20351;&#29992;&#22806;&#37096;&#30340;&#21464;&#37327;&#21644;&#26041;&#27861;&#65292;&#20294;&#26159;&#36820;&#22238;&#20540;&#24471;&#26159;c&#31867;&#22411;&#30340;&#65292;&#32780;&#19988;&#24517;&#39035;&#36820;&#22238;&#30830;&#23450;&#30340;&#31867;&#22411;&#65292;&#21542;&#21017;&#20250;&#21457;&#29983;c&#30340;&#26410;&#23450;&#20041;&#34892;&#20026;</span>
<span style="color: #2aa198;">(</span>defcallback easy-write size <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>ptr <span style="color: #657b83; font-weight: bold;">:pointer</span><span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>size size<span style="color: #268bd2;">)</span>
                              <span style="color: #268bd2;">(</span>nmemb size<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>stream <span style="color: #657b83; font-weight: bold;">:pointer</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>data-size <span style="color: #859900;">(</span>* size nmemb<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>handler-case
        <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">We use the dynamically-bound *easy-write-procedure* to</span>
        <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">call a closure with useful lexical context.</span>
        <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">progn</span> <span style="color: #859900;">(</span>funcall <span style="color: #b58900;">(</span>symbol-value '*easy-write-procedure*<span style="color: #b58900;">)</span>
                        <span style="color: #b58900;">(</span>foreign-string-to-lisp ptr <span style="color: #657b83; font-weight: bold;">:count</span> data-size<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
               data-size<span style="color: #6c71c4;">)</span>         <span style="color: #93a1a1;">;</span><span style="color: #93a1a1;">indicates success</span>
      <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">The WRITEFUNCTION should return something other than the</span>
      <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">#bytes available to signal an error.</span>
      <span style="color: #6c71c4;">(</span><span style="color: #cb4b16; font-weight: bold;">error</span> <span style="color: #859900;">()</span> <span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #b58900;">(</span>zerop data-size<span style="color: #b58900;">)</span> 1 0<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org0bda816"></a>定义新类型<br />
<div class="outline-text-5" id="text-5-1-1-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#26032;&#30340;c&#31867;&#22411;&#23601;&#26159;&#19968;&#31181;&#31867;&#65292;&#21482;&#26159;&#26377;&#19968;&#20123;&#19982;ffi&#30456;&#20851;&#30340;&#26041;&#27861;&#21644;&#27133;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#19979;&#38754;&#23450;&#20041;&#19968;&#20010;&#26032;&#31867;&#22411;&#65292;&#23545;&#20110;c&#20195;&#30721;&#65292;&#23427;&#21482;&#26159;&#20010;&#25972;&#25968;&#65292;&#20294;&#23545;&#20110;lisp&#65292;&#19981;&#21516;&#25972;&#25968;&#30340;&#20540;&#34987;&#32763;&#35793;&#25104;&#31526;&#21495;&#25110;&#24322;&#24120;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#23454;&#38469;&#19978;&#30340;&#20316;&#29992;&#26159; (defctype curl-code :int)</span>
<span style="color: #2aa198;">(</span>define-foreign-type curl-code-type <span style="color: #b58900;">()</span>
  <span style="color: #b58900;">()</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:actual-type</span> <span style="color: #657b83; font-weight: bold;">:int</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:simple-parser</span> curl-code<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#19979;&#38754;&#32473;&#36825;&#20010;&#31867;&#22411;&#28155;&#21152;&#19968;&#20010;&#26041;&#27861;&#65292;&#20174;c&#31867;&#22411;&#36716;&#25442;&#25104;lisp&#31867;&#22411;&#26102;&#21028;&#26029;&#20540;&#26159;&#21542;&#20026;0&#65292;&#19981;&#20026;0&#23601;&#25243;&#24322;&#24120;</span>
<span style="color: #2aa198;">(</span>define-condition curl-code-error <span style="color: #b58900;">(</span><span style="color: #cb4b16; font-weight: bold;">error</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>$code <span style="color: #657b83; font-weight: bold;">:initarg</span> <span style="color: #657b83; font-weight: bold;">:curl-code</span> <span style="color: #657b83; font-weight: bold;">:reader</span> curl-error-code<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:report</span> <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #6c71c4;">(</span>c stream<span style="color: #6c71c4;">)</span>
             <span style="color: #6c71c4;">(</span>format stream <span style="color: #2aa198;">"libcurl function returned error ~A"</span>
                     <span style="color: #859900;">(</span>curl-error-code c<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:documentation</span> <span style="color: #2aa198;">"Signalled when a libcurl function answers</span>
<span style="color: #2aa198;">  a code other than CURLE_OK."</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">translate-from-foreign</span> <span style="color: #b58900;">(</span>value <span style="color: #268bd2;">(</span>type curl-code-type<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #2aa198;">"Raise a CURL-CODE-ERROR if VALUE, a curl-code, is non-zero."</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>zerop value<span style="color: #268bd2;">)</span>
      <span style="color: #657b83; font-weight: bold;">:curle-ok</span>
    <span style="color: #268bd2;">(</span><span style="color: #cb4b16; font-weight: bold;">error</span> 'curl-code-error <span style="color: #657b83; font-weight: bold;">:curl-code</span> value<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>


<span style="color: #93a1a1;">;;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#19979;&#38754;&#23450;&#20041;&#19968;&#20010;&#26032;&#31867;&#22411;&#65292;&#23427;&#23545;c&#26469;&#35828;&#21482;&#26159;&#20010;&#25351;&#38024;&#65292;&#20294;&#23545;lisp&#65292;&#23427;&#26159;&#19968;&#20010;&#31867;&#65292;&#21516;&#26102;&#36824;&#33021;&#23384;&#20648;&#19968;&#20123;&#25345;&#20037;&#21270;&#21464;&#37327;&#65292;&#36798;&#21040;&#31649;&#29702;&#20869;&#23384;&#30340;&#25928;&#26524;</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#36825;&#20010;&#31867;&#20648;&#23384;&#20102;&#19982;&#23427;&#30456;&#20851;&#30340;&#25968;&#25454;&#65292;&#21253;&#25324;lisp&#25968;&#25454;&#21644;c&#25968;&#25454;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defclass</span> <span style="color: #b58900;">easy-handle</span> <span style="color: #b58900;">()</span>
  <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>pointer <span style="color: #657b83; font-weight: bold;">:initform</span> <span style="color: #6c71c4;">(</span>curl-easy-init<span style="color: #6c71c4;">)</span>
            <span style="color: #657b83; font-weight: bold;">:documentation</span> <span style="color: #2aa198;">"Foreign pointer from curl_easy_init"</span><span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span>error-buffer
    <span style="color: #657b83; font-weight: bold;">:initform</span> <span style="color: #6c71c4;">(</span>foreign-alloc <span style="color: #657b83; font-weight: bold;">:char</span> <span style="color: #657b83; font-weight: bold;">:count</span> *curl-error-size*
                             <span style="color: #657b83; font-weight: bold;">:initial-element</span> 0<span style="color: #6c71c4;">)</span>
    <span style="color: #657b83; font-weight: bold;">:documentation</span> <span style="color: #2aa198;">"C string describing last error"</span><span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span>c-strings <span style="color: #657b83; font-weight: bold;">:initform</span> '<span style="color: #6c71c4;">()</span>
              <span style="color: #657b83; font-weight: bold;">:documentation</span> <span style="color: #2aa198;">"C strings set as options"</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:documentation</span> <span style="color: #2aa198;">"I am a parameterization you may pass to</span>
<span style="color: #2aa198;">  curl-easy-perform to perform a cURL network protocol request."</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#21019;&#24314;&#26102;&#30340;&#21021;&#22987;&#21270;&#26041;&#27861;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">initialize-instance</span> <span style="color: #657b83; font-weight: bold;">:after</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>self easy-handle<span style="color: #268bd2;">)</span> <span style="color: #b58900;">&amp;key</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>set-curl-option-errorbuffer self <span style="color: #268bd2;">(</span>slot-value self 'error-buffer<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#20462;&#25913;&#23545;&#35937;&#30340;&#23646;&#24615;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">add-curl-handle-cstring</span> <span style="color: #b58900;">(</span>handle cstring<span style="color: #b58900;">)</span>
  <span style="color: #2aa198;">"Add CSTRING to be freed when HANDLE is, answering CSTRING."</span>
  <span style="color: #b58900;">(</span>car <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">push</span> cstring <span style="color: #6c71c4;">(</span>slot-value handle 'c-strings<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#20174;&#23545;&#35937;&#20013;&#33719;&#21462;&#23646;&#24615;&#30340;&#20540;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">get-easy-handle-error</span> <span style="color: #b58900;">(</span>handle<span style="color: #b58900;">)</span>
  <span style="color: #2aa198;">"Answer a string containing HANDLE's current error message."</span>
  <span style="color: #b58900;">(</span>foreign-string-to-lisp
   <span style="color: #268bd2;">(</span>slot-value handle 'error-buffer<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#29992;&#26469;&#25163;&#21160;&#37322;&#25918;&#20869;&#23384;&#30340;&#20989;&#25968;&#65292;&#24403;&#28982;&#24182;&#19981;&#33021;&#33258;&#21160;&#26512;&#26500;&#65292;&#36824;&#26159;&#24471;&#22312;&#26576;&#20010;&#20301;&#32622;&#25163;&#21160;&#35843;&#29992;&#23427;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">free-easy-handle</span> <span style="color: #b58900;">(</span>handle<span style="color: #b58900;">)</span>
  <span style="color: #2aa198;">"Free CURL easy interface HANDLE and any C strings created to</span>
<span style="color: #2aa198;">  be its options."</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">with-slots</span> <span style="color: #268bd2;">(</span>pointer error-buffer c-strings<span style="color: #268bd2;">)</span> handle
    <span style="color: #268bd2;">(</span>curl-easy-cleanup pointer<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>foreign-free error-buffer<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>mapc #'foreign-string-free c-strings<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#22312;&#20648;&#23384;&#25968;&#25454;&#30340;&#31867;&#30340;&#22522;&#30784;&#19978;&#21019;&#24314;cffi&#30340;&#31867;&#22411;</span>
<span style="color: #2aa198;">(</span>define-foreign-type easy-handle-type <span style="color: #b58900;">()</span>
  <span style="color: #b58900;">()</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:actual-type</span> <span style="color: #657b83; font-weight: bold;">:pointer</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:simple-parser</span> easy-handle<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#24182;&#32473;&#25351;&#23450;&#36825;&#20010;cffi&#31867;&#22411;&#22914;&#20309;&#34987;c&#20989;&#25968;&#29702;&#35299;</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">translate-to-foreign</span> <span style="color: #b58900;">(</span>handle <span style="color: #268bd2;">(</span>type easy-handle-type<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #2aa198;">"Extract the pointer from an easy-HANDLE."</span>
  <span style="color: #b58900;">(</span>slot-value handle 'pointer<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org58e04ac" class="outline-4">
<h4 id="org58e04ac"><span class="section-number-4">5.1.2</span> 类型参考</h4>
<div class="outline-text-4" id="text-5-1-2">
</div>
<ol class="org-ol">
<li><a id="orgb68cb5b"></a>预定义类型<br />
<ol class="org-ol">
<li><a id="org9be7ab7"></a>基本类型<br />
<div class="outline-text-6" id="text-5-1-2-1-1">
<ol class="org-ol">
<li>字符类型： <code>:char, :unsigned-char, :short, :unsigned-short, :int, :unsigned-int, :long, :unsigned-long, :long-long, :unsigned-long-long</code></li>
<li><code>:long-long, :unsigned-long-long</code> 没有实现支持，都是使用 <code>men-ref, mem-set</code> 模拟</li>
<li>无符号字符类型的简写： <code>:uchar, :ushort, :uint, :ulong, :llong, :ullong</code></li>
<li>整数类型，对应 <code>stdint.h</code> : <code>:int8, :uint8, :int16, :uint16, :int32, :uint32, :int64, :uint64</code></li>
<li>浮点数 <code>:float</code> 对应 <code>single-float</code> ， <code>:double</code> 对应 <code>:double-float</code></li>
<li>指针 <code>:pointer</code> 对应 <code>void *</code></li>
<li>指针 <code>(:pointer :char)</code> 等，对应 <code>char *</code> ，但是没有实际效果，c的指针都是一样的。</li>
<li>无类型 <code>:void</code> 对应c的 <code>void</code> 只能用作函数的返回类型标记</li>
<li><code>:string</code> 对应 <code>char *</code> ,它的作用域是动态的，也就是说作为函数返回值时会被立即释放。也可用 <code>free-translated-object</code> 方法释放。</li>
<li><code>:string+ptr</code> 和 <code>:string</code> 一样，只是用作返回值时会返回lisp字符串和c字符串的指针两个元素的列表</li>
<li><code>:boolean</code> ： <code>nil</code> 对应 <code>int 0</code> , <code>t</code> 对应 <code>int 1</code></li>
<li><code>:bool</code> 对应 c99的 <code>_Bool</code> 和c++的 <code>bool</code></li>
</ol>
</div>
</li>

<li><a id="orgde92500"></a>结构体类型<br />
<ol class="org-ol">
<li><a id="orgb9b95e9"></a>结构体 <code>defcstruct</code><br />
<div class="outline-text-7" id="text-5-1-2-1-2-1">
<p>
只有当lisp代码需要知道结构体确切的值的时候才用，一般情况下只需要传指针 <code>:pointer</code> 不需要传值。
</p>

<p>
当确实需要传值的时候，可以使用 <code>translate-into-foreign-memory, expand-into-foreign-memory</code> 优化内存控制。
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #2aa198;">(</span>defcstruct person
  <span style="color: #b58900;">(</span>number <span style="color: #657b83; font-weight: bold;">:int</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>reason <span style="color: #657b83; font-weight: bold;">:string</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org3361bad"></a><code>defbitfield</code><br /></li>
<li><a id="org9513774"></a>联合 <code>defcunion</code><br />
<div class="outline-text-7" id="text-5-1-2-1-2-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #2aa198;">(</span>defcunion uint32-bytes
  <span style="color: #b58900;">(</span>int-value <span style="color: #657b83; font-weight: bold;">:unsigned-int</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>bytes <span style="color: #657b83; font-weight: bold;">:unsigned-char</span> <span style="color: #657b83; font-weight: bold;">:count</span> 4<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org4bfc8cb"></a>枚举 <code>defcenum</code><br />
<div class="outline-text-7" id="text-5-1-2-1-2-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #2aa198;">(</span>defcenum boolean
  <span style="color: #657b83; font-weight: bold;">:no</span>
  <span style="color: #657b83; font-weight: bold;">:yes</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>foreign-enum-value 'boolean <span style="color: #657b83; font-weight: bold;">:no</span><span style="color: #2aa198;">)</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#8658; 0</span>

<span style="color: #2aa198;">(</span>defcenum numbers
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:one</span> 1<span style="color: #b58900;">)</span>
  <span style="color: #657b83; font-weight: bold;">:two</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:four</span> 4<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>foreign-enum-keyword 'numbers 2<span style="color: #2aa198;">)</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">&#8658; :TWO</span>

</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</li>

<li><a id="orga6ea8e8"></a>自定义类型<br />
<ol class="org-ol">
<li><a id="orgb32c667"></a>定义基本类型 <code>defctype</code><br />
<div class="outline-text-6" id="text-5-1-2-2-1">
<p>
基本上可以认为是类型别名
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #93a1a1;">;;; </span><span style="color: #93a1a1;">Define MY-INT as an alias for the built-in type :INT.</span>
<span style="color: #2aa198;">(</span>defctype my-int <span style="color: #657b83; font-weight: bold;">:int</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="org35a705e"></a>定义c类型和lisp类型的组合 <code>:wrapper</code><br />
<div class="outline-text-6" id="text-5-1-2-2-2">
<p>
<code>:wrapper</code> 是一种将lisp类型和c类型对应组合起来的简单方法
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">bool-c-to-lisp</span> <span style="color: #b58900;">(</span>value<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>not <span style="color: #268bd2;">(</span>zerop value<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defun</span> <span style="color: #268bd2;">bool-lisp-to-c</span> <span style="color: #b58900;">(</span>value<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> value 1 0<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>defctype my-bool <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:wrapper</span> <span style="color: #657b83; font-weight: bold;">:int</span> <span style="color: #657b83; font-weight: bold;">:from-c</span> bool-c-to-lisp
                            <span style="color: #657b83; font-weight: bold;">:to-c</span> bool-lisp-to-c<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>convert-to-foreign nil 'my-bool<span style="color: #2aa198;">)</span> &#8658; 0
<span style="color: #2aa198;">(</span>convert-from-foreign 1 'my-bool<span style="color: #2aa198;">)</span> &#8658; t
</pre>
</div>
</div>
</li>

<li><a id="orgf9d6eb9"></a>定义复杂类型<br />
<ol class="org-ol">
<li><a id="org37649df"></a>定义cffi类型 <code>define-foreign-type</code><br />
<div class="outline-text-7" id="text-5-1-2-2-3-1">
<p>
也就是类和方法
</p>
<ol class="org-ol">
<li>设置类型的参数，也就是槽</li>
<li><code>:actual-type</code> 指定最终被传递给c的是什么类型</li>
<li><p>
定义类型的字面量解析方法 <code>define-parse-method</code>
</p>

<p>
下面定义 (my-string &amp;key encoding) 类型，以及 <code>(my-string :encoding :utf-8)</code> 这样使用时的行为
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">      <span style="color: #2aa198;">(</span>define-foreign-type my-string-type <span style="color: #b58900;">()</span>
        <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>encoding <span style="color: #657b83; font-weight: bold;">:reader</span> string-type-encoding <span style="color: #657b83; font-weight: bold;">:initarg</span> <span style="color: #657b83; font-weight: bold;">:encoding</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
        <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:actual-type</span> <span style="color: #657b83; font-weight: bold;">:pointer</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

      <span style="color: #2aa198;">(</span>define-parse-method my-string <span style="color: #b58900;">(</span><span style="color: #b58900;">&amp;key</span> <span style="color: #268bd2;">(</span>encoding <span style="color: #657b83; font-weight: bold;">:utf-8</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
        <span style="color: #b58900;">(</span>make-instance 'my-string-type <span style="color: #657b83; font-weight: bold;">:encoding</span> encoding<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div></li>
</ol>
</div>
</li>

<li><a id="orge7352a1"></a>定义类型转换方法 <code>translate-to-foreign, translate-from-foreign, free-translated-object</code><br />
<div class="outline-text-7" id="text-5-1-2-2-3-2">
<p>
需要定义下面几个方法
</p>
<ol class="org-ol">
<li>从lisp类型转换成c类型的方法 <code>translate-from-foreign</code></li>
<li>从c类型转换成lisp类型的方法 <code>translate-to-foreign</code></li>
<li>释放储存的数据的方法 <code>free-translated-object</code></li>
</ol>

<p>
需要注意，这三个是钩子方法，不能直接调用，调用需要用一般函数 <code>convert-to-foreign, convert-from-foreign, free-converted-object</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">lisp -&gt; c</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">translate-to-foreign</span> <span style="color: #b58900;">(</span>string <span style="color: #268bd2;">(</span>type my-string-type<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>foreign-string-alloc string <span style="color: #657b83; font-weight: bold;">:encoding</span> <span style="color: #268bd2;">(</span>string-type-encoding type<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">c -&gt; lisp</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">translate-from-foreign</span> <span style="color: #b58900;">(</span>pointer <span style="color: #268bd2;">(</span>type my-string-type<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>foreign-string-to-lisp pointer <span style="color: #657b83; font-weight: bold;">:encoding</span> <span style="color: #268bd2;">(</span>string-type-encoding type<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">free</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">free-translated-object</span> <span style="color: #b58900;">(</span>pointer <span style="color: #268bd2;">(</span>type my-string-type<span style="color: #268bd2;">)</span> param<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">declare</span> <span style="color: #268bd2;">(</span>ignore param<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>foreign-string-free pointer<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="orgd31d7e7"></a>优化类型转换开销<br />
<div class="outline-text-7" id="text-5-1-2-2-3-3">
<p>
按照类型转换的三个函数直接写，会导致类型转换的开销。通常情况下这个问题不明显，但有时候需要尽可能减小这种开销。
</p>

<p>
减小类型转换开销的方法是使用展开宏，类似于cl的编译器宏
</p>
<ol class="org-ol">
<li><code>expand-to-foreign</code> ： lisp-&gt;c</li>
<li><code>expand-from-foreign</code> ： c-&gt;lisp</li>
<li><code>expand-to-foreign-dyn</code> ：由于没有对应的释放内存函数，只能用动态作用域的 lisp-&gt;c 函数代替，这个函数在知道对象有动态作用域的时候有用，因为这时候函数调用不会保存分配参数</li>
</ol>

<p>
展开宏比对应的翻译函数要先调用，所有如果展开宏得不到最终结构，就使用 <code>next</code> 函数让翻译函数完成剩下的工作。
</p>

<p>
例1：使用宏判断并使用对应的立即值，消除函数调用和类型转换
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #2aa198;">(</span>define-foreign-type my-boolean-type <span style="color: #b58900;">()</span>
  <span style="color: #b58900;">()</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:actual-type</span> <span style="color: #657b83; font-weight: bold;">:int</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #657b83; font-weight: bold;">:simple-parser</span> my-boolean<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">expand-to-foreign</span> <span style="color: #b58900;">(</span>value <span style="color: #268bd2;">(</span>type my-boolean-type<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  `<span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> ,value 1 0<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">expand-from-foreign</span> <span style="color: #b58900;">(</span>value <span style="color: #268bd2;">(</span>type my-boolean-type<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  `<span style="color: #b58900;">(</span>not <span style="color: #268bd2;">(</span>zerop ,value<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>

<p>
例：字符串传递给函数，再得到返回值
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">expand-from-foreign</span> <span style="color: #b58900;">(</span>form <span style="color: #268bd2;">(</span>type my-string-type<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  `<span style="color: #b58900;">(</span>foreign-string-to-lisp ,form<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">defmethod</span> <span style="color: #268bd2;">expand-to-foreign-dyn</span> <span style="color: #b58900;">(</span>value var body <span style="color: #268bd2;">(</span>type my-string-type<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>encoding <span style="color: #859900;">(</span>string-type-encoding type<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    `<span style="color: #268bd2;">(</span>with-foreign-string <span style="color: #6c71c4;">(</span>,var ,value <span style="color: #657b83; font-weight: bold;">:encoding</span> ',encoding<span style="color: #6c71c4;">)</span>
                          ,@body<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="org4f46979"></a>有用的函数<br />
<div class="outline-text-6" id="text-5-1-2-2-4">
<p>
convert-from-foreign
convert-to-foreign
foreign-type-alignment
foreign-type-size
free-converted-object
free-translated-object
with-foreign-slots
</p>
</div>
</li>
</ol>
</li>

<li><a id="org62cd6cc"></a>指针和内存<br />
<div class="outline-text-5" id="text-5-1-2-3">
<p>
cffi中所有c数据都是指针，包括整数。
</p>
<ol class="org-ol">
<li>指针的类型是 <code>foreign-pointer</code></li>
<li>一些操作指针的函数： <code>make-pointer, pointer-address, pointer-eq</code></li>
<li>栈上分配内存,也是lisp的动态分配，它有动态作用域，就像用 <code>let</code> 绑定的变量： <code>with-foreign-object</code></li>
<li>堆上分配内存用 <code>foreign-alloc</code> ，会一直保持到使用 <code>foreign-free</code> 释放为止。</li>
<li>访问c内存中的值是通过 <code>mem-aref</code> 和 <code>mem-ref</code> ，并用 <code>setf</code> 修改它的值。</li>
<li>访问内存中的数据时，认为所有指针都指向了一个数组， <code>mem-aref</code> 会得到数组的下标 <code>[n]</code> ， <code>mem-ref</code> 会得到指针的解引用 <code>*</code> 。</li>
</ol>
</div>

<ol class="org-ol">
<li><a id="org5d0ac14"></a>有用的函数<br />
<div class="outline-text-6" id="text-5-1-2-3-1">
<p>
foreign-free
foreign-alloc
foreign-symbol-pointer
inc-pointer
incf-pointer
make-pointer
mem-aptr
mem-aref
mem-ref
null-pointer
null-pointer-p
pointerp
pointer-address
pointer-eq
with-foreign-object
with-foreign-objects
with-foreign-pointer
</p>
</div>
</li>
</ol>
</li>

<li><a id="org7cfe75b"></a>字符串<br />
<div class="outline-text-5" id="text-5-1-2-4">
<p>
字符串是字符的数组，它很常用所以提供了一些函数来操作它，这些函数都可以自己来实现。所以它也可以看作是一个使用cffi的示例。
</p>

<ol class="org-ol">
<li><b>default-foreign-encoding</b></li>
<li>foreign-string-alloc</li>
<li>foreign-string-free</li>
<li>foreign-string-to-lisp</li>
<li>lisp-string-to-foreign</li>
<li>with-foreign-string</li>
<li>with-foreign-strings</li>
<li>with-foreign-pointer-as-string</li>
</ol>
</div>
</li>

<li><a id="orgb663862"></a>变量<br />
<div class="outline-text-5" id="text-5-1-2-5">
<ol class="org-ol">
<li><code>defcvar</code> :定义一个变量，可以直接访问，会自动把它的名字在c和lisp之间转换</li>
<li><code>get-var-pointer</code> :获得指向 <code>defcvar</code> 定义的变量的指针</li>
</ol>
</div>
</li>
<li><a id="org161d19d"></a>函数<br />
<div class="outline-text-5" id="text-5-1-2-6">
<ol class="org-ol">
<li><code>defcfun</code> :</li>
<li><code>foreign-funcall</code> :</li>
<li><code>foreign-funcall-pointer</code> :</li>
<li><code>foreign-funcall-varargs</code> :</li>
<li><code>foreign-funcall-pointer-varargs</code> :</li>
<li><code>translate-camelcase-name</code> :</li>
<li><code>translate-name-from-foreign</code> :</li>
<li><code>translate-name-to-foreign</code> :</li>
<li><code>translate-underscore-separated-name</code> :</li>
</ol>
</div>
</li>

<li><a id="org9acb21f"></a>回调<br />
<div class="outline-text-5" id="text-5-1-2-7">
<ol class="org-ol">
<li><code>callback</code> : 获得函数指针</li>
<li><code>defcallback</code> : 定义一个能从c访问的lisp函数</li>
<li><code>get-callback</code> : 是 <code>callback</code> 宏的函数版本</li>
</ol>
</div>
</li>
</ol>
</div>

<div id="outline-container-org753f387" class="outline-4">
<h4 id="org753f387"><span class="section-number-4">5.1.3</span> 问题解决</h4>
<div class="outline-text-4" id="text-5-1-3">
</div>
<ol class="org-ol">
<li><a id="orgb3f1e88"></a>windows上的dll路径位置<br />
<div class="outline-text-5" id="text-5-1-3-1">
<p>
cffi是直接使用 <code>LoadLibrary</code> 函数加载dll库的，所以dll位置要能被这个函数找到才行。
</p>

<ol class="org-ol">
<li>把dll所在文件夹添加进 <code>PATH</code> 里，windows只认path里的东西，没有 <code>LD_LIBRARY_PATH</code> 这种变量</li>
</ol>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-orgedcefaa" class="outline-3">
<h3 id="orgedcefaa"><span class="section-number-3">5.2</span> cl-autowrap</h3>
<div class="outline-text-3" id="text-5-2">
</div>
<div id="outline-container-org0e921f2" class="outline-4">
<h4 id="org0e921f2"><span class="section-number-4">5.2.1</span> 安装 c2ffi</h4>
<div class="outline-text-4" id="text-5-2-1">
<p>
<a href="https://github.com/rpav/c2ffi">https://github.com/rpav/c2ffi</a>
用 llvm + cmake 那一套直接编译就好了
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd6aef35" class="outline-2">
<h2 id="orgd6aef35"><span class="section-number-2">6</span> iterate : 代替 loop 宏</h2>
<div class="outline-text-2" id="text-6">
<p>
<a href="https://common-lisp.net/project/iterate/">https://common-lisp.net/project/iterate/</a>
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left"><b>语法</b></th>
<th scope="col" class="org-left"><b>作用</b></th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><b>重复次数</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(repeat 100)</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><b>数字迭代</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for i upfrom 0)</td>
<td class="org-left">0 1 2 &#x2026;</td>
</tr>

<tr>
<td class="org-left">(for i from 5)</td>
<td class="org-left">5 6 7 &#x2026;</td>
</tr>

<tr>
<td class="org-left">(for i downfrom 0)</td>
<td class="org-left">0 -1 -2 &#x2026;</td>
</tr>

<tr>
<td class="org-left">(for i from 1 to 3)</td>
<td class="org-left">1 2 3</td>
</tr>

<tr>
<td class="org-left">(for i from 1 below 3)</td>
<td class="org-left">1 2</td>
</tr>

<tr>
<td class="org-left">(for i from 1 to 3 by 2)</td>
<td class="org-left">1 3</td>
</tr>

<tr>
<td class="org-left">(for i from 1 below 3 by 2)</td>
<td class="org-left">1</td>
</tr>

<tr>
<td class="org-left">(for i from 5 downto 3)</td>
<td class="org-left">5 4 3</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><b>列表迭代</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for var in list &amp;optional by step-function)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for var on list &amp;optional by step-function)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for var in-vector vector &amp;sequence)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for var in-sequence seq &amp;sequence)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for var in-string string &amp;sequence)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for var index-of-vector vector &amp;sequence)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for var index-of-sequence sequence &amp;sequence)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for var index-of-string string &amp;sequence)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for (key value) in-hashtable table)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for var in-package package &amp;optional)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for var in-packages &amp;optional having-access symbol-types)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for var in-file name &amp;optional using reader)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for var in-stream stream &amp;optional using reader)</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><b>生成驱动器 next</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for var next expr)</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><b>条件迭代 generate</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(generate i upfrom 1) (next i)</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><b>上一次迭代的元素 previous</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for el in '(1 2 3 4)) (for p-el previous el)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for pp-el previous el back 2 initially 0)</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><b>变量绑定 initially then</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for var initially init-expr then then-expr)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(for var first first-expr then then-expr)</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><b>获取语句</b></td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><b>收缩 reducing</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(sum expr &amp;optional into var)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(multiply expr &amp;optional into var)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(counting expr &amp;optional into var)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(maximize expr &amp;optional into var)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(minimize expr &amp;optional into var)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(reducing expr by func &amp;optional)</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><b>累积 collect</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(collect exptr &amp;optional  into var at place result-type type )</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(adjoining exptr &amp;optional into var test test at place result-type type)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(appending expr &amp;optional into var at place)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(nconcing expr &amp;optional into var at place)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(unioning expr &amp;optional into var test test at place)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(nunioning expr &amp;optional into var test test at place)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(accumulate expr by func &amp;optional initial-value init-val into var)</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><b>寻找 finding</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(finding expr such-that test &amp;optionally into var on-failure failure-value)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(finding expr maximizing m-expr &amp;optional into var)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(finding expr minimizing m-expr &amp;optional into var)</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><b>布尔测试</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">first-iteration-p</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">first-time-p</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(always expr)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(never expr)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(thereis expr)</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><b>控制流</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(finish)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(leave &amp;optional value)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(next-iteration)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(while expr)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(until expr)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(if-first-time then &amp;optional else)</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><b>代码放置</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(initially &amp;rest forms)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(after-each &amp;rest forms)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(else &amp;rest forms)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">(finally &amp;rest forms)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orge453a9e" class="outline-2">
<h2 id="orge453a9e"><span class="section-number-2">7</span> ugly-tiny-infix-macro</h2>
<div class="outline-text-2" id="text-7">
<p>
<a href="https://github.com/peey/ugly-tiny-infix-macro">https://github.com/peey/ugly-tiny-infix-macro</a>
</p>
</div>
</div>
<div id="outline-container-org09901e8" class="outline-2">
<h2 id="org09901e8"><span class="section-number-2">8</span> eazy-gnuplot</h2>
<div class="outline-text-2" id="text-8">
<p>
<a href="https://github.com/guicho271828/eazy-gnuplot">https://github.com/guicho271828/eazy-gnuplot</a>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: chimez</p>
<p class="date">Created: 2020-09-27 Sun 17:23</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
